[
  {
    "path": "posts/welcome/",
    "title": "Welcome to Ripe and Ruin",
    "description": "Like all good fruit, the balance of life is in the ripe and ruin",
    "author": [
      {
        "name": "Jonathan Jayes",
        "url": "https://example.com/norajones"
      }
    ],
    "date": "2021-03-13",
    "categories": [],
    "contents": "\r\n\r\n\r\n\r\n",
    "preview": {},
    "last_modified": "2021-03-16T13:01:05+01:00",
    "input_file": "welcome.utf8.md"
  },
  {
    "path": "posts/2021-03-13-south-africa-car-colour-exploration/",
    "title": "South African Car Colour Exploration",
    "description": "In this document I walk through creating a stacked area chart showing the evolution of car colour over time in South Africa. The data comes from nearly 45,000 adverts for cars that I scraped from Gumtree.",
    "author": [
      {
        "name": "Jonathan Jayes",
        "url": {}
      }
    ],
    "date": "2020-11-24",
    "categories": [],
    "contents": "\r\n\r\nContents\r\nPurposeWhat does the data look like?\r\nWhat are the most common car colours advertised?\r\nHow has the colour of cars changed over time?\r\nFirst stacked area chart attempt\r\nSolution to gaps in area chart\r\nPutting it together\r\nTightening up the graphic\r\nConclusion\r\nPost script\r\n\r\n\r\nPurpose\r\nWhile driving to Cape Town this past weekend in my beautiful white Hyundai i10, a German friend asked why every second car in South Africa was white in colour. While I didn’t have a compelling reason, I did have a some data to assess whether it was true that half of cars on the road are white.\r\nIn this document I walk through creating a stacked area chart showing the evolution of car colour over time in South Africa. The data comes from nearly 45,000 adverts for cars that I scraped from Gumtree.\r\nI show a useful trick for filling in missing data that creates gaps in the area chart using dplyr’s pivot_wider and pivot_longer commands.\r\nHere is the final interactive graphic:\r\n\r\nShow code\r\ndf_plotly <- read_rds(\"data/car_colour/df_plotly.rds\")\r\n\r\np_load(plotly)\r\n\r\ng <- df_plotly %>% \r\n  ggplot(aes(year, share, fill = colour)) +\r\n  geom_area(colour = \"black\", size = .2, alpha = .8) +\r\n  scale_fill_manual(values = c(\"#17202A\", \"#2471A3\", \"#800020\", \"#F39C12\", \"#27AE60\", \"#BDC3C7\", \"midnightblue\", \"#C0392B\", \"#95A5A6\", \"#F8F9F9\")) +\r\n  scale_y_continuous(labels = scales::percent_format()) +\r\n  theme(legend.position = \"bottom\",\r\n        panel.grid = element_blank()) +\r\n  labs(title = \"Evolution of car colour in South Africa: 1995-2020\",\r\n       subtitle = \"Based on Gumtree vehicle adverts\",\r\n       x = \"Year of production\",\r\n       y = \"Share of cars in each colour per year\",\r\n       fill = \"\",\r\n       caption = \"Source: Source: Gumtree vehicle adverts scraped in October 2020\\nGraphic: Jonathan Jayes\")\r\n\r\nggplotly(g)\r\n\r\n\r\npreservec9f9ff049b18e330\r\n\r\n\r\nShow code\r\ndf <- readRDS(\"data/car_colour/gumtree_ads_2020-10-01-11-33-am.rds\")\r\n\r\ndf <- df %>% filter(!is.na(make),\r\n                    !is.na(colour),\r\n                    !is.na(model)) %>% \r\n             # Removing the duplicated province names   \r\n             mutate(province = str_remove(province, \"\\\\,.*\"))\r\n\r\n\r\n\r\nWhat does the data look like?\r\n\r\nShow code\r\nskimr::skim(df)\r\n\r\n\r\nTable 1: Data summary\r\nName\r\ndf\r\nNumber of rows\r\n44644\r\nNumber of columns\r\n30\r\n_______________________\r\n\r\nColumn type frequency:\r\n\r\ncharacter\r\n22\r\nnumeric\r\n8\r\n________________________\r\n\r\nGroup variables\r\nNone\r\nVariable type: character\r\nskim_variable\r\nn_missing\r\ncomplete_rate\r\nmin\r\nmax\r\nempty\r\nn_unique\r\nwhitespace\r\nlink\r\n0\r\n1.00\r\n68\r\n86\r\n0\r\n2218\r\n0\r\nad_url\r\n0\r\n1.00\r\n78\r\n193\r\n0\r\n38392\r\n0\r\nsite\r\n0\r\n1.00\r\n7\r\n7\r\n0\r\n1\r\n0\r\nseller_type\r\n0\r\n1.00\r\n19\r\n30\r\n0\r\n2\r\n0\r\ntitle\r\n0\r\n1.00\r\n4\r\n100\r\n0\r\n26140\r\n0\r\ntext\r\n0\r\n1.00\r\n10\r\n3885\r\n0\r\n38343\r\n0\r\nad_date\r\n0\r\n1.00\r\n19\r\n19\r\n0\r\n42416\r\n0\r\nseller_name\r\n0\r\n1.00\r\n1\r\n50\r\n0\r\n8872\r\n0\r\nlocation\r\n0\r\n1.00\r\n24\r\n61\r\n0\r\n428\r\n0\r\nseller_age\r\n0\r\n1.00\r\n17\r\n22\r\n0\r\n79\r\n0\r\nn_all_time_ads\r\n0\r\n1.00\r\n1\r\n7\r\n0\r\n3481\r\n0\r\nscrape_time\r\n0\r\n1.00\r\n19\r\n19\r\n0\r\n35812\r\n0\r\nlocation_2\r\n0\r\n1.00\r\n11\r\n47\r\n0\r\n428\r\n0\r\nfor_sale_by\r\n226\r\n0.99\r\n5\r\n6\r\n0\r\n2\r\n0\r\nmake\r\n0\r\n1.00\r\n3\r\n13\r\n0\r\n37\r\n0\r\nmodel\r\n0\r\n1.00\r\n1\r\n20\r\n0\r\n459\r\n0\r\nbody_type\r\n226\r\n0.99\r\n3\r\n12\r\n0\r\n11\r\n0\r\ntransmission\r\n206\r\n1.00\r\n6\r\n9\r\n0\r\n2\r\n0\r\nfuel_type\r\n104\r\n1.00\r\n6\r\n8\r\n0\r\n4\r\n0\r\ncolour\r\n0\r\n1.00\r\n3\r\n8\r\n0\r\n16\r\n0\r\nna\r\n44644\r\n0.00\r\nNA\r\nNA\r\n0\r\n0\r\n0\r\nprovince\r\n0\r\n1.00\r\n7\r\n13\r\n0\r\n9\r\n0\r\nVariable type: numeric\r\nskim_variable\r\nn_missing\r\ncomplete_rate\r\nmean\r\nsd\r\np0\r\np25\r\np50\r\np75\r\np100\r\nhist\r\npage\r\n0\r\n1.00\r\n14.51\r\n12.66\r\n1\r\n4.00\r\n11.0\r\n22.00\r\n50\r\n▇▃▂▁▁\r\nad_number\r\n0\r\n1.00\r\n23570.95\r\n14487.85\r\n1\r\n11471.75\r\n22889.5\r\n34258.25\r\n56454\r\n▇▇▇▆▂\r\nprice\r\n229\r\n0.99\r\n218706.68\r\n692268.63\r\n1\r\n109900.00\r\n165000.0\r\n259900.00\r\n140000000\r\n▇▁▁▁▁\r\nn_photos\r\n1099\r\n0.98\r\n8.63\r\n3.08\r\n1\r\n7.00\r\n9.0\r\n12.00\r\n12\r\n▁▂▃▃▇\r\nn_views\r\n0\r\n1.00\r\n588.85\r\n1281.69\r\n0\r\n91.00\r\n233.5\r\n580.00\r\n46956\r\n▇▁▁▁▁\r\nn_active_ads\r\n0\r\n1.00\r\n130.20\r\n225.27\r\n1\r\n5.50\r\n29.0\r\n100.00\r\n997\r\n▇▁▁▁▁\r\nyear\r\n100\r\n1.00\r\n2013.76\r\n6.66\r\n1900\r\n2011.00\r\n2016.0\r\n2018.00\r\n2021\r\n▁▁▁▁▇\r\nkilometers\r\n1189\r\n0.97\r\n92267.35\r\n157493.13\r\n1\r\n26890.50\r\n72000.0\r\n130000.00\r\n9999999\r\n▇▁▁▁▁\r\n\r\nThe dataset has some really nice information on the cars advertised, including their characteristics, as well as the location and name of the seller.\r\nFor this graphic, we only need the car’s year and colour.\r\nWhat are the most common car colours advertised?\r\nWe start by plotting the number of cars in each colour advertised on Gumtree. In this plot I show the 12 most common colours.\r\nIt is evident that white and silver cars are very common. In as far as our data reflects cars on the road, white cars make up nearly 1/3 of all cars advertised! A little less than the half quoted in the discussion above, but certainly the dominant colour.\r\n\r\nShow code\r\ndf %>%\r\n  mutate(colour = fct_lump(colour, 12)) %>%\r\n  select(colour) %>% \r\n  count(colour, sort = T) %>% \r\n  mutate(colour = fct_reorder(colour, n)) %>% \r\n  ggplot(aes(n, colour)) +\r\n  geom_segment(aes(xend = 0, yend = colour)) +\r\n  geom_point(size = 4, colour = \"orange\") +\r\n  geom_text(aes(label = scales::comma(n)), hjust = -.3) +\r\n  scale_x_continuous(labels = scales::comma_format(), limits = c(0, 16000)) +\r\n  labs(x = \"Number of vehicles\",\r\n       title = \"What are the most common vehicle colours advertised on Gumtree?\",\r\n       subtitle = \"Data from 45,000 adverts from across the country\",\r\n       y = \"\")\r\n\r\n\r\n\r\n\r\nHow has the colour of cars changed over time?\r\nNext we want to know if some colours have become more popular over time. Given that our data source is a snapshot of cars for sale at one point in time and on one online website, this is unlikely to be representative of the entire population of cars in South Africa. However, it will be interesting to see the trends that do exist in this data.\r\nWe start with a simple plot of the number of cars advertised in the none more common colours, by year.\r\n\r\nShow code\r\ndf_colours <- df %>% \r\n  group_by(year, colour) %>% \r\n  summarise(n = n()) %>%\r\n  ungroup() %>% \r\n  filter(between(year, 1990, 2020)) \r\n\r\n\r\n\r\nIt makes sense that the majority of adverts are for cars that are produced recently, and it is striking that white and silver cars see such a dramatic increase, even relative to the third most common car colour, grey.\r\n\r\nShow code\r\ndf_colours %>% \r\n  mutate(colour = fct_lump(colour, 10)) %>%\r\n  filter(colour != \"Other\") %>% \r\n  mutate(colour = fct_reorder(colour, n, .fun = sum, .desc = T)) %>% \r\n  ggplot(aes(year, n, fill = colour)) +\r\n  geom_area() +\r\n  facet_wrap(~ colour)\r\n\r\n\r\n\r\n\r\nFirst stacked area chart attempt\r\nIn this plot we show the evolution of car colour between 1990 and the present.\r\nThere are a few problems with this plot. First, there are too many colours, the least common of which have just a few entries. Second, the missing values for the less common colours create unappealing white gaps in the bottom left of the plot.\r\n\r\nShow code\r\ndf_colours %>% \r\n  group_by(year) %>% \r\n  add_tally(n) %>% \r\n  ungroup() %>% \r\n  mutate(colour = fct_reorder(colour, nn, .fun = sum, .desc = T)) %>% \r\n  mutate(share = n / nn) %>% \r\n  ggplot(aes(year, share, fill = colour)) +\r\n  geom_area()\r\n\r\n\r\n\r\n\r\nSolution to gaps in area chart\r\nTo solve this problem, we can fill in the missing values by making the dataset wider and then long gain.\r\nUsing dplyr’s pivot_wider and the values_fill = 0 option, we create a wide dataset with one row for each year, shown below.\r\nWe go from a long dataset like this:\r\n\r\nShow code\r\nhead(df_colours)\r\n\r\n\r\n# A tibble: 6 x 3\r\n   year colour     n\r\n  <dbl> <chr>  <int>\r\n1  1990 Black      2\r\n2  1990 Blue      14\r\n3  1990 Gold       3\r\n4  1990 Green      3\r\n5  1990 Grey       5\r\n6  1990 Other      3\r\n\r\nTo a wide one, like this:\r\n\r\nShow code\r\ndf_colours <- df_colours %>% \r\n  mutate(colour = fct_lump(colour, 10)) %>%\r\n    group_by(year, colour) %>% \r\n    mutate(n = sum(n)) %>% \r\n  ungroup() %>% \r\n  distinct() %>% \r\n  pivot_wider(names_from = colour, values_from = n, values_fill = 0) \r\n\r\nhead(df_colours)\r\n\r\n\r\n# A tibble: 6 x 11\r\n   year Black  Blue  Gold Green  Grey Other   Red Silver White\r\n  <dbl> <int> <int> <int> <int> <int> <int> <int>  <int> <int>\r\n1  1990     2    14     3     3     5     4    10      3    10\r\n2  1991     3    11     2     4     4     3     9      3    12\r\n3  1992     1    16     2     4     5     7    11      3    14\r\n4  1993     0    13     2     1     4     1    13      7    18\r\n5  1994     2    15     0     8     7     1    13      6    41\r\n6  1995     6    36     0    17     6     3    32      7    34\r\n# ... with 1 more variable: Burgundy <int>\r\n\r\nNow we have a ‘wide’ dataset with the missing values filled in with zeros\r\nWe can then make it long again, with the pivot_longer command, specifying that we want the original column names back.\r\n\r\nShow code\r\ndf_colours <- df_colours %>% \r\n  pivot_longer(!year, names_to = \"colour\", values_to = \"n\")\r\n\r\nhead(df_colours)\r\n\r\n\r\n# A tibble: 6 x 3\r\n   year colour     n\r\n  <dbl> <chr>  <int>\r\n1  1990 Black      2\r\n2  1990 Blue      14\r\n3  1990 Gold       3\r\n4  1990 Green      3\r\n5  1990 Grey       5\r\n6  1990 Other      4\r\n\r\nPutting it together\r\nNow we have a plot with no white gaps, and an appropriate number of colours. However, it would be nice to have the colours on the plot match the colours of the cars, and have some labels to make it clear to the reader how to interpret the graphic.\r\n\r\nShow code\r\ndf_colours %>% \r\n  group_by(year) %>% \r\n  add_tally(n) %>% \r\n  ungroup() %>% \r\n  mutate(share = n / nn) %>% \r\n  ggplot(aes(year, share, fill = colour)) +\r\n  geom_area()\r\n\r\n\r\n\r\n\r\nTightening up the graphic\r\nWe use ggplot’s scale_fill_manual to specify the hex codes for the colours in the order that they appear in the plot.\r\nWe add in a title and axes labels, and make the plot interactive with ggplotly.\r\n\r\nShow code\r\ng <- df_colours %>% \r\n  filter(year > 1994) %>% \r\n  group_by(year) %>% \r\n  add_tally(n) %>% \r\n  ungroup() %>% \r\n  mutate(share = n / nn) %>% \r\n  ggplot(aes(year, share, fill = colour)) +\r\n  geom_area(colour = \"black\", size = .2, alpha = .8) +\r\n  scale_fill_manual(values = c(\"#17202A\", \"#2471A3\", \"#800020\", \"#F39C12\", \"#27AE60\", \"#BDC3C7\", \"midnightblue\", \"#C0392B\", \"#95A5A6\", \"#F8F9F9\")) +\r\n  scale_y_continuous(labels = scales::percent_format()) +\r\n  theme(legend.position = \"bottom\",\r\n        panel.grid = element_blank()) +\r\n  labs(title = \"Evolution of car colour in South Africa: 1995-2020\",\r\n       subtitle = \"Based on Gumtree vehicle adverts\",\r\n       x = \"Year of production\",\r\n       y = \"Share of cars in each colour per year\",\r\n       fill = \"\",\r\n       caption = \"Source: Source: Gumtree vehicle adverts scraped in October 2020\\nGraphic: Jonathan Jayes\")\r\n\r\nggplotly(g)\r\n\r\n\r\npreservea3371b1fa08f9b2b\r\n\r\nConclusion\r\nWow! Blue and Green cars really lost out to white and Silver ones over time. Of the cars advertised that were produced in 2020, nearly 42% are white!\r\nBlack cars seemed to have a peak in popularity around 2007, and then decline again, coinciding with the first round of load-shedding in South Africa.\r\nThanks for reading along, and I hope you enjoyed learning about ggplot as well as the cars on South Africa’s roads!\r\nPost script\r\nHere is the static figure with accompanying caption.\r\n\r\nShow code\r\n# jpeg(\r\n#     filename=\"figures/stacked_area_2.jpeg\",\r\n#     width=6,\r\n#     height=4,\r\n#     units=\"in\",\r\n#     res=1000)\r\n\r\ndf_colours %>%\r\n  filter(year > 1994) %>%\r\n  group_by(year) %>%\r\n  add_tally(n) %>%\r\n  ungroup() %>%\r\n  mutate(share = n / nn) %>%\r\n  mutate(colour = fct_relevel(colour, \"Silver\")) %>%\r\n  ggplot(aes(year, share, fill = colour)) +\r\n  geom_area(colour = \"black\", size = .2, alpha = .8) +\r\n  scale_fill_manual(values = c(\"#95A5A6\", \"#17202A\", \"#2471A3\", \"#800020\", \"#F39C12\", \"#27AE60\", \"#BDC3C7\", \"midnightblue\", \"#C0392B\", \"#EAECEE\")) +\r\n  scale_y_continuous(labels = scales::percent_format()) +\r\n  theme(legend.position = \"bottom\",\r\n        panel.grid = element_blank()) +\r\n  labs(title = \"Evolution of car colour in South Africa: 1995-2020\",\r\n       subtitle = \"Based on Gumtree vehicle adverts\",\r\n       x = \"Year of production\",\r\n       y = \"Share of cars in each colour per year\",\r\n       fill = \"\",\r\n       caption = \"Source: Gumtree vehicle adverts scraped in October 2020\\nGraphic: Jonathan Jayes\")\r\n\r\n\r\nShow code\r\n# dev.off()\r\n\r\n\r\n\r\nDistill is a publication format for scientific and technical writing, native to the web.\r\nLearn more about using Distill at https://rstudio.github.io/distill.\r\n\r\n\r\n\r\n",
    "preview": "posts/2021-03-13-south-africa-car-colour-exploration/images/stacked_area.jpeg",
    "last_modified": "2021-03-16T15:37:21+01:00",
    "input_file": "south-africa-car-colour-exploration.utf8.md"
  }
]
