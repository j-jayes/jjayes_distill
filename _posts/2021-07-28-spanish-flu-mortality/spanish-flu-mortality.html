<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
  <title>Draft: Spanish Flu Mortality</title>

  <meta property="description" itemprop="description" content="This paper examines mortality during the Spanish flu pandemic of 1918 in 15 districts in the Cape Province of South Africa."/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2021-07-28"/>
  <meta property="article:created" itemprop="dateCreated" content="2021-07-28"/>
  <meta name="article:author" content="Jonathan Jayes"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Draft: Spanish Flu Mortality"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="This paper examines mortality during the Spanish flu pandemic of 1918 in 15 districts in the Cape Province of South Africa."/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Draft: Spanish Flu Mortality"/>
  <meta property="twitter:description" content="This paper examines mortality during the Spanish flu pandemic of 1918 in 15 districts in the Cape Province of South Africa."/>

  <!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=METHODOLOGICAL NOTE: PREDICTED NUMBERS OF DEATHS BY EPI-WEEK FOR SOUTH AFRICA IN 2020 AND 2021;citation_publication_date=2021;citation_publisher=South African Medical Research Council;citation_author=Rob Dorrington;citation_author=Debbie Bradshaw;citation_author=Ria Laubscher;citation_author=Pam Groenewald;citation_author=Tom Moultrie"/>
  <meta name="citation_reference" content="citation_title=Influenza and pneumonia mortality in 66 large cities in the united states in years surrounding the 1918 pandemic;citation_publication_date=2011;citation_volume=6;citation_author=R. AcuÃ±a-Soto;citation_author=C. Viboud;citation_author=G. Chowell"/>
  <meta name="citation_reference" content="citation_title=Support vector machine;citation_publication_date=2016;citation_publisher=Springer US;citation_doi=10.1007/978-1-4899-7641-3_9;citation_author=Shan Suthaharan"/>
  <meta name="citation_reference" content="citation_title=â€™BLACK OCTOBERâ€™: THE IMPACT OF THE SPANISH INFLUENZA EPIDEMIC OF 1918 ON SOUTH AFRICA;citation_publication_date=1984;citation_publisher=University of Cape Town;citation_author=Howard Phillips"/>
  <meta name="citation_reference" content="citation_title=LIBLINEAR: A library for large linear classification;citation_publication_date=2008;citation_doi=10.1145/1390681.1442794;citation_issn=15324435;citation_author=Rong En Fan;citation_author=Kai Wei Chang;citation_author=Cho Jui Hsieh;citation_author=Xiang Rui Wang;citation_author=Chih Jen Lin"/>
  <meta name="citation_reference" content="citation_title=Disease, downturns, and wellbeing: Economic history and the long-run impacts of COVID-19;citation_publication_date=2021;citation_doi=10.1016/j.eeh.2020.101381;citation_issn=10902457;citation_author=Vellore Arthi;citation_author=John Parman"/>
  <meta name="citation_reference" content="citation_title=Death Certificate of Wills Bunu;citation_publication_date=1918;citation_author=Death Certificate of Wills Bunu"/>
  <meta name="citation_reference" content="citation_title=Statistics of Population of the Union of South Africa 1918 and previous years including vital and health statistics for the year 1916 and previous years;citation_publication_date=1918;citation_author=Statistics of Population of the Union of South Africa 1918 and previous years including vital and health statistics for the year 1916 and previous years"/>
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","preview","author","date","output","bibliography"]}},"value":[{"type":"character","attributes":{},"value":["Draft: Spanish Flu Mortality"]},{"type":"character","attributes":{},"value":["This paper examines mortality during the Spanish flu pandemic of 1918 in 15 districts in the Cape Province of South Africa.\n"]},{"type":"character","attributes":{},"value":["images/ridge-plot.jpeg"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Jonathan Jayes"]}]}]},{"type":"character","attributes":{},"value":["07-28-2021"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","code_folding","highlight","highlight_downlit","toc"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["haddock"]},{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"character","attributes":{},"value":["bibliography.bib"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["bibliography.bib","data/baked_data.rds","data/birth_place_shares.rds","data/births-by-race.xlsx","data/births_by_town.rds","data/child_mortality.rds","data/df_literacy.rds","data/excl-from-article.txt","data/final_fit.rds","data/infant_mortality.rds","data/influenza_mort.rds","data/phillips-comparison-august.rds","data/pneumonia_infleunza_mort.rds","data/pneumonia_influenza.rds","data/pneumonia_mort.rds","data/race_classification.rds","data/race_classification_15000.rds","data/results.rds","data/spanish_flu_data.rds","data/town_race_mort_rates.rds","data/words.rds","images/birth-place-corr.jpeg","images/birth-places.jpeg","images/child-mort-scatter.jpeg","images/child-mortality.jpeg","images/conf-mat-fig.jpeg","images/cradock-paarl-causes.jpeg","images/ethnicity-distribution.jpeg","images/ethnicity-race-classification.jpeg","images/excess-mortality-method-2.jpeg","images/infant-mort-scatter.jpeg","images/infant-mortality.jpeg","images/linear-trend.jpeg","images/literacy-fig.jpeg","images/literacy-scatter.jpeg","images/phillips-comparison-fig.jpeg","images/pneumonia-influenza-mort.jpeg","images/regression-methods.jpeg","images/ridge-plot.jpeg","images/samrc.PNG","images/seasonality.jpeg","images/tuning-fig.jpeg","images/viridis-deaths.jpeg","images/wills_bunu.jpg","images/words-fig.jpeg","infant-mort-scatter.txt","regs/infant-mort-scatter.txt","spanish-flu-mortality_files/anchor-4.2.2/anchor.min.js","spanish-flu-mortality_files/bowser-1.9.3/bowser.min.js","spanish-flu-mortality_files/distill-2.2.21/template.v2.js","spanish-flu-mortality_files/figure-html5/birth-place-corr-1.png","spanish-flu-mortality_files/figure-html5/birth-places-1.png","spanish-flu-mortality_files/figure-html5/child-mort-scatter-1.png","spanish-flu-mortality_files/figure-html5/child-mortality-1.png","spanish-flu-mortality_files/figure-html5/conf-mat-fig-1.png","spanish-flu-mortality_files/figure-html5/cradock-paarl-causes-1.png","spanish-flu-mortality_files/figure-html5/ethnicity-distribution-1.png","spanish-flu-mortality_files/figure-html5/ethnicity-race-classification-1.png","spanish-flu-mortality_files/figure-html5/excess-mortality-method-2-1.png","spanish-flu-mortality_files/figure-html5/infant-mort-scatter-1.png","spanish-flu-mortality_files/figure-html5/infant-mortality-1.png","spanish-flu-mortality_files/figure-html5/linear-trend-1.png","spanish-flu-mortality_files/figure-html5/literacy-fig-1.png","spanish-flu-mortality_files/figure-html5/literacy-scatter-1.png","spanish-flu-mortality_files/figure-html5/phillips-comparison-fig-1.png","spanish-flu-mortality_files/figure-html5/pneumonia-influenza-mort-1.png","spanish-flu-mortality_files/figure-html5/regression-methods-1.png","spanish-flu-mortality_files/figure-html5/seasonality-1.png","spanish-flu-mortality_files/figure-html5/town-density-1.png","spanish-flu-mortality_files/figure-html5/tuning-fig-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-10-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-11-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-12-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-13-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-14-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-15-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-16-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-17-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-18-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-19-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-2-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-20-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-21-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-22-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-23-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-24-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-3-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-31-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-32-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-34-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-35-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-36-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-37-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-38-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-39-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-4-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-40-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-5-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-6-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-7-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-8-1.png","spanish-flu-mortality_files/figure-html5/unnamed-chunk-9-1.png","spanish-flu-mortality_files/figure-html5/viridis-deaths-1.png","spanish-flu-mortality_files/figure-html5/words-fig-1.png","spanish-flu-mortality_files/header-attrs-2.10/header-attrs.js","spanish-flu-mortality_files/header-attrs-2.9/header-attrs.js","spanish-flu-mortality_files/jquery-1.11.3/jquery.min.js","spanish-flu-mortality_files/popper-2.6.0/popper.min.js","spanish-flu-mortality_files/tippy-6.2.7/tippy-bundle.umd.min.js","spanish-flu-mortality_files/tippy-6.2.7/tippy-light-border.css","spanish-flu-mortality_files/tippy-6.2.7/tippy.css","spanish-flu-mortality_files/tippy-6.2.7/tippy.umd.min.js","spanish-flu-mortality_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="spanish-flu-mortality_files/header-attrs-2.10/header-attrs.js"></script>
  <script src="spanish-flu-mortality_files/jquery-1.11.3/jquery.min.js"></script>
  <script src="spanish-flu-mortality_files/popper-2.6.0/popper.min.js"></script>
  <link href="spanish-flu-mortality_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="spanish-flu-mortality_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="spanish-flu-mortality_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="spanish-flu-mortality_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="spanish-flu-mortality_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="spanish-flu-mortality_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="spanish-flu-mortality_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Draft: Spanish Flu Mortality","description":"This paper examines mortality during the Spanish flu pandemic of 1918 in 15 districts in the Cape Province of South Africa.","authors":[{"author":"Jonathan Jayes","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-07-28T00:00:00.000+02:00","citationText":"Jayes, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Draft: Spanish Flu Mortality</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>This paper examines mortality during the Spanish flu pandemic of 1918 in 15 districts in the Cape Province of South Africa.</p></p>
</div>

<div class="d-byline">
  Jonathan Jayes  
  
<br/>07-28-2021
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#the-1918-spanish-flu-pandemic-in-south-africa-assesing-mortality">The 1918 Spanish flu pandemic in South Africa: assesing mortality</a>
<ul>
<li><a href="#abstract">Abstract</a></li>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#historical-background-and-related-literature">Historical background and related literature</a></li>
<li><a href="#data">Data</a>
<ul>
<li><a href="#classification-of-race-from-ethnicity">Classification of race from ethnicity</a></li>
</ul></li>
<li><a href="#how-many-died-during-the-pandemic">How many died during the pandemic?</a>
<ul>
<li><a href="#what-were-the-mortality-rates-in-each-district-during-the-pandemic">What were the mortality rates in each district during the pandemic?</a></li>
</ul></li>
<li><a href="#district-features-correlated-with-pandemic-mortality-rates">District features correlated with pandemic mortality rates</a>
<ul>
<li><a href="#pre-existing-health">Pre-existing health</a></li>
</ul></li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#appendix">Appendix</a>
<ul>
<li><a href="#linear-support-vector-machine-specification-and-workflow">Linear Support Vector Machine specification and workflow</a></li>
<li><a href="#respiratory-disease-deaths">Respiratory disease deaths</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
</div>
<h1 id="the-1918-spanish-flu-pandemic-in-south-africa-assesing-mortality">The 1918 Spanish flu pandemic in South Africa: assesing mortality</h1>
<h2 id="abstract">Abstract</h2>
<p><em>This paper examines mortality during the Spanish flu pandemic of 1918 in 15 districts in the Cape Province of South Africa. I make use of 40,000 digitized Forms of Notice of a Death produced in the Cape districts between 1915 and 1920. I use three methods to assess excess mortality across the districts, and assess the extent to which measures of pre-existing health and social status which are correlated with mortality from the flu. I use a linear support vector machine to collapse the recorded ethnicity of individuals to a three-class race grouping. I find after assessing excess mortality that it is unlikely there was significant under counting of the number of deaths during the Spanish flu pandemic due to misclassification of cause. Regarding the features correlated with pandemic mortality, I find that pre-existing levels of health in a district indicated by child mortality are strongly correlated with mortality rates during the pandemic. I find that district with high levels of mortality from pneumonia and influenza prior to the pandemic suffered severely from mortality during the pandemic. Finally, I find no support for the notion that socio-economic factors proxied by the literacy of a family member or foreign born status are correlated with pandemic mortality rates.</em></p>
<h2 id="introduction">Introduction</h2>
<p>The Spanish flu was one of the worst pre-cursors to the current Covid-19 pandemic, extracting a high death toll on working age populations the world over. The disease spread rapidly, and took a heavy toll on populations with poor pre-existing health conditions, and those who could not take measures to lessen the burden of the disease once infected. It is worth looking back into the past to find out how the pandemic engulfed the civil apparatus who recorded mortality from the flu at the time, as well as trying to identify features that existed in communities prior to the pandemic which were correlated with high mortality during the flu. This is what I attempt in the paper below. I cover some of the literature which guides my investigation, examine excess mortality during the pandemic, and identify features associated with high mortality across 15 districts in the Cape.</p>
<h2 id="historical-background-and-related-literature">Historical background and related literature</h2>
<p>The Spanish flu reached South Africa in mid 1918. A first, less virulent strain spread through Natal and into the Witwatersrand in winter, before a more severe strain gripped the Cape in October of 1918 as soldiers returned from the First World War. Historian Howard Phillips argues that soldiers embarking on the Jaroslav and the Veronej from Freetown in Sierra Leone acquired the disease in port, and brought it with them on their homeward journey before transmitting it to their families and neighbours in the Cape <span class="citation" data-cites="Phillips1984">(<a href="#ref-Phillips1984" role="doc-biblioref">1984, 9</a>)</span>. The Cape was ravaged by the pandemic during “Black October” of 1918, and like populations across the world, working age adults suffered high mortality, threatening livelihoods in the midst of and in the aftermath of the pandemic <span class="citation" data-cites="Arthi2021">(<a href="#ref-Arthi2021" role="doc-biblioref">Arthi and Parman 2021</a>)</span>. <span class="citation" data-cites="Fourie2021"><a href="#ref-Fourie2021" role="doc-biblioref">Fourie and Jayes</a> (<a href="#ref-Fourie2021" role="doc-biblioref">2021</a>)</span> have shown that more than half of those who died during the pandemic in a sample of districts in the Cape were between 18 and 50 years of age, evidencing a “w-shaped” mortality curve, in contrast to the more common “u-shaped” curve. <span class="citation" data-cites="Taubenberger2006"><a href="#ref-Taubenberger2006" role="doc-biblioref">Taubenberger and Morens</a> (<a href="#ref-Taubenberger2006" role="doc-biblioref">2006</a>)</span> show that this pattern held across the world during the 1918 pandemic, with more than half of those recorded dead between 20 and 40 years of age.</p>
<p>In explaining the severity of the disease, <span class="citation" data-cites="Arthi2021"><a href="#ref-Arthi2021" role="doc-biblioref">Arthi and Parman</a> (<a href="#ref-Arthi2021" role="doc-biblioref">2021</a>)</span> note that the novelty of the virus “contributed to its destruction,” detailing the time that it takes for a community to detect the disease, appreciate its epidemiology, create medicines and reach immunity which allowed the flu to rapidly spread and harm populations across the world <span class="citation" data-cites="Arthi2021">(<a href="#ref-Arthi2021" role="doc-biblioref">2021, 13</a>)</span>.</p>
<p>There is strong evidence of an immunizing effect that the less severe Natal strain provided in South Africa, though this was not known at the time. <span class="citation" data-cites="Phillips1984"><a href="#ref-Phillips1984" role="doc-biblioref">Phillips</a> (<a href="#ref-Phillips1984" role="doc-biblioref">1984</a>)</span> cites the Influenza Epidemic Commission of 1919 in South Africa suggest that different strains of organisms caused the two waves of the pandemic in the country, but that regarding the immunizing effect, “no definite pronouncement is possible on this subject” <span class="citation" data-cites="Phillips1984">(<a href="#ref-Phillips1984" role="doc-biblioref">1984, 293</a>)</span>. However, modern research has shown that cross-protection certainly lessened the impact of the flu among those exposed to the earlier, milder variant. <span class="citation" data-cites="Shanks2010"><a href="#ref-Shanks2010" role="doc-biblioref">Shanks, Brundage, and Frean</a> (<a href="#ref-Shanks2010" role="doc-biblioref">2010</a>)</span> compare mortality rates among diamond miners in Kimberley and gold miners on the Rand during Black October. They find a mortality rate 35 times higher among Kimberley’s diamond miners than Rand gold miners which the authors attribute to the formers’ lack of exposure to the less lethal strain earlier in the year. The authors control for the characteristics of the miners in their comparison, including recruitment, working conditions, housing and medical care <span class="citation" data-cites="Shanks2010">(<a href="#ref-Shanks2010" role="doc-biblioref">Shanks, Brundage, and Frean 2010, 2</a>)</span>.</p>
<p>Similarly, in Canada <span class="citation" data-cites="Bogaert2015"><a href="#ref-Bogaert2015" role="doc-biblioref">K. Bogaert</a> (<a href="#ref-Bogaert2015" role="doc-biblioref">2015</a>)</span> studies protection from initial exposure to the less virulent strain among soldiers in the Canadian Expeditionary Force and finds that soldiers who were exposed to pneumonia and influenza prior to the second wave saw 82 percent protection from severe illness and 84 percent protection from death compared to compatriots who were later recruited from rural farming districts and had supposedly not been exposed to the first strain <span class="citation" data-cites="Bogaert2015">(<a href="#ref-Bogaert2015" role="doc-biblioref">2015, 34</a>)</span>. This finding is replicated among military camps in the United States at the time. <span class="citation" data-cites="Barry2008"><a href="#ref-Barry2008" role="doc-biblioref">Barry, Viboud, and Simonsen</a> (<a href="#ref-Barry2008" role="doc-biblioref">2008</a>)</span> find that as early as March 1918, a mild strain of the virus was circulating in military camps and provided naturally acquired immunity to the more virulent strain that followed in the fourth quarter of the year.</p>
<p>There is discussion by <span class="citation" data-cites="Shanks2016"><a href="#ref-Shanks2016" role="doc-biblioref">Shanks and Brundage</a> (<a href="#ref-Shanks2016" role="doc-biblioref">2016</a>)</span> regarding whether the two waves studied in soldiers in Canada, the United States, Australia and South Africa were caused by different viruses or different strains of the same virus, while <span class="citation" data-cites="Bogaert2016"><a href="#ref-Bogaert2016" role="doc-biblioref">K. L. Bogaert</a> (<a href="#ref-Bogaert2016" role="doc-biblioref">2016</a>)</span> argues the distinction does not take away from the crucial point, initial exposure provided protection from the virulent wave in the second half of 1918.</p>
<p>The severity of the October wave may explain why South Africa was spared the third wave of early 1919 detailed by <span class="citation" data-cites="Taubenberger2006"><a href="#ref-Taubenberger2006" role="doc-biblioref">Taubenberger and Morens</a> (<a href="#ref-Taubenberger2006" role="doc-biblioref">2006</a>)</span> and the fourth wave that spread in Asia in mid 1919 noted by <span class="citation" data-cites="Lin2014"><a href="#ref-Lin2014" role="doc-biblioref">Lin and Liu</a> (<a href="#ref-Lin2014" role="doc-biblioref">2014</a>)</span> and <span class="citation" data-cites="Ogasawara2018"><a href="#ref-Ogasawara2018" role="doc-biblioref">Ogasawara</a> (<a href="#ref-Ogasawara2018" role="doc-biblioref">2018</a>)</span> in their analysis of the long-run effects of <em>in utero</em> exposure (in Taiwan and China respectively). <span class="citation" data-cites="Phillips1984"><a href="#ref-Phillips1984" role="doc-biblioref">Phillips</a> (<a href="#ref-Phillips1984" role="doc-biblioref">1984</a>)</span> argues that although the epidemic’s presence was lethal, “it was short-lived and by the middle of November it had virtually abated” <span class="citation" data-cites="Phillips1984">(<a href="#ref-Phillips1984" role="doc-biblioref">1984, 294</a>)</span>.</p>
<p>A wealth of research has sought to examine what features explain the differing levels of mortality in disparate communities during the pandemic. <span class="citation" data-cites="AcuaSoto2011InfluenzaAP"><a href="#ref-AcuaSoto2011InfluenzaAP" role="doc-biblioref">Acuña-Soto, Viboud, and Chowell</a> (<a href="#ref-AcuaSoto2011InfluenzaAP" role="doc-biblioref">2011</a>)</span> examine features correlated with mortality from the flu in 66 large cities across the United States. The authors find that baseline health status was important, as proxied by pre-pandemic pneumonia, which they argue is “a bacterial condition with a strong biological interaction with the influenza virus” and infant mortality rates as a surrogate for population health <span class="citation" data-cites="AcuaSoto2011InfluenzaAP">(<a href="#ref-AcuaSoto2011InfluenzaAP" role="doc-biblioref">2011, 13</a>)</span>. <span class="citation" data-cites="Clay2018"><a href="#ref-Clay2018" role="doc-biblioref">Clay, Lewis, and Severnini</a> (<a href="#ref-Clay2018" role="doc-biblioref">2018</a>)</span> study the effect of pollution from coal fired power plants on pandemic mortality in the United States, and find that poor air quality was “an important cause of mortality during the pandemic” <span class="citation" data-cites="Clay2018">(<a href="#ref-Clay2018" role="doc-biblioref">2018, 79</a>)</span>. The authors find that pollution was a significant contributor to deaths during the pandemic. They find that the magnitude of the effect was approximately half of the effects of pre-existing levels of health in a community. A recent study on fog events in London corroborates the interaction between pollution and mortality from respiratory diseases <span class="citation" data-cites="Hanlon2018LondonFA">(<a href="#ref-Hanlon2018LondonFA" role="doc-biblioref">Hanlon 2018</a>)</span>. <span class="citation" data-cites="Arthi2021"><a href="#ref-Arthi2021" role="doc-biblioref">Arthi and Parman</a> (<a href="#ref-Arthi2021" role="doc-biblioref">2021</a>)</span> in their meta-analysis, as well as <span class="citation" data-cites="Chowell2008"><a href="#ref-Chowell2008" role="doc-biblioref">Chowell et al.</a> (<a href="#ref-Chowell2008" role="doc-biblioref">2008</a>)</span> who study the flu in England and Wales, and <span class="citation" data-cites="Mamelund2006"><a href="#ref-Mamelund2006" role="doc-biblioref">Mamelund</a> (<a href="#ref-Mamelund2006" role="doc-biblioref">2006</a>)</span> who examines the flu in Denmark all find that socio-economic status impact health outcomes. They collectively find that those who live in high density housing, for example the poor in cities, had poorer pre-existing health as measured by cases of and deaths from pneumonia and influenza, and high mortally rates during the pandemic. <span class="citation" data-cites="Clay2018"><a href="#ref-Clay2018" role="doc-biblioref">Clay, Lewis, and Severnini</a> (<a href="#ref-Clay2018" role="doc-biblioref">2018</a>)</span> posit that further socio-economic indicators such as foreign born status and illiteracy may have precluded residents from implementing public health guidelines. <span class="citation" data-cites="Grantz2016"><a href="#ref-Grantz2016" role="doc-biblioref">Grantz et al.</a> (<a href="#ref-Grantz2016" role="doc-biblioref">2016</a>)</span> examine the differential mortality from the pandemic across Chicago and find that higher rates of illiteracy correlated with higher rates of mortality across districts. Importantly, these socio-demographic effects evidenced spillovers, as literate and native born residents in districts with high shares of effects of illiteracy and foreign born residents saw a higher mortality than compatriots with similar observable characteristics <span class="citation" data-cites="Arthi2021">(<a href="#ref-Arthi2021" role="doc-biblioref">Arthi and Parman 2021</a>)</span>.</p>
<h2 id="data">Data</h2>
<p>The sources of data available to a researcher without doubt shape the design of their study. In his authoritative account of the Spanish flu pandemic in South Africa, historian Howard Phillips notes that prior to his own study, “extensive documentation… from [unpublished evidence] in the report of the Government-appointed Commission of Inquiry” had laid on the shelves of the Library of Parliament unexamined <span class="citation" data-cites="Phillips1984">(<a href="#ref-Phillips1984" role="doc-biblioref">1984, 9</a>)</span>. His analysis of this information told the story of the pandemic in a way that had not been told before. Similarly, the digitization of death records allows different kinds of questions about the pandemic of 1918. Specifically it opens up an assessment of excess mortality and an indication of the importance of pre-existing levels of health in determining pandemic mortality rates within the districts of the Cape.</p>
<p>The dataset analysed here is made up of 40,000 digitized Forms of Information of a Death of individuals in 15 districts of the Cape Province between 1915 and 1920. The Forms are recorded as of Act No. 7 of 1894 of the Cape Colony. They contain demographic information about the deceased, details about their death, and details about the informant who told the Registrar about their passing. Most often the informant was a family member, as recorded on the Forms. In this study, the date of death, cause of death and demographics are of particular interest. The years prior to the pandemic serve as a baseline against which to compare excess mortality during the pandemic. There are some limitations regarding the recording of cause of death and duration of last illness. These are discussed in detail in <span class="citation" data-cites="Fourie2021"><a href="#ref-Fourie2021" role="doc-biblioref">Fourie and Jayes</a> (<a href="#ref-Fourie2021" role="doc-biblioref">2021</a>)</span>. In short, where a doctor has tended to the deceased and completed a certificate, the Form will include the pertinent information from the Medical Practitioners certificate. In the absence of such a certificate, the Informant can provide this information if known. The text on the Form reads:</p>
<blockquote>
<p>N.B. – If the certificate of a Medical Practitioner is produced, the causes of Death and Duration of Illness must be recorded in the Registration Book by the Deputy Registrar and Assistant to the Deputy Registrar as stated in such Certificate, which is to be attached to the form.</p>
Source: <span class="citation" data-cites="Civil1918"><a href="#ref-Civil1918" role="doc-biblioref">Civil Deaths 1895-1972 database with images National Archives Pretoria</a> (<a href="#ref-Civil1918" role="doc-biblioref">1918</a>)</span>
</blockquote>
<h3 id="classification-of-race-from-ethnicity">Classification of race from ethnicity</h3>
<p>Race is one important feature of the analysis which follows. As noted in <span class="citation" data-cites="Fourie2021"><a href="#ref-Fourie2021" role="doc-biblioref">Fourie and Jayes</a> (<a href="#ref-Fourie2021" role="doc-biblioref">2021</a>)</span>, health and wealth in the Cape Province of 1918 were “closely correlated to race… with race being a strong predictor of income and social status” <span class="citation" data-cites="Fourie2021">(<a href="#ref-Fourie2021" role="doc-biblioref">2021, 2</a>)</span>. The Forms of Information of a Death provide a field for the race of the deceased to be recorded. However, often ethnicity of the deceased was recorded instead. See for example the record of Wills Bunu, who died in Queenstown on the 26th of October 1918 whose race is recorded as “Fingo.” Fingo is a term for a group of ethnicities who fled Natal in the aftermath of the <em>Mfecane</em> to reside in the Xhosa speaking Eastern region of the Cape <span class="citation" data-cites="Stapleton">(<a href="#ref-Stapleton" role="doc-biblioref">Stapleton 1995, 362</a>)</span>. <span class="citation" data-cites="Mtumane"><a href="#ref-Mtumane" role="doc-biblioref">Mtumane</a> (<a href="#ref-Mtumane" role="doc-biblioref">2017</a>)</span> argues that the Fingo were “were embraced and integrated” by Xhosa in the Eastern Cape by the time of the Spanish flu <span class="citation" data-cites="Mtumane">(<a href="#ref-Mtumane" role="doc-biblioref">Mtumane 2017, 68</a>)</span>. In any event, some categorization has to be done to limit the number of different categories of recorded ethnicity.</p>
<figure>
<img src="images/wills_bunu.jpg" alt="Form of Information of the death of Wills Bunu. Source: Civil Deaths 1895-1972 database with images National Archives Pretoria (1918)" /><figcaption aria-hidden="true">Form of Information of the death of Wills Bunu. Source: <span class="citation" data-cites="Civil1918"><a href="#ref-Civil1918" role="doc-biblioref">Civil Deaths 1895-1972 database with images National Archives Pretoria</a> (<a href="#ref-Civil1918" role="doc-biblioref">1918</a>)</span></figcaption>
</figure>
<p>Further, more than 200 ethnicities appear only once among the records, such that the distribution of observed ethnicities is skewed to the right, with 419 <em>different</em> ethnicities recorded, evident in Figure <a href="#fig:ethnicity-distribution">1</a>.</p>
<aside>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># jpeg(</span>
<span class='co'>#     filename="images/ethnicity-distribution.jpeg",</span>
<span class='co'>#     width=6,</span>
<span class='co'>#     height=4,</span>
<span class='co'>#     units="in",</span>
<span class='co'>#     res=1000)</span>

<span class='va'>df</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>count</span><span class='op'>(</span><span class='va'>race_original</span>, sort <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_histogram</span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"midnightblue"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_log10</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Number of observations of a recorded ethnicity (log scale)"</span>,
       y <span class='op'>=</span> <span class='st'>"Number of ethnicities"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span style="display:block;" id="fig:ethnicity-distribution"></span>
<img src="spanish-flu-mortality_files/figure-html5/ethnicity-distribution-1.png" alt="Distribution of ethnicities recorded on Forms of Information of a Death" width="624" />
<p class="caption">
Figure 1: Distribution of ethnicities recorded on Forms of Information of a Death
</p>
</div>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># dev.off()</span>
</code></pre>
</div>
</details>
</div>
</aside>
<p>To classify these 419 different categorical values down into a more manageable number; 3 broad race groupings in use in the Cape at the time and in South Africa today, I use a combination of regular expression and a linear support vector machine learning algorithm.</p>
<p>To simplify the problem I hand coded the minority class (white) using regular expression (for example, coding “European” and “English” to white), and used a linear support vector machine to classify the remaining observations to black and coloured based on a hand-coded training set. <span class="citation" data-cites="Suthaharan2016"><a href="#ref-Suthaharan2016" role="doc-biblioref">Suthaharan</a> (<a href="#ref-Suthaharan2016" role="doc-biblioref">2016</a>)</span> explains that a linear support vector machine is well suited to binary classification using text data, as it can make use of many sub-word features in a computationally cheap manner. It performs best when the classes in the training set are balanced. Because white individuals make up a minority of the dataset, it is possible to simply hand-code their observations as white and then make use of the machine learning algorithm to classify the remaining roughly equal classes. The binary linear SVM works by dividing the data domain along a hyperplane “to separate classes in the original domain” <span class="citation" data-cites="Suthaharan2016">(<a href="#ref-Suthaharan2016" role="doc-biblioref">Suthaharan 2016, 2</a>)</span>.</p>
<p>The advantage of the linear SVM as opposed to a more flexible machine learning method, for example a neural network, is that the linear SVM is explainable and it is possible to pull out indicators of how the algorithm performs the classification. In this case, I use the sub-word features of the ethnicities as predictors of race. As detailed in the appendix, I achieve an accuracy of 99.8 percent in the classification problem on previously unseen data. This model is a useful research output as the trained model can be employed by other researches faced with similar data and classification problems. Specifics are detailed in the appendix.</p>
<p>The output of the classification process is shown in Figure <a href="#fig:ethnicity-race-classification">23</a> in the appendix for the 12 most common classes for each race.</p>
<h2 id="how-many-died-during-the-pandemic">How many died during the pandemic?</h2>
<p>In quantifying the number of South Africans who died during the pandemic, there were clear challenges to the recording apparatus of the government at the time. <span class="citation" data-cites="Phillips1984"><a href="#ref-Phillips1984" role="doc-biblioref">Phillips</a> (<a href="#ref-Phillips1984" role="doc-biblioref">1984</a>)</span> notes that “even under normal conditions in 1918, the South African government lacked the means to record every death in the country” – a feature which shows up in the infant and child mortality rates that vary widely between districts calculated from the death notices prior to the pandemic <span class="citation" data-cites="Phillips1984">(<a href="#ref-Phillips1984" role="doc-biblioref">Phillips 1984, 288</a>)</span>. Further, there are likely differences in the quality of records that vary with geography; <span class="citation" data-cites="Phillips1984"><a href="#ref-Phillips1984" role="doc-biblioref">Phillips</a> (<a href="#ref-Phillips1984" role="doc-biblioref">1984</a>)</span> notes that the legislation which stipulated the recording of deaths, the 1894 Births and Deaths Registration Act, “in theory applied to all inhabitants, but in practice was largely a dead letter in predominantly Black rural areas” <span class="citation" data-cites="Phillips1984">(<a href="#ref-Phillips1984" role="doc-biblioref">Phillips 1984, 288</a>)</span>. The text contained on the death notices evidence sensible differences in recording standards by geography, with the direction “If informants in municipalities and special urban areas do not appear personally before [District Registrar] proper Declaration must be completed and attached hereto. In <em>Rural</em> Areas Informants can report in <em>three</em> ways – one being under declaration. Medical Certificates essential in Urban Areas” <span class="citation" data-cites="Civil1918">(<a href="#ref-Civil1918" role="doc-biblioref">Civil Deaths 1895-1972 database with images National Archives Pretoria 1918</a>)</span>. Evidently, government officials at the time accounted for the difficulty in recording deaths in rural areas by lessening the requirements. Nonetheless, in comparing pre-pandemic figures with the information presented from the pandemic itself, we require not that under-reporting did not exist, but the less onerous assumption that the level of under-reporting remained constant within each district.</p>
<p>Figure <a href="#fig:viridis-deaths">2</a> shows a heatmap of the frequency of deaths in each district. The pandemic period is striking. Further, we see lighter coloured areas in larger districts like Oudtshoorn and Queenstown which have higher mortality prior to the pandemic (owing to their larger populations and hence greater number of deaths) than small districts such as Elliot and Sea Point.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># jpeg(</span>
<span class='co'>#     filename="images/viridis-deaths.jpeg",</span>
<span class='co'>#     width=6,</span>
<span class='co'>#     height=4,</span>
<span class='co'>#     units="in",</span>
<span class='co'>#     res=1000)</span>

<span class='va'>df</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'>between</span><span class='op'>(</span><span class='va'>death_date</span>, <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1915-01-01"</span><span class='op'>)</span>, <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1920-12-30"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>death_date <span class='op'>=</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='va'>death_date</span>, unit <span class='op'>=</span> <span class='st'>"week"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>count</span><span class='op'>(</span><span class='va'>death_date</span>, <span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>pivot_wider</span><span class='op'>(</span>names_from <span class='op'>=</span> <span class='st'>"town"</span>, values_from <span class='op'>=</span> <span class='st'>"n"</span>, values_fill <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>pivot_longer</span><span class='op'>(</span><span class='op'>-</span><span class='va'>death_date</span>, names_to <span class='op'>=</span> <span class='st'>"town"</span>, values_to <span class='op'>=</span> <span class='st'>"n"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>town <span class='op'>=</span> <span class='fu'>fct_reorder</span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>n</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>death_date</span>, <span class='va'>town</span>, fill <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_tile</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_fill_viridis_c</span><span class='op'>(</span>trans <span class='op'>=</span> <span class='st'>"sqrt"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>
    x <span class='op'>=</span> <span class='cn'>NULL</span>,
    y <span class='op'>=</span> <span class='cn'>NULL</span>,
    fill <span class='op'>=</span> <span class='st'>"Number of deaths per week"</span>
  <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"bottom"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>guides</span><span class='op'>(</span>fill <span class='op'>=</span> <span class='fu'>guide_colourbar</span><span class='op'>(</span>
    barwidth <span class='op'>=</span> <span class='fl'>30</span>, barheight <span class='op'>=</span> <span class='fl'>.5</span>,
    title.position <span class='op'>=</span> <span class='st'>"top"</span>,
    title.hjust <span class='op'>=</span> <span class='fl'>.5</span>
  <span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span style="display:block;" id="fig:viridis-deaths"></span>
<img src="spanish-flu-mortality_files/figure-html5/viridis-deaths-1.png" alt="Heatmap of deaths per week" width="768" />
<p class="caption">
Figure 2: Heatmap of deaths per week
</p>
</div>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># dev.off()</span>
</code></pre>
</div>
</details>
</div>
<p>There is considerable variation in the crude death rate by district during the pandemic, as shown in Figure <a href="#fig:town-density">3</a>. Here we can see two important features of the pandemic in our sample of Cape districts. First, the pandemic arrived in different districts at different times. In districts close to Cape Town and along the train line to Kimberley, where the soldiers arrived soon after they were released from quarantine at port, the virus spread rapidly. The evidence in this paper corroborate that of <span class="citation" data-cites="Phillips1984"><a href="#ref-Phillips1984" role="doc-biblioref">Phillips</a> (<a href="#ref-Phillips1984" role="doc-biblioref">1984</a>)</span> regarding the swift abatement of the virus following the peak in October. Only in Oudtshoorn and Komga do the effects of the flu appear to have lingered, with elevated mortality rates into December of 1918. Second, the rate of death, and likely the spread of the disease, differed between districts. For example, the steep surge of cases in Queenstown contrasts with a sustained deadly spread in Oudtshoorn.</p>
<aside>
Crude death rate is the total number of deaths during a given time interval divided by the population.
</aside>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># jpeg(</span>
<span class='co'>#     filename="images/ridge-plot.jpeg",</span>
<span class='co'>#     width=6,</span>
<span class='co'>#     height=4,</span>
<span class='co'>#     units="in",</span>
<span class='co'>#     res=1000)</span>

<span class='va'>df</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'>between</span><span class='op'>(</span><span class='va'>death_date</span>, <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1918-09-01"</span><span class='op'>)</span>, <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1918-12-30"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>death_date <span class='op'>=</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='va'>death_date</span>, unit <span class='op'>=</span> <span class='st'>"days"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>count</span><span class='op'>(</span><span class='va'>death_date</span>, <span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>pivot_wider</span><span class='op'>(</span>names_from <span class='op'>=</span> <span class='st'>"town"</span>, values_from <span class='op'>=</span> <span class='st'>"n"</span>, values_fill <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>pivot_longer</span><span class='op'>(</span><span class='op'>-</span><span class='va'>death_date</span>, names_to <span class='op'>=</span> <span class='st'>"town"</span>, values_to <span class='op'>=</span> <span class='st'>"n"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>inner_join</span><span class='op'>(</span><span class='va'>df</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'>between</span><span class='op'>(</span><span class='va'>death_date</span>, <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1918-09-01"</span><span class='op'>)</span>, <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1919-08-30"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>death_date <span class='op'>=</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='va'>death_date</span>, unit <span class='op'>=</span> <span class='st'>"3 days"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>count</span><span class='op'>(</span><span class='va'>death_date</span>, <span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>slice_max</span><span class='op'>(</span><span class='va'>n</span>, n <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>arrange</span><span class='op'>(</span><span class='va'>death_date</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>select</span><span class='op'>(</span><span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>row_num <span class='op'>=</span> <span class='fu'>row_number</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>town <span class='op'>=</span> <span class='fu'>fct_reorder</span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>row_num</span>, .desc <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>death_date</span>, y <span class='op'>=</span> <span class='va'>town</span>, height <span class='op'>=</span> <span class='va'>n</span>, fill <span class='op'>=</span> <span class='va'>town</span>, group <span class='op'>=</span> <span class='va'>town</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://wilkelab.org/ggridges/reference/geom_density_ridges.html'>geom_density_ridges</a></span><span class='op'>(</span>
    stat <span class='op'>=</span> <span class='st'>"identity"</span>, show.legend <span class='op'>=</span> <span class='cn'>F</span>,
    alpha <span class='op'>=</span> <span class='fl'>.8</span>
  <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_fill_manual</span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'>wesanderson</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/wesanderson/man/wes_palette.html'>wes_palette</a></span><span class='op'>(</span><span class='st'>"Zissou1"</span>, <span class='fl'>15</span>, type <span class='op'>=</span> <span class='st'>"continuous"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>
    x <span class='op'>=</span> <span class='st'>"Date of death"</span>,
    y <span class='op'>=</span> <span class='cn'>NULL</span>
  <span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span style="display:block;" id="fig:town-density"></span>
<img src="spanish-flu-mortality_files/figure-html5/town-density-1.png" alt="Ridge plot of number of deaths in district by date" width="768" />
<p class="caption">
Figure 3: Ridge plot of number of deaths in district by date
</p>
</div>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># dev.off()</span>
</code></pre>
</div>
</details>
</div>
<h3 id="what-were-the-mortality-rates-in-each-district-during-the-pandemic">What were the mortality rates in each district during the pandemic?</h3>
<h4 id="candidate-methods-for-assessing-excess-mortality.">Candidate methods for assessing (excess) mortality.</h4>
<p>A question that poses some difficulties to answer is how many South Africans died during the pandemic, and how many died specifically of the flu.</p>
<p>A great benefit of the dataset at hand is the recording of a cause of death on the notice. This was either copied from the Certificate of the Medical Practitioner, or in the absence of such a certificate, told to the registrar by the informant. Hence, the most intuitive method to assess how many people died in each district of the Spanish flu is simply to count the number of deaths recorded with “Spanish flu” listed in the cause of death column. However, there are a number of drawbacks to this method.</p>
<ul>
<li>Doctors and families who reported to the registrar the cause of death may not have known that the deaths at the beginning of the pandemic were due to the Spanish flu as news of the disease likely travelled across the country slower than the disease itself, as explained by <span class="citation" data-cites="Arthi2021"><a href="#ref-Arthi2021" role="doc-biblioref">Arthi and Parman</a> (<a href="#ref-Arthi2021" role="doc-biblioref">2021</a>)</span>.</li>
<li>There is likely some selection into the provision of a cause of death by location within a district. As noted in the data explanation, deaths in rural areas were not required to have a certificate of a medical practitioner who would have investigated the death and recorded its cause.</li>
<li>There are discrepancies in the reporting of the disease by district. Contrast for instance the labelling of deaths in Cradock and Paarl. In the top facet of Figure <a href="#fig:cradock-paarl-causes">4</a>, it is evident that the vast majority of deaths during the pandemic are labelled as Spanish flu deaths. In contrast, fewer than half of the deaths that occurred during the pandemic are labelled as Spanish flu deaths in Paarl.</li>
<li>To avoid this complication it is tempting to simply count the number of deaths in each district during the pandemic period and conclude that these were caused by the flu. However, districts of different population sizes would have expected different numbers of deaths in the absence of the pandemic. Hence it is not advisable to conclude that all recorded deaths were due to the flu.</li>
</ul>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># jpeg(</span>
<span class='co'>#     filename="images/cradock-paarl-causes.jpeg",</span>
<span class='co'>#     width=6,</span>
<span class='co'>#     height=4,</span>
<span class='co'>#     units="in",</span>
<span class='co'>#     res=1000)</span>

<span class='va'>df</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'>between</span><span class='op'>(</span><span class='va'>death_date</span>, <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1918-09-01"</span><span class='op'>)</span>, <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1919-01-01"</span><span class='op'>)</span><span class='op'>)</span>,
         <span class='va'>town</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Cradock"</span>, <span class='st'>"Paarl"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>death_date <span class='op'>=</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='va'>death_date</span>, unit <span class='op'>=</span> <span class='st'>"week"</span><span class='op'>)</span>,
         causes_of_death <span class='op'>=</span> <span class='fu'>str_to_lower</span><span class='op'>(</span><span class='va'>causes_of_death</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>spanish <span class='op'>=</span> <span class='fu'>str_detect</span><span class='op'>(</span><span class='va'>causes_of_death</span>, <span class='st'>"spanish"</span><span class='op'>)</span>,
         spanish <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>spanish</span> <span class='op'>==</span> <span class='cn'>TRUE</span>, <span class='st'>"Cause of death labelled 'Spanish flu'"</span>, <span class='st'>"Other cause of death"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>count</span><span class='op'>(</span><span class='va'>death_date</span>, <span class='va'>spanish</span>, <span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>pivot_wider</span><span class='op'>(</span>names_from <span class='op'>=</span> <span class='st'>"spanish"</span>, values_from <span class='op'>=</span> <span class='st'>"n"</span>, values_fill <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>pivot_longer</span><span class='op'>(</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>death_date</span>, <span class='va'>town</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>name</span> <span class='op'>!=</span> <span class='st'>"NA"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>death_date</span>, <span class='va'>value</span>, fill <span class='op'>=</span> <span class='va'>name</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_area</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> 
    <span class='fu'>scale_fill_manual</span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'>wesanderson</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/wesanderson/man/wes_palette.html'>wes_palette</a></span><span class='op'>(</span><span class='st'>"Zissou1"</span>, <span class='fl'>2</span>, type <span class='op'>=</span> <span class='st'>"continuous"</span><span class='op'>)</span>,
                      guide <span class='op'>=</span> <span class='fu'>guide_legend</span><span class='op'>(</span>reverse <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>facet_wrap</span><span class='op'>(</span><span class='op'>~</span> <span class='va'>town</span>, nrow <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"bottom"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='cn'>NULL</span>, 
       y <span class='op'>=</span> <span class='st'>"Number of deaths per week"</span>,
       fill <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span style="display:block;" id="fig:cradock-paarl-causes"></span>
<img src="spanish-flu-mortality_files/figure-html5/cradock-paarl-causes-1.png" alt="Density plot comparing causes of death during the pandemic in Cradock and Paarl" width="768" />
<p class="caption">
Figure 4: Density plot comparing causes of death during the pandemic in Cradock and Paarl
</p>
</div>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># dev.off()</span>
</code></pre>
</div>
</details>
</div>
<p>Table <a href="#tab:cradock-paarl-causes-tab">1</a> evidences that the majority of deaths in Paarl during the pandemic were labelled simply as “Influenza.”</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>df</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span>
    <span class='fu'>between</span><span class='op'>(</span><span class='va'>death_date</span>, <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1918-09-01"</span><span class='op'>)</span>, <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1919-01-01"</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='va'>town</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Cradock"</span>, <span class='st'>"Paarl"</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>count</span><span class='op'>(</span><span class='va'>causes_of_death</span>, <span class='va'>town</span>, sort <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>slice_max</span><span class='op'>(</span><span class='va'>n</span>, n <span class='op'>=</span> <span class='fl'>12</span>, with_ties <span class='op'>=</span> <span class='cn'>F</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span>Cradock <span class='op'>=</span> <span class='va'>causes_of_death</span>, n_cradock <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='fl'>12</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>bind_cols</span><span class='op'>(</span><span class='va'>df</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span>
      <span class='fu'>between</span><span class='op'>(</span><span class='va'>death_date</span>, <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1918-09-01"</span><span class='op'>)</span>, <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1919-01-01"</span><span class='op'>)</span><span class='op'>)</span>,
      <span class='va'>town</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Cradock"</span>, <span class='st'>"Paarl"</span><span class='op'>)</span>
    <span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>count</span><span class='op'>(</span><span class='va'>causes_of_death</span>, <span class='va'>town</span>, sort <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>slice_max</span><span class='op'>(</span><span class='va'>n</span>, n <span class='op'>=</span> <span class='fl'>12</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>select</span><span class='op'>(</span>Paarl <span class='op'>=</span> <span class='va'>causes_of_death</span>, n_paarl <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>tail</a></span><span class='op'>(</span><span class='fl'>12</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>knitr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span>caption <span class='op'>=</span> <span class='st'>"Comparison of common causes of death in Cradock and Paarl during the pandemic"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<table>
<caption><span id="tab:cradock-paarl-causes-tab">Table 1: </span>Comparison of common causes of death in Cradock and Paarl during the pandemic</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Cradock</th>
<th style="text-align: right;">n_cradock</th>
<th style="text-align: left;">Paarl</th>
<th style="text-align: right;">n_paarl</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Spanish Influenza</td>
<td style="text-align: right;">444</td>
<td style="text-align: left;">Influenza</td>
<td style="text-align: right;">367</td>
</tr>
<tr class="even">
<td style="text-align: left;">Flu</td>
<td style="text-align: right;">21</td>
<td style="text-align: left;">Spanish Influenza</td>
<td style="text-align: right;">247</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Influenza</td>
<td style="text-align: right;">20</td>
<td style="text-align: left;">Pneumonia</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bronchitis</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">Spanish Influenza, Pneumonia</td>
<td style="text-align: right;">17</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Broncho Pneumonia</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">Convulsions</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: left;">Convulsions</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">Spaanse Griep</td>
<td style="text-align: right;">15</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Teething</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">Spanish Influenza (Pneumonia)</td>
<td style="text-align: right;">15</td>
</tr>
<tr class="even">
<td style="text-align: left;">Diarrhoea</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">Bronchitis</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Old age</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">Broncho Pneumonia</td>
<td style="text-align: right;">13</td>
</tr>
<tr class="even">
<td style="text-align: left;">Consumption</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">Gastro Enteritis</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Inflammation of lungs</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">Spanish Flu</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pneumonia</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">A) Spanish Influenza B) Pneumonia</td>
<td style="text-align: right;">11</td>
</tr>
</tbody>
</table>
</div>
<p>An alternate set of methods for quantifying excess mortality use history as a guide for the number of deaths that we can expect to occur in each district. I use three methods wherein the mortality figures for three years preceding the pandemic are used as a guide, first looking at the average number of deaths in each district during the pandemic peak (October, November and December), second taking an average of the whole year mortality in each district, and third creating regression models with the historical data to predict the expected number of deaths in the pandemic period. I explain each below.</p>
<p>First, making use of the death notices from 1915 to 1917 and following the methodology laid out by the South Africa Medical Research Council (SAMRC) in <span class="citation" data-cites="Dorrington2021"><a href="#ref-Dorrington2021" role="doc-biblioref">Dorrington et al.</a> (<a href="#ref-Dorrington2021" role="doc-biblioref">2021</a>)</span>, I calculate the average number of deaths per month in each town during the pandemic peak of October, November and December in the three preceding years as a baseline. The SAMRC define excess mortality is calculated as “the number of all-cause deaths in the last week less the number that might have been expected to have occurred” <span class="citation" data-cites="Dorrington2021">(<a href="#ref-Dorrington2021" role="doc-biblioref">Dorrington et al. 2021, 2</a>)</span>. I widen the bandwidth from one week to one month due to the coarsity of the data at district level. The resulting smoother estimates have less noise and appear reasonable. I then subtract this expected number of deaths from the observed number during the pandemic to calculate excess mortality during the 3 months of pandemic peak in 1918. The advantage of this method is that it captures the seasonal variation in mortality, as shown in Figure <a href="#fig:seasonality">6</a>. It is interesting to note that the the smoothed line shows a peak in mortality in the third quarter of the year in the Cape between 1915 and 1920. This is in contrast to the seasonal pattern in mortality in South Africa as a whole in since 2015 as shown by <span class="citation" data-cites="Dorrington2021"><a href="#ref-Dorrington2021" role="doc-biblioref">Dorrington et al.</a> (<a href="#ref-Dorrington2021" role="doc-biblioref">2021</a>)</span> which displays a dramatic peak during mid-winter shown in <a href="#fig:samrc-pattern">5</a>.</p>
<aside>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>knitr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/knitr/man/include_graphics.html'>include_graphics</a></span><span class='op'>(</span><span class='st'>'images/samrc.PNG'</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span style="display:block;" id="fig:samrc-pattern"></span>
<img src="images/samrc.PNG" alt="Seasonal pattern in mortality in South Africa" width="40%" />
<p class="caption">
Figure 5: Seasonal pattern in mortality in South Africa
</p>
</div>
</div>
Source: <span class="citation" data-cites="Dorrington2021"><a href="#ref-Dorrington2021" role="doc-biblioref">Dorrington et al.</a> (<a href="#ref-Dorrington2021" role="doc-biblioref">2021</a>)</span>
</aside>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># jpeg(</span>
<span class='co'>#     filename="images/seasonality.jpeg",</span>
<span class='co'>#     width=6,</span>
<span class='co'>#     height=4,</span>
<span class='co'>#     units="in",</span>
<span class='co'>#     res=1000)</span>

<span class='va'>df</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>sf_indicator</span> <span class='op'>==</span><span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate</span><span class='op'>(</span>death_date <span class='op'>=</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='va'>death_date</span>, <span class='st'>"week"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>count</span><span class='op'>(</span><span class='va'>death_date</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate</span><span class='op'>(</span>year <span class='op'>=</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/year.html'>year</a></span><span class='op'>(</span><span class='va'>death_date</span><span class='op'>)</span>,
           week <span class='op'>=</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/week.html'>week</a></span><span class='op'>(</span><span class='va'>death_date</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>year</span> <span class='op'>!=</span> <span class='fl'>1918</span>,
           <span class='va'>year</span> <span class='op'>&gt;</span> <span class='fl'>1914</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>week</span>, <span class='va'>n</span>, colour <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span>, group <span class='op'>=</span> <span class='va'>year</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_line</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_vline</span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>40</span>, <span class='fl'>44</span><span class='op'>)</span>, lty <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_smooth</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>group <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>expand_limits</span><span class='op'>(</span>y <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>scale_color_manual</span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'>wesanderson</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/wesanderson/man/wes_palette.html'>wes_palette</a></span><span class='op'>(</span><span class='fl'>5</span>, name <span class='op'>=</span> <span class='st'>"Zissou1"</span>, type <span class='op'>=</span> <span class='st'>"continuous"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Week of the year"</span>,
         y <span class='op'>=</span> <span class='st'>"Number of deaths per week"</span>,
         colour <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"bottom"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span style="display:block;" id="fig:seasonality"></span>
<img src="spanish-flu-mortality_files/figure-html5/seasonality-1.png" alt="Mortality by week across districts - excluding 1918" width="768" />
<p class="caption">
Figure 6: Mortality by week across districts - excluding 1918
</p>
</div>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># dev.off()</span>
</code></pre>
</div>
</details>
</div>
<p>This first method results in estimates of excess mortality shown in Table <a href="#tab:samrc-method-tab">2</a>. Here it is evident that while the largest number of deaths occurred in Queenstown and Paarl, the districts of Peddie and Elliot saw more than 10 times as many deaths as they had in the period between October and December in the three years preceding the pandemic.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>df_samrc</span> <span class='op'>&lt;-</span> <span class='va'>df</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>
    week <span class='op'>=</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/week.html'>week</a></span><span class='op'>(</span><span class='va'>death_date</span><span class='op'>)</span>,
    year <span class='op'>=</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/year.html'>year</a></span><span class='op'>(</span><span class='va'>death_date</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span>
    <span class='fu'>between</span><span class='op'>(</span><span class='va'>week</span>, <span class='fl'>40</span>, <span class='fl'>53</span><span class='op'>)</span>,
    <span class='va'>death_date</span> <span class='op'>&lt;</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1918-01-01"</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>count</span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>year</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>mean_deaths_1915_1917 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>distinct</span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>mean_deaths_1915_1917</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>inner_join</span><span class='op'>(</span><span class='va'>df</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>
      week <span class='op'>=</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/week.html'>week</a></span><span class='op'>(</span><span class='va'>death_date</span><span class='op'>)</span>,
      year <span class='op'>=</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/year.html'>year</a></span><span class='op'>(</span><span class='va'>death_date</span><span class='op'>)</span>
    <span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span>
      <span class='fu'>between</span><span class='op'>(</span><span class='va'>week</span>, <span class='fl'>40</span>, <span class='fl'>53</span><span class='op'>)</span>,
      <span class='va'>year</span> <span class='op'>==</span> <span class='fl'>1918</span>
    <span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>count</span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>year</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>rename</span><span class='op'>(</span>deaths_1918 <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span>, by <span class='op'>=</span> <span class='st'>"town"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='op'>-</span><span class='va'>year</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>arrange</span><span class='op'>(</span><span class='fu'>desc</span><span class='op'>(</span><span class='va'>deaths_1918</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>
    excess_mortality <span class='op'>=</span> <span class='va'>deaths_1918</span> <span class='op'>-</span> <span class='va'>mean_deaths_1915_1917</span>,
    <span class='fu'>across</span><span class='op'>(</span><span class='fu'>where</span><span class='op'>(</span><span class='va'>is.numeric</span><span class='op'>)</span>, <span class='va'>round</span><span class='op'>)</span>,
    excess_mort_perc <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/label_percent.html'>percent</a></span><span class='op'>(</span><span class='va'>excess_mortality</span> <span class='op'>/</span> <span class='va'>mean_deaths_1915_1917</span>, accuracy <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
  <span class='op'>)</span>

<span class='va'>df_samrc</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>knitr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span>
    col.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"District"</span>, <span class='st'>"Pre-pandemic mean"</span>, <span class='st'>"Pandemic period"</span>, <span class='st'>"Excess mortality"</span>, <span class='st'>"Percent excess mortality"</span><span class='op'>)</span>,
    caption <span class='op'>=</span> <span class='st'>"Excess mortality based on SAMRC method"</span>,
    align <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"l"</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>'r'</span>, <span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
</details>
<table>
<caption><span id="tab:samrc-method-tab">Table 2: </span>Excess mortality based on SAMRC method</caption>
<colgroup>
<col style="width: 14%" />
<col style="width: 20%" />
<col style="width: 17%" />
<col style="width: 19%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">District</th>
<th style="text-align: right;">Pre-pandemic mean</th>
<th style="text-align: right;">Pandemic period</th>
<th style="text-align: right;">Excess mortality</th>
<th style="text-align: right;">Percent excess mortality</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Queenstown</td>
<td style="text-align: right;">266</td>
<td style="text-align: right;">1211</td>
<td style="text-align: right;">945</td>
<td style="text-align: right;">355%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Paarl</td>
<td style="text-align: right;">187</td>
<td style="text-align: right;">951</td>
<td style="text-align: right;">764</td>
<td style="text-align: right;">409%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Peddie</td>
<td style="text-align: right;">75</td>
<td style="text-align: right;">831</td>
<td style="text-align: right;">756</td>
<td style="text-align: right;">1 008%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Stellenbosch</td>
<td style="text-align: right;">157</td>
<td style="text-align: right;">816</td>
<td style="text-align: right;">659</td>
<td style="text-align: right;">420%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Stockenstrom</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">708</td>
<td style="text-align: right;">618</td>
<td style="text-align: right;">687%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Oudtshoorn</td>
<td style="text-align: right;">245</td>
<td style="text-align: right;">646</td>
<td style="text-align: right;">401</td>
<td style="text-align: right;">164%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mafeking</td>
<td style="text-align: right;">101</td>
<td style="text-align: right;">627</td>
<td style="text-align: right;">526</td>
<td style="text-align: right;">521%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Komga</td>
<td style="text-align: right;">73</td>
<td style="text-align: right;">593</td>
<td style="text-align: right;">520</td>
<td style="text-align: right;">712%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Cradock</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">551</td>
<td style="text-align: right;">441</td>
<td style="text-align: right;">401%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Elliot</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">432</td>
<td style="text-align: right;">399</td>
<td style="text-align: right;">1 209%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Vryburg</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">300</td>
<td style="text-align: right;">242</td>
<td style="text-align: right;">417%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kuruman</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">276</td>
<td style="text-align: right;">212</td>
<td style="text-align: right;">331%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fraserburg</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">152</td>
<td style="text-align: right;">97</td>
<td style="text-align: right;">176%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Riversdale</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">84</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">53%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sea Point</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">21%</td>
</tr>
</tbody>
</table>
</div>
<p>Second, I follow the methodology of <span class="citation" data-cites="AcuaSoto2011InfluenzaAP"><a href="#ref-AcuaSoto2011InfluenzaAP" role="doc-biblioref">Acuña-Soto, Viboud, and Chowell</a> (<a href="#ref-AcuaSoto2011InfluenzaAP" role="doc-biblioref">2011</a>)</span> who define excess mortality as “deaths observed during the pandemic years minus the average death counts in the pre-pandemic years” <span class="citation" data-cites="AcuaSoto2011InfluenzaAP">(<a href="#ref-AcuaSoto2011InfluenzaAP" role="doc-biblioref">Acuña-Soto, Viboud, and Chowell 2011, 23</a>)</span>. While these authors had access to seven years of data preceding the pandemic, I calculate a simple average of the number of deaths per year in each district in the three prior years and subtract the number of deaths in 1918. Table <a href="#tab:mean-mortality-by-district-tab">3</a> shows the mortality by district from 1915 to 1917, and the average across these three years.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>df_acuasoto</span> <span class='op'>&lt;-</span> <span class='va'>df</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>death_date</span> <span class='op'>&lt;</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1918-01-01"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>year <span class='op'>=</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/year.html'>year</a></span><span class='op'>(</span><span class='va'>death_date</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>count</span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>year</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>average <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>pivot_wider</span><span class='op'>(</span>names_from <span class='op'>=</span> <span class='st'>"year"</span>, values_from <span class='op'>=</span> <span class='st'>"n"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>relocate</span><span class='op'>(</span><span class='va'>average</span>, .after <span class='op'>=</span> <span class='va'>`1917`</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span><span class='fu'>across</span><span class='op'>(</span><span class='op'>-</span><span class='va'>town</span>, <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>.</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>inner_join</span><span class='op'>(</span><span class='va'>df</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>year <span class='op'>=</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/year.html'>year</a></span><span class='op'>(</span><span class='va'>death_date</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>year</span> <span class='op'>==</span> <span class='fl'>1918</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>count</span><span class='op'>(</span><span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>rename</span><span class='op'>(</span>`1918` <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>
    excess_mortality <span class='op'>=</span> <span class='va'>`1918`</span> <span class='op'>-</span> <span class='va'>average</span>,
    excess_mort_perc <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/label_percent.html'>percent</a></span><span class='op'>(</span><span class='va'>excess_mortality</span> <span class='op'>/</span> <span class='va'>average</span>, accuracy <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>arrange</span><span class='op'>(</span><span class='fu'>desc</span><span class='op'>(</span><span class='va'>excess_mortality</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>df_acuasoto</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>knitr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span>
    caption <span class='op'>=</span> <span class='st'>"Excess mortality based on Acuña-Soto, Viboud, and Chowell method"</span>,
    col.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"District"</span>, <span class='st'>"1915"</span>, <span class='st'>"1916"</span>, <span class='st'>"1917"</span>, <span class='st'>"'15-'17 Average"</span>, <span class='st'>"1918"</span>, <span class='st'>"Excess mortality"</span>, <span class='st'>"Percent excess mortality"</span><span class='op'>)</span>,
    align <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"l"</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>"r"</span>, <span class='fl'>7</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
</details>
<table>
<caption><span id="tab:mean-mortality-by-district-tab">Table 3: </span>Excess mortality based on Acuña-Soto, Viboud, and Chowell method</caption>
<colgroup>
<col style="width: 14%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 17%" />
<col style="width: 5%" />
<col style="width: 18%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">District</th>
<th style="text-align: right;">1915</th>
<th style="text-align: right;">1916</th>
<th style="text-align: right;">1917</th>
<th style="text-align: right;">’15-’17 Average</th>
<th style="text-align: right;">1918</th>
<th style="text-align: right;">Excess mortality</th>
<th style="text-align: right;">Percent excess mortality</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Peddie</td>
<td style="text-align: right;">266</td>
<td style="text-align: right;">264</td>
<td style="text-align: right;">270</td>
<td style="text-align: right;">267</td>
<td style="text-align: right;">1048</td>
<td style="text-align: right;">781</td>
<td style="text-align: right;">293%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Queenstown</td>
<td style="text-align: right;">843</td>
<td style="text-align: right;">1083</td>
<td style="text-align: right;">849</td>
<td style="text-align: right;">925</td>
<td style="text-align: right;">1701</td>
<td style="text-align: right;">776</td>
<td style="text-align: right;">84%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Paarl</td>
<td style="text-align: right;">731</td>
<td style="text-align: right;">715</td>
<td style="text-align: right;">755</td>
<td style="text-align: right;">734</td>
<td style="text-align: right;">1474</td>
<td style="text-align: right;">740</td>
<td style="text-align: right;">101%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Stockenstrom</td>
<td style="text-align: right;">264</td>
<td style="text-align: right;">331</td>
<td style="text-align: right;">335</td>
<td style="text-align: right;">310</td>
<td style="text-align: right;">942</td>
<td style="text-align: right;">632</td>
<td style="text-align: right;">204%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Stellenbosch</td>
<td style="text-align: right;">503</td>
<td style="text-align: right;">556</td>
<td style="text-align: right;">604</td>
<td style="text-align: right;">554</td>
<td style="text-align: right;">1165</td>
<td style="text-align: right;">611</td>
<td style="text-align: right;">110%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Oudtshoorn</td>
<td style="text-align: right;">816</td>
<td style="text-align: right;">768</td>
<td style="text-align: right;">1019</td>
<td style="text-align: right;">868</td>
<td style="text-align: right;">1413</td>
<td style="text-align: right;">545</td>
<td style="text-align: right;">63%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Komga</td>
<td style="text-align: right;">241</td>
<td style="text-align: right;">338</td>
<td style="text-align: right;">301</td>
<td style="text-align: right;">293</td>
<td style="text-align: right;">823</td>
<td style="text-align: right;">530</td>
<td style="text-align: right;">181%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mafeking</td>
<td style="text-align: right;">344</td>
<td style="text-align: right;">382</td>
<td style="text-align: right;">344</td>
<td style="text-align: right;">357</td>
<td style="text-align: right;">781</td>
<td style="text-align: right;">424</td>
<td style="text-align: right;">119%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Elliot</td>
<td style="text-align: right;">97</td>
<td style="text-align: right;">143</td>
<td style="text-align: right;">104</td>
<td style="text-align: right;">115</td>
<td style="text-align: right;">525</td>
<td style="text-align: right;">410</td>
<td style="text-align: right;">357%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cradock</td>
<td style="text-align: right;">378</td>
<td style="text-align: right;">400</td>
<td style="text-align: right;">382</td>
<td style="text-align: right;">387</td>
<td style="text-align: right;">757</td>
<td style="text-align: right;">370</td>
<td style="text-align: right;">96%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Vryburg</td>
<td style="text-align: right;">198</td>
<td style="text-align: right;">214</td>
<td style="text-align: right;">187</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">453</td>
<td style="text-align: right;">253</td>
<td style="text-align: right;">126%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kuruman</td>
<td style="text-align: right;">182</td>
<td style="text-align: right;">247</td>
<td style="text-align: right;">194</td>
<td style="text-align: right;">208</td>
<td style="text-align: right;">424</td>
<td style="text-align: right;">216</td>
<td style="text-align: right;">104%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fraserburg</td>
<td style="text-align: right;">244</td>
<td style="text-align: right;">230</td>
<td style="text-align: right;">192</td>
<td style="text-align: right;">222</td>
<td style="text-align: right;">260</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">17%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Riversdale</td>
<td style="text-align: right;">199</td>
<td style="text-align: right;">203</td>
<td style="text-align: right;">204</td>
<td style="text-align: right;">202</td>
<td style="text-align: right;">213</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">5%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sea Point</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">23%</td>
</tr>
</tbody>
</table>
</div>
<p>Figure <a href="#fig:excess-mortality-method-2">7</a> shows the excess mortality based on method two. Here we can see that Peddie and Elliot stand out with large excess mortality relative to their mean mortality preceding the pandemic.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># jpeg(</span>
<span class='co'>#     filename="images/excess-mortality-method-2.jpeg",</span>
<span class='co'>#     width=6,</span>
<span class='co'>#     height=4,</span>
<span class='co'>#     units="in",</span>
<span class='co'>#     res=1000)</span>

<span class='va'>df</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>year <span class='op'>=</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/year.html'>year</a></span><span class='op'>(</span><span class='va'>death_date</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>count</span><span class='op'>(</span><span class='va'>year</span>, <span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>year</span> <span class='op'>==</span> <span class='fl'>1918</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>rename</span><span class='op'>(</span>deaths_1918 <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>inner_join</span><span class='op'>(</span>
    <span class='va'>df</span> <span class='op'>%&gt;%</span>
      <span class='fu'>mutate</span><span class='op'>(</span>year <span class='op'>=</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/year.html'>year</a></span><span class='op'>(</span><span class='va'>death_date</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>count</span><span class='op'>(</span><span class='va'>year</span>, <span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>year</span> <span class='op'>&lt;=</span> <span class='fl'>1917</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>summarise</span><span class='op'>(</span>avg_deaths_1915_1917 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='op'>-</span><span class='va'>year</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>town <span class='op'>=</span> <span class='fu'>fct_reorder</span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>deaths_1918</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>pivot_longer</span><span class='op'>(</span><span class='op'>-</span><span class='va'>town</span>, names_to <span class='op'>=</span> <span class='st'>"type"</span>, values_to <span class='op'>=</span> <span class='st'>"deaths"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>type <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span>
    
    <span class='fu'>str_detect</span><span class='op'>(</span><span class='va'>type</span>, <span class='st'>"deaths_1918"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Mortality in 1918"</span>,
    <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='st'>"Mean mortality between 1915 and 1917"</span>
  <span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>deaths</span>, <span class='va'>town</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>group <span class='op'>=</span> <span class='va'>town</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>colour <span class='op'>=</span> <span class='va'>type</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_continuous</span><span class='op'>(</span>labels <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/label_number.html'>number_format</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"bottom"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>
    colour <span class='op'>=</span> <span class='cn'>NULL</span>,
    caption <span class='op'>=</span> <span class='st'>"Length of line represents absolute excess mortality"</span>,
    y <span class='op'>=</span> <span class='cn'>NULL</span>,
    x <span class='op'>=</span> <span class='st'>"Mortality"</span>
  <span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span style="display:block;" id="fig:excess-mortality-method-2"></span>
<img src="spanish-flu-mortality_files/figure-html5/excess-mortality-method-2-1.png" alt="Excess mortality based on methodology by @AcuaSoto2011InfluenzaAP" width="768" />
<p class="caption">
Figure 7: Excess mortality based on methodology by <span class="citation" data-cites="AcuaSoto2011InfluenzaAP"><a href="#ref-AcuaSoto2011InfluenzaAP" role="doc-biblioref">Acuña-Soto, Viboud, and Chowell</a> (<a href="#ref-AcuaSoto2011InfluenzaAP" role="doc-biblioref">2011</a>)</span>
</p>
</div>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># dev.off()</span>
</code></pre>
</div>
</details>
</div>
<p>Third, I use regression models to extrapolate the mortality we would expect in each district if the historical trends from 1915 to 1917 continued.</p>
<p>I use three regression models. These are linear model with only an intercept - in effect the same as the averaging procedure from above. Specifically, I average the number of deaths in the year in the three years prior to 1918 as a guide for the average number of deaths per district.</p>
<p>Next, I use a simple linear regression. This accounts, for instance, for population growth and consequent linear increases in the number of registered deaths per district per year that we would expect with a larger population.</p>
<aside>
<p>The linear trend is shown in Figure <a href="#fig:linear-trend">8</a> here, alongside a line of equality:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/slowkow/ggrepel'>ggrepel</a></span><span class='op'>)</span>

<span class='co'># jpeg(</span>
<span class='co'>#     filename="images/linear-trend.jpeg",</span>
<span class='co'>#     width=6,</span>
<span class='co'>#     height=4,</span>
<span class='co'>#     units="in",</span>
<span class='co'>#     res=1000)</span>

<span class='va'>df</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>year <span class='op'>=</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/year.html'>year</a></span><span class='op'>(</span><span class='va'>death_date</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>count</span><span class='op'>(</span><span class='va'>year</span>, <span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>year</span> <span class='op'>&lt;=</span> <span class='fl'>1917</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>nest</span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>year</span>, <span class='va'>n</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>lm_fit <span class='op'>=</span> <span class='fu'>map</span><span class='op'>(</span><span class='va'>data</span>, <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>n</span> <span class='op'>~</span> <span class='va'>year</span>, data <span class='op'>=</span> <span class='va'>.x</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>inner_join</span><span class='op'>(</span>
    <span class='va'>df</span> <span class='op'>%&gt;%</span>
      <span class='fu'>mutate</span><span class='op'>(</span>year <span class='op'>=</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/year.html'>year</a></span><span class='op'>(</span><span class='va'>death_date</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>count</span><span class='op'>(</span><span class='va'>year</span>, <span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>year</span> <span class='op'>&gt;</span> <span class='fl'>1917</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>nest</span><span class='op'>(</span>post_data <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>year</span>, <span class='va'>n</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>augmented <span class='op'>=</span> <span class='fu'>map2</span><span class='op'>(</span><span class='va'>lm_fit</span>, <span class='va'>post_data</span>, <span class='op'>~</span> <span class='fu'><a href='https://generics.r-lib.org/reference/augment.html'>augment</a></span><span class='op'>(</span><span class='va'>.x</span>, newdata <span class='op'>=</span> <span class='va'>.y</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>unnest</span><span class='op'>(</span><span class='va'>augmented</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>year</span> <span class='op'>==</span> <span class='fl'>1918</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>.fitted</span>, <span class='va'>n</span>, label <span class='op'>=</span> <span class='fu'>str_to_title</span><span class='op'>(</span><span class='va'>town</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_abline</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_smooth</span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"lm"</span>, se <span class='op'>=</span> <span class='cn'>F</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html'>geom_text_repel</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>
    x <span class='op'>=</span> <span class='st'>"Predicted 1918 mortality based on linear trend"</span>,
    y <span class='op'>=</span> <span class='st'>"Observed 1918 mortality"</span>
  <span class='op'>)</span> 
</code></pre>
</div>
</details>
<div class="figure"><span style="display:block;" id="fig:linear-trend"></span>
<img src="spanish-flu-mortality_files/figure-html5/linear-trend-1.png" alt="Linear trend for predicted and excess mortality" width="768" />
<p class="caption">
Figure 8: Linear trend for predicted and excess mortality
</p>
</div>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># dev.off()</span>
</code></pre>
</div>
</details>
</div>
<p>Is appears that towns with higher predicted mortality in 1918 based on the linear trend have higher actual mortality in 1918.</p>
</aside>
<p>Further I use a regression model from Serfling that accounts for the seasonality of respiratory diseases like flu and influenza. According to <span class="citation" data-cites="Cowling2006"><a href="#ref-Cowling2006" role="doc-biblioref">Cowling et al.</a> (<a href="#ref-Cowling2006" role="doc-biblioref">2006</a>)</span>, “Serfling’s method uses cyclic regression to model the weekly proportion of deaths from pneumonia and influenza and to define an epidemic threshold that is adjusted for seasonal effects.” <span class="citation" data-cites="Cowling2006">(<a href="#ref-Cowling2006" role="doc-biblioref">2006, 4</a>)</span>.</p>
<p>Figure <a href="#fig:regression-methods">9</a> shows the mean and predicted ranges of expected mortality based on the three methods, as well as the observed pandemic mortality. It is evident that the districts with larger populations also have a larger range in the mortality protections. Oudtshoorn has a wide range in the projected mortality, followed by Paarl and Queenstown.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>df_reg</span> <span class='op'>&lt;-</span> <span class='va'>df</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>date <span class='op'>=</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='va'>death_date</span>, <span class='st'>"week"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>count</span><span class='op'>(</span><span class='va'>date</span>, <span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>date</span> <span class='op'>&lt;=</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1918-01-01"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>nest</span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>date</span>, <span class='va'>n</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>
    lm_fit <span class='op'>=</span> <span class='fu'>map</span><span class='op'>(</span><span class='va'>data</span>, <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>n</span> <span class='op'>~</span> <span class='va'>date</span>, data <span class='op'>=</span> <span class='va'>.x</span><span class='op'>)</span><span class='op'>)</span>,
    q_fit <span class='op'>=</span> <span class='fu'>map</span><span class='op'>(</span><span class='va'>data</span>, <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>n</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/stats/poly.html'>poly</a></span><span class='op'>(</span><span class='va'>date</span>, <span class='fl'>2</span><span class='op'>)</span>, data <span class='op'>=</span> <span class='va'>.x</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>inner_join</span><span class='op'>(</span>
    <span class='va'>df</span> <span class='op'>%&gt;%</span>
      <span class='fu'>mutate</span><span class='op'>(</span>date <span class='op'>=</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='va'>death_date</span>, <span class='st'>"week"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>count</span><span class='op'>(</span><span class='va'>date</span>, <span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>date</span> <span class='op'>&gt;=</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1918-01-01"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>nest</span><span class='op'>(</span>post_data <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>date</span>, <span class='va'>n</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>
    augmented_lm <span class='op'>=</span> <span class='fu'>map2</span><span class='op'>(</span><span class='va'>lm_fit</span>, <span class='va'>post_data</span>, <span class='op'>~</span> <span class='fu'><a href='https://generics.r-lib.org/reference/augment.html'>augment</a></span><span class='op'>(</span><span class='va'>.x</span>, newdata <span class='op'>=</span> <span class='va'>.y</span><span class='op'>)</span><span class='op'>)</span>,
    augmented_q <span class='op'>=</span> <span class='fu'>map2</span><span class='op'>(</span><span class='va'>q_fit</span>, <span class='va'>post_data</span>, <span class='op'>~</span> <span class='fu'><a href='https://generics.r-lib.org/reference/augment.html'>augment</a></span><span class='op'>(</span><span class='va'>.x</span>, newdata <span class='op'>=</span> <span class='va'>.y</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>unnest</span><span class='op'>(</span><span class='va'>augmented_lm</span>, <span class='va'>augmented_q</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'>between</span><span class='op'>(</span><span class='va'>date</span>, <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1918-01-01"</span><span class='op'>)</span>, <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1918-12-31"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>date</span>, <span class='va'>n</span>, <span class='va'>.fitted</span>, <span class='va'>.fitted1</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>rename</span><span class='op'>(</span>
    linear_trend <span class='op'>=</span> <span class='va'>.fitted</span>,
    seasonal_trend <span class='op'>=</span> <span class='va'>.fitted1</span>,
    observed <span class='op'>=</span> <span class='va'>n</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span><span class='fu'>across</span><span class='op'>(</span><span class='va'>observed</span><span class='op'>:</span><span class='va'>seasonal_trend</span>, .fns <span class='op'>=</span> <span class='va'>sum</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>distinct</span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>observed</span>, <span class='va'>linear_trend</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>inner_join</span><span class='op'>(</span><span class='va'>df</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate</span><span class='op'>(</span>death_date <span class='op'>=</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/round_date.html'>floor_date</a></span><span class='op'>(</span><span class='va'>death_date</span>, <span class='st'>"month"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>count</span><span class='op'>(</span><span class='va'>death_date</span>, <span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>death_date</span> <span class='op'>&lt;</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1918-09-01"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>summarise</span><span class='op'>(</span>mean_deaths <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>,
              n <span class='op'>=</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>mean_deaths <span class='op'>=</span> <span class='fl'>12</span> <span class='op'>*</span> <span class='va'>mean_deaths</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>inner_join</span><span class='op'>(</span><span class='va'>df</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'>between</span><span class='op'>(</span><span class='va'>death_date</span>, <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1915-10-01"</span><span class='op'>)</span>, <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1915-12-31"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>count</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>n_1915 <span class='op'>=</span> <span class='va'>n</span><span class='op'>*</span><span class='fl'>3</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='op'>-</span><span class='va'>n</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>inner_join</span><span class='op'>(</span><span class='va'>df</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'>between</span><span class='op'>(</span><span class='va'>death_date</span>, <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1916-10-01"</span><span class='op'>)</span>, <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1916-12-31"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>count</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>n_1916 <span class='op'>=</span> <span class='va'>n</span><span class='op'>*</span><span class='fl'>3</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>select</span><span class='op'>(</span><span class='op'>-</span><span class='va'>n</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>inner_join</span><span class='op'>(</span><span class='va'>df</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'>between</span><span class='op'>(</span><span class='va'>death_date</span>, <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1917-10-01"</span><span class='op'>)</span>, <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1917-12-31"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>count</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>n_1917 <span class='op'>=</span> <span class='va'>n</span><span class='op'>*</span><span class='fl'>3</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>select</span><span class='op'>(</span><span class='op'>-</span><span class='va'>n</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>pivot_longer</span><span class='op'>(</span><span class='op'>-</span><span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span><span class='fu'>across</span><span class='op'>(</span><span class='va'>value</span>, .fns <span class='op'>=</span> <span class='va'>mean</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>distinct</span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>value</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>rename</span><span class='op'>(</span>mean_deaths_oct_dec <span class='op'>=</span> <span class='va'>value</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>town <span class='op'>=</span> <span class='fu'>fct_reorder</span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>observed</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_longer</span><span class='op'>(</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>observed</span><span class='op'>)</span>, names_to <span class='op'>=</span> <span class='st'>"type"</span>, values_to <span class='op'>=</span> <span class='st'>"n"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>type <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span>
    <span class='fu'>str_detect</span><span class='op'>(</span><span class='va'>type</span>, <span class='st'>"linear"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Linear trend in deaths per month"</span>,
    <span class='fu'>str_detect</span><span class='op'>(</span><span class='va'>type</span>, <span class='st'>"mean_deaths_oct_dec"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Average number of deaths per month (Oct-Dec)"</span>,
    <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='st'>"Average number of deaths per month"</span>
  <span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>mean_projected_deaths <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span>

<span class='co'># jpeg(</span>
<span class='co'>#     filename="images/regression-methods.jpeg",</span>
<span class='co'>#     width=6,</span>
<span class='co'>#     height=4,</span>
<span class='co'>#     units="in",</span>
<span class='co'>#     res=1000)</span>

<span class='va'>df_reg</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>n</span>, <span class='va'>town</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_line</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>group <span class='op'>=</span> <span class='va'>town</span>, colour <span class='op'>=</span> <span class='st'>"Estimate range from regression models"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>observed</span>, <span class='va'>town</span>, shape <span class='op'>=</span> <span class='st'>"Observed pandemic mortality"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>mean_projected_deaths</span>, <span class='va'>town</span>, shape <span class='op'>=</span> <span class='st'>"Mean projected mortality"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_color_manual</span><span class='op'>(</span>values <span class='op'>=</span> <span class='st'>"grey50"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>guides</span><span class='op'>(</span>color <span class='op'>=</span> <span class='fu'>guide_legend</span><span class='op'>(</span>order <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>,
         shape <span class='op'>=</span> <span class='fu'>guide_legend</span><span class='op'>(</span>order <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>
    x <span class='op'>=</span> <span class='st'>"Mortality"</span>,
    colour <span class='op'>=</span> <span class='cn'>NULL</span>,
    shape <span class='op'>=</span> <span class='cn'>NULL</span>,
    y <span class='op'>=</span> <span class='cn'>NULL</span>
  <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"bottom"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span style="display:block;" id="fig:regression-methods"></span>
<img src="spanish-flu-mortality_files/figure-html5/regression-methods-1.png" alt="Excess mortality based on regression methods" width="768" />
<p class="caption">
Figure 9: Excess mortality based on regression methods
</p>
</div>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># dev.off()</span>
</code></pre>
</div>
</details>
</div>
<p>In Table <a href="#tab:regression-tab-range">4</a> I show the excess mortality based on these regression methods. The estimates of excess mortality are similar to the estimates produced following the Acua-Soto methodology. The excess mortality percentages are lower than that calculated by following the SAMRC methodology due to a lower smaller detonator in calculating the latter, just the three months of the pandemic peak.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>df_reg</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>distinct</span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>mean_projected_deaths</span>, <span class='va'>observed</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>excess_mortality <span class='op'>=</span> <span class='va'>observed</span> <span class='op'>-</span> <span class='va'>mean_projected_deaths</span>,
         <span class='fu'>across</span><span class='op'>(</span><span class='fu'>where</span><span class='op'>(</span><span class='va'>is.numeric</span><span class='op'>)</span>, .fns <span class='op'>=</span> <span class='va'>round</span><span class='op'>)</span>,
         excess_mortality_pct <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/label_percent.html'>percent</a></span><span class='op'>(</span><span class='va'>excess_mortality</span> <span class='op'>/</span> <span class='va'>mean_projected_deaths</span>, accuracy <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>arrange</span><span class='op'>(</span><span class='fu'>desc</span><span class='op'>(</span><span class='va'>excess_mortality</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># mutate(across(where(is.numeric), .fns = ~ scales::number_format(.x, accuracy = 1))) %&gt;%</span>
  <span class='fu'>knitr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span>col.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"District"</span>, <span class='st'>"Projected"</span>, <span class='st'>"Observed"</span>, <span class='st'>"Excess"</span>, <span class='st'>" Percentage excess"</span><span class='op'>)</span>,
               caption <span class='op'>=</span> <span class='st'>"Excess mortality based on regression methods"</span>,
               align <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"l"</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>"r"</span>, <span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<table>
<caption><span id="tab:regression-tab-range">Table 4: </span>Excess mortality based on regression methods</caption>
<thead>
<tr class="header">
<th style="text-align: left;">District</th>
<th style="text-align: right;">Projected</th>
<th style="text-align: right;">Observed</th>
<th style="text-align: right;">Excess</th>
<th style="text-align: right;">Percentage excess</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Queenstown</td>
<td style="text-align: right;">1693</td>
<td style="text-align: right;">886</td>
<td style="text-align: right;">807</td>
<td style="text-align: right;">91%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Paarl</td>
<td style="text-align: right;">1465</td>
<td style="text-align: right;">675</td>
<td style="text-align: right;">790</td>
<td style="text-align: right;">117%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Peddie</td>
<td style="text-align: right;">1048</td>
<td style="text-align: right;">259</td>
<td style="text-align: right;">789</td>
<td style="text-align: right;">305%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Stockenstrom</td>
<td style="text-align: right;">946</td>
<td style="text-align: right;">325</td>
<td style="text-align: right;">621</td>
<td style="text-align: right;">191%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Stellenbosch</td>
<td style="text-align: right;">1170</td>
<td style="text-align: right;">550</td>
<td style="text-align: right;">620</td>
<td style="text-align: right;">113%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Komga</td>
<td style="text-align: right;">827</td>
<td style="text-align: right;">283</td>
<td style="text-align: right;">544</td>
<td style="text-align: right;">192%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Oudtshoorn</td>
<td style="text-align: right;">1410</td>
<td style="text-align: right;">910</td>
<td style="text-align: right;">500</td>
<td style="text-align: right;">55%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mafeking</td>
<td style="text-align: right;">781</td>
<td style="text-align: right;">332</td>
<td style="text-align: right;">449</td>
<td style="text-align: right;">135%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Elliot</td>
<td style="text-align: right;">527</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">415</td>
<td style="text-align: right;">371%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cradock</td>
<td style="text-align: right;">763</td>
<td style="text-align: right;">364</td>
<td style="text-align: right;">399</td>
<td style="text-align: right;">110%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Vryburg</td>
<td style="text-align: right;">455</td>
<td style="text-align: right;">191</td>
<td style="text-align: right;">264</td>
<td style="text-align: right;">138%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kuruman</td>
<td style="text-align: right;">427</td>
<td style="text-align: right;">220</td>
<td style="text-align: right;">207</td>
<td style="text-align: right;">94%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fraserburg</td>
<td style="text-align: right;">264</td>
<td style="text-align: right;">178</td>
<td style="text-align: right;">86</td>
<td style="text-align: right;">48%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Riversdale</td>
<td style="text-align: right;">214</td>
<td style="text-align: right;">189</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">13%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sea Point</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6%</td>
</tr>
</tbody>
</table>
</div>
<p>Table <a href="#tab:excess-mort-comparison-tab">5</a> shows the differences in the number and percentage estimates of excess mortality produced following the three methods detailed above. The estimates differ between the methods, and there is not a clear relationship amongst the different methods as to which produces the largest across all the districts.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>df_excess_mort_comp</span> <span class='op'>&lt;-</span> <span class='va'>df_samrc</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>town</span>,
    excess_mortality_samrc <span class='op'>=</span> <span class='va'>excess_mortality</span>,
    excess_mort_perc_samrc <span class='op'>=</span> <span class='va'>excess_mort_perc</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>inner_join</span><span class='op'>(</span><span class='va'>df_acuasoto</span> <span class='op'>%&gt;%</span>
    <span class='fu'>select</span><span class='op'>(</span><span class='va'>town</span>,
      excess_mortality_acuasoto <span class='op'>=</span> <span class='va'>excess_mortality</span>,
      excess_mort_perc_acuasoto <span class='op'>=</span> <span class='va'>excess_mort_perc</span>
    <span class='op'>)</span>, by <span class='op'>=</span> <span class='st'>"town"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>inner_join</span><span class='op'>(</span><span class='va'>df_reg</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>
      excess_mortality <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>observed</span> <span class='op'>-</span> <span class='va'>mean_projected_deaths</span>, <span class='fl'>0</span><span class='op'>)</span>,
      excess_mort_perc <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/label_percent.html'>percent</a></span><span class='op'>(</span><span class='va'>excess_mortality</span> <span class='op'>/</span> <span class='va'>mean_projected_deaths</span><span class='op'>)</span>
    <span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>mutate</span><span class='op'>(</span>
      excess_mortality_regression <span class='op'>=</span> <span class='va'>excess_mortality</span>,
      excess_mort_perc_regression <span class='op'>=</span> <span class='va'>excess_mort_perc</span>
    <span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>select</span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>excess_mortality_regression</span>, <span class='va'>excess_mort_perc_regression</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>distinct</span><span class='op'>(</span><span class='op'>)</span>, by <span class='op'>=</span> <span class='st'>"town"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>arrange</span><span class='op'>(</span><span class='fu'>desc</span><span class='op'>(</span><span class='va'>excess_mortality_acuasoto</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>df_excess_mort_comp</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>knitr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span>col.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"District"</span>, <span class='st'>"SAMRC"</span>, <span class='st'>"SAMRC"</span>, <span class='st'>"Acua-Soto"</span>, <span class='st'>"Acua-Soto"</span>, <span class='st'>"Regression"</span>, <span class='st'>"Regression"</span><span class='op'>)</span>,
               caption <span class='op'>=</span> <span class='st'>"Comparison of excess mortality estimates"</span>,
               align <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"l"</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>"r"</span>, <span class='fl'>6</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<table>
<caption><span id="tab:excess-mort-comparison-tab">Table 5: </span>Comparison of excess mortality estimates</caption>
<thead>
<tr class="header">
<th style="text-align: left;">District</th>
<th style="text-align: right;">SAMRC</th>
<th style="text-align: right;">SAMRC</th>
<th style="text-align: right;">Acua-Soto</th>
<th style="text-align: right;">Acua-Soto</th>
<th style="text-align: right;">Regression</th>
<th style="text-align: right;">Regression</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Peddie</td>
<td style="text-align: right;">756</td>
<td style="text-align: right;">1 008%</td>
<td style="text-align: right;">781</td>
<td style="text-align: right;">293%</td>
<td style="text-align: right;">789</td>
<td style="text-align: right;">305.1%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Queenstown</td>
<td style="text-align: right;">945</td>
<td style="text-align: right;">355%</td>
<td style="text-align: right;">776</td>
<td style="text-align: right;">84%</td>
<td style="text-align: right;">807</td>
<td style="text-align: right;">91.1%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Paarl</td>
<td style="text-align: right;">764</td>
<td style="text-align: right;">409%</td>
<td style="text-align: right;">740</td>
<td style="text-align: right;">101%</td>
<td style="text-align: right;">790</td>
<td style="text-align: right;">117.0%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Stockenstrom</td>
<td style="text-align: right;">618</td>
<td style="text-align: right;">687%</td>
<td style="text-align: right;">632</td>
<td style="text-align: right;">204%</td>
<td style="text-align: right;">621</td>
<td style="text-align: right;">191.0%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Stellenbosch</td>
<td style="text-align: right;">659</td>
<td style="text-align: right;">420%</td>
<td style="text-align: right;">611</td>
<td style="text-align: right;">110%</td>
<td style="text-align: right;">620</td>
<td style="text-align: right;">112.8%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Oudtshoorn</td>
<td style="text-align: right;">401</td>
<td style="text-align: right;">164%</td>
<td style="text-align: right;">545</td>
<td style="text-align: right;">63%</td>
<td style="text-align: right;">500</td>
<td style="text-align: right;">55.0%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Komga</td>
<td style="text-align: right;">520</td>
<td style="text-align: right;">712%</td>
<td style="text-align: right;">530</td>
<td style="text-align: right;">181%</td>
<td style="text-align: right;">544</td>
<td style="text-align: right;">192.5%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mafeking</td>
<td style="text-align: right;">526</td>
<td style="text-align: right;">521%</td>
<td style="text-align: right;">424</td>
<td style="text-align: right;">119%</td>
<td style="text-align: right;">449</td>
<td style="text-align: right;">135.3%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Elliot</td>
<td style="text-align: right;">399</td>
<td style="text-align: right;">1 209%</td>
<td style="text-align: right;">410</td>
<td style="text-align: right;">357%</td>
<td style="text-align: right;">415</td>
<td style="text-align: right;">370.6%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cradock</td>
<td style="text-align: right;">441</td>
<td style="text-align: right;">401%</td>
<td style="text-align: right;">370</td>
<td style="text-align: right;">96%</td>
<td style="text-align: right;">399</td>
<td style="text-align: right;">109.7%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Vryburg</td>
<td style="text-align: right;">242</td>
<td style="text-align: right;">417%</td>
<td style="text-align: right;">253</td>
<td style="text-align: right;">126%</td>
<td style="text-align: right;">264</td>
<td style="text-align: right;">138.6%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kuruman</td>
<td style="text-align: right;">212</td>
<td style="text-align: right;">331%</td>
<td style="text-align: right;">216</td>
<td style="text-align: right;">104%</td>
<td style="text-align: right;">207</td>
<td style="text-align: right;">94.0%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fraserburg</td>
<td style="text-align: right;">97</td>
<td style="text-align: right;">176%</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">17%</td>
<td style="text-align: right;">86</td>
<td style="text-align: right;">48.4%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Riversdale</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">53%</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">5%</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">13.2%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sea Point</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">21%</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">23%</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5.8%</td>
</tr>
</tbody>
</table>
</div>
<p>In an effort to contextualize these estimates, I compare the excess mortality figures in each town with the number of deaths recorded as caused by respiratory diseases<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, as well as figures from the Pandemic Commission of Inquiry referenced by <span class="citation" data-cites="Phillips1984"><a href="#ref-Phillips1984" role="doc-biblioref">Phillips</a> (<a href="#ref-Phillips1984" role="doc-biblioref">1984</a>)</span>.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>phillips</span> <span class='op'>&lt;-</span> <span class='fu'>read_rds</span><span class='op'>(</span><span class='st'>"data/phillips-comparison-august.rds"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>janitor</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/janitor/man/clean_names.html'>clean_names</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>stat <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span>
    <span class='fu'>str_detect</span><span class='op'>(</span><span class='va'>stat</span>, <span class='st'>"Deaths from Death Notices"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Respiratory deaths during pandemic"</span>,
    <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='st'>"Estimates cited in Phillips"</span>
  <span class='op'>)</span><span class='op'>)</span>

<span class='co'># jpeg(</span>
<span class='co'>#     filename="images/phillips-comparison-fig.jpeg",</span>
<span class='co'>#     width=6,</span>
<span class='co'>#     height=4,</span>
<span class='co'>#     units="in",</span>
<span class='co'>#     res=1000)</span>

<span class='va'>df_excess_mort_comp</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='op'>!</span><span class='fu'>contains</span><span class='op'>(</span><span class='st'>"perc"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>pivot_longer</span><span class='op'>(</span><span class='op'>-</span><span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>value <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>value</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>value</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>distinct</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>stat <span class='op'>=</span> <span class='st'>"Mean estimated excess mortality"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>bind_rows</span><span class='op'>(</span><span class='va'>phillips</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>town <span class='op'>=</span> <span class='fu'>fct_reorder</span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>value</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>town</span> <span class='op'>!=</span> <span class='st'>"Sea Point"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>stat <span class='op'>=</span> <span class='fu'>fct_relevel</span><span class='op'>(</span><span class='va'>stat</span>, <span class='st'>"Estimates cited in Phillips"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>value</span>, <span class='va'>town</span>, fill <span class='op'>=</span> <span class='va'>stat</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"bottom"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_col</span><span class='op'>(</span>position <span class='op'>=</span> <span class='st'>"dodge"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_fill_manual</span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'>wesanderson</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/wesanderson/man/wes_palette.html'>wes_palette</a></span><span class='op'>(</span><span class='fl'>3</span>, name <span class='op'>=</span> <span class='st'>"Zissou1"</span>, type <span class='op'>=</span> <span class='st'>"continuous"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>fill <span class='op'>=</span> <span class='cn'>NULL</span>,
       y <span class='op'>=</span> <span class='cn'>NULL</span>,
       x <span class='op'>=</span> <span class='st'>"Number of deaths"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>guides</span><span class='op'>(</span>fill <span class='op'>=</span> <span class='fu'>guide_legend</span><span class='op'>(</span>nrow <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span style="display:block;" id="fig:phillips-comparison-fig"></span>
<img src="spanish-flu-mortality_files/figure-html5/phillips-comparison-fig-1.png" alt="Comparison of excess mortality estimates, respiratory deaths and government estimates" width="768" />
<p class="caption">
Figure 10: Comparison of excess mortality estimates, respiratory deaths and government estimates
</p>
</div>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># dev.off()</span>
</code></pre>
</div>
</details>
</div>
<p>Here we observe that in the districts with larger populations, the estimates cited in <span class="citation" data-cites="Phillips1984"><a href="#ref-Phillips1984" role="doc-biblioref">Phillips</a> (<a href="#ref-Phillips1984" role="doc-biblioref">1984</a>)</span> are greater than both the number of respiratory deaths, and the mean excess mortality calculated with the three methods detailed above. In contrast, in the smaller districts, from Fryburg to Riversdale, the number of deaths from respiratory illness recorded during the pandemic are greater than the estimates cited in <span class="citation" data-cites="Phillips1984"><a href="#ref-Phillips1984" role="doc-biblioref">Phillips</a> (<a href="#ref-Phillips1984" role="doc-biblioref">1984</a>)</span>. This is potentially indicative of under counting on the part of the Commission of Inquiry in the smaller districts.</p>
<p>In all districts, my estimated excess mortality values are lower than the other two estimates. This means that we need not be concerned about under counting of pandemic deaths, if they are not recorded as such. We would be concerned about this if the excess mortality exceeded the estimates of Spanish flu deaths. In the remainder of the paper I calculate mortality and mortality rates based on respiratory deaths during the pandemic.</p>
<h2 id="district-features-correlated-with-pandemic-mortality-rates">District features correlated with pandemic mortality rates</h2>
<h3 id="pre-existing-health">Pre-existing health</h3>
<p>A wealth of literature has shown that there is a strong correlation between the level of health and prevalence of illnesses in different communities and their outcomes facing a pandemic.</p>
<p>I examine two measures of pre-existing health in the 15 districts which constitute the sample. The first uses infant and child mortality statistics as a proxy for the level of existing health and healthcare in a district. The second assess mortality from influenza and pneumonia prior to the pandemic to gauge levels of health in different communities.</p>
<h4 id="pre-pandemic-infant-and-child-mortality-rates">Pre-pandemic infant and child mortality rates</h4>
<p>I begin with a proxy for pre-existing health in a district by calculating the infant mortality rate prior to the pandemic. I make use of the recorded infant deaths between January 1915 and December 1917, divided by the population of infants in each district as recorded in the Statistics of Population, Vital and Health Statistics of 1916 <span class="citation" data-cites="OfficeofCensusandStatisticsPretoria1918">(<a href="#ref-OfficeofCensusandStatisticsPretoria1918" role="doc-biblioref">Office of Census and Statistics Pretoria 1918</a>)</span>. I extrapolate the full population of infants each year by multiplying the 1916 figure by three. This snapshot of the infants born in 1916 could be critiqued as unrepresentative of birth in the two surrounding years, yet it is the best data available.</p>
<p>Table <a href="#tab:births-tab">6</a> shows the number of births in 1916 in each district, by race, multiplied by 3. Figure <a href="#fig:infant-mortality">11</a> shows these figures with a confidence interval around them. It is clear that there is heterogeneity in infant mortality by race and district, such that this may be correlated with pandemic mortality rates. While the infant mortality rates may appear very high, it is possible that there is under-reporting in the number of births by district, while the death of a child is so tragic that it is recorded at a higher rate than the birth of a child. It is not prescient to conclude on these anomalies without additional sources of data.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>births_by_town</span> <span class='op'>&lt;-</span> <span class='fu'>read_rds</span><span class='op'>(</span><span class='st'>"data/births_by_town.rds"</span><span class='op'>)</span>

<span class='va'>df_infant</span> <span class='op'>&lt;-</span> <span class='va'>births_by_town</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='op'>-</span><span class='va'>total</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>pivot_longer</span><span class='op'>(</span><span class='op'>-</span><span class='va'>town</span>, names_to <span class='op'>=</span> <span class='st'>"race"</span>, values_to <span class='op'>=</span> <span class='st'>"births"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>race <span class='op'>=</span> <span class='fu'>str_to_title</span><span class='op'>(</span><span class='va'>race</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>births <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>births</span> <span class='op'>==</span> <span class='fl'>0</span>, <span class='fl'>1</span>, <span class='va'>births</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># for the three years</span>
  <span class='fu'>mutate</span><span class='op'>(</span>births <span class='op'>=</span> <span class='fl'>3</span><span class='op'>*</span><span class='va'>births</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>inner_join</span><span class='op'>(</span><span class='va'>df</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span>
      <span class='va'>death_date</span> <span class='op'>&lt;</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1918-01-01"</span><span class='op'>)</span>,
      <span class='va'>age_years</span> <span class='op'>&lt;=</span> <span class='fl'>1</span>,
      <span class='va'>race</span> <span class='op'>!=</span> <span class='st'>"NA"</span>
    <span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>count</span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>race</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>rename</span><span class='op'>(</span>deaths <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span>, by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"town"</span>, <span class='st'>"race"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>infant_mort_rate <span class='op'>=</span> <span class='va'>deaths</span><span class='op'>/</span><span class='va'>births</span>,
         low <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Beta.html'>qbeta</a></span><span class='op'>(</span><span class='fl'>.025</span>, <span class='va'>deaths</span> <span class='op'>+</span> <span class='fl'>.5</span>, <span class='va'>births</span> <span class='op'>-</span> <span class='va'>deaths</span> <span class='op'>+</span> <span class='fl'>.5</span><span class='op'>)</span>,
         high <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Beta.html'>qbeta</a></span><span class='op'>(</span><span class='fl'>.975</span>, <span class='va'>deaths</span> <span class='op'>+</span> <span class='fl'>.5</span>, <span class='va'>births</span> <span class='op'>-</span> <span class='va'>deaths</span> <span class='op'>+</span> <span class='fl'>.5</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>births</span> <span class='op'>&gt;</span> <span class='fl'>5</span><span class='op'>)</span>

<span class='va'>df_infant</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>births_grouped <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>births</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>,
         deaths_grouped <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>deaths</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>infant_mort_rate_grouped <span class='op'>=</span> <span class='va'>deaths_grouped</span> <span class='op'>/</span> <span class='va'>births_grouped</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>race</span>, <span class='va'>infant_mort_rate</span>, <span class='va'>infant_mort_rate_grouped</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_wider</span><span class='op'>(</span>names_from <span class='op'>=</span> <span class='st'>"race"</span>, values_from <span class='op'>=</span> <span class='st'>"infant_mort_rate"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span><span class='fu'>across</span><span class='op'>(</span><span class='fu'>where</span><span class='op'>(</span><span class='va'>is.numeric</span><span class='op'>)</span>, .fns <span class='op'>=</span> <span class='op'>~</span> <span class='va'>.x</span><span class='op'>*</span><span class='fl'>1000</span><span class='op'>)</span>,
         <span class='fu'>across</span><span class='op'>(</span><span class='fu'>where</span><span class='op'>(</span><span class='va'>is.numeric</span><span class='op'>)</span>, .fns <span class='op'>=</span> <span class='va'>round</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>arrange</span><span class='op'>(</span><span class='fu'>desc</span><span class='op'>(</span><span class='va'>infant_mort_rate_grouped</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>knitr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span>col.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"District"</span>, <span class='st'>"Aggregate"</span>, <span class='st'>"White"</span>, <span class='st'>"Black"</span>, <span class='st'>"Coloured"</span><span class='op'>)</span>,
               caption <span class='op'>=</span> <span class='st'>"Infant mortality by race"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<table>
<caption><span id="tab:births-tab">Table 6: </span>Infant mortality by race</caption>
<thead>
<tr class="header">
<th style="text-align: left;">District</th>
<th style="text-align: right;">Aggregate</th>
<th style="text-align: right;">White</th>
<th style="text-align: right;">Black</th>
<th style="text-align: right;">Coloured</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Stockenstrom</td>
<td style="text-align: right;">346</td>
<td style="text-align: right;">130</td>
<td style="text-align: right;">448</td>
<td style="text-align: right;">221</td>
</tr>
<tr class="even">
<td style="text-align: left;">Queenstown</td>
<td style="text-align: right;">313</td>
<td style="text-align: right;">76</td>
<td style="text-align: right;">425</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Cradock</td>
<td style="text-align: right;">286</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">450</td>
<td style="text-align: right;">320</td>
</tr>
<tr class="even">
<td style="text-align: left;">Elliot</td>
<td style="text-align: right;">257</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">574</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Oudtshoorn</td>
<td style="text-align: right;">225</td>
<td style="text-align: right;">106</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">320</td>
</tr>
<tr class="even">
<td style="text-align: left;">Stellenbosch</td>
<td style="text-align: right;">210</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">243</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Paarl</td>
<td style="text-align: right;">203</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">239</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mafeking</td>
<td style="text-align: right;">190</td>
<td style="text-align: right;">96</td>
<td style="text-align: right;">223</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fraserburg</td>
<td style="text-align: right;">178</td>
<td style="text-align: right;">85</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">293</td>
</tr>
<tr class="even">
<td style="text-align: left;">Komga</td>
<td style="text-align: right;">169</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">180</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Riversdale</td>
<td style="text-align: right;">156</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">220</td>
</tr>
<tr class="even">
<td style="text-align: left;">Peddie</td>
<td style="text-align: right;">144</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">144</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Kuruman</td>
<td style="text-align: right;">132</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">165</td>
<td style="text-align: right;">204</td>
</tr>
<tr class="even">
<td style="text-align: left;">Vryburg</td>
<td style="text-align: right;">75</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">159</td>
<td style="text-align: right;">32</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sea Point</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">52</td>
</tr>
</tbody>
</table>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># jpeg(</span>
<span class='co'>#     filename="images/infant-mortality.jpeg",</span>
<span class='co'>#     width=6,</span>
<span class='co'>#     height=6,</span>
<span class='co'>#     units="in",</span>
<span class='co'>#     res=1000)</span>

<span class='va'>df_infant</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>town <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/tidytext/man/reorder_within.html'>reorder_within</a></span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>infant_mort_rate</span>, <span class='va'>race</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>infant_mort_rate</span>, <span class='va'>town</span>, colour <span class='op'>=</span> <span class='va'>race</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_errorbarh</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>low</span>, xmax <span class='op'>=</span> <span class='va'>high</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://rdrr.io/pkg/tidytext/man/reorder_within.html'>scale_y_reordered</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_continuous</span><span class='op'>(</span>labels <span class='op'>=</span> <span class='fu'>number_format</span><span class='op'>(</span>scale <span class='op'>=</span> <span class='fl'>1000</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_color_manual</span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'>wesanderson</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/wesanderson/man/wes_palette.html'>wes_palette</a></span><span class='op'>(</span><span class='fl'>3</span>, name <span class='op'>=</span> <span class='st'>"Zissou1"</span>, type <span class='op'>=</span> <span class='st'>"continuous"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_wrap</span><span class='op'>(</span><span class='op'>~</span> <span class='va'>race</span>, nrow <span class='op'>=</span> <span class='fl'>3</span>, scales <span class='op'>=</span> <span class='st'>"free_y"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Infant mortality per 1000 recorded births"</span>,
       y <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span style="display:block;" id="fig:infant-mortality"></span>
<img src="spanish-flu-mortality_files/figure-html5/infant-mortality-1.png" alt="Infant mortality per 1000 children" width="768" />
<p class="caption">
Figure 11: Infant mortality per 1000 children
</p>
</div>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># dev.off()</span>
</code></pre>
</div>
</details>
</div>
<p>Figure <a href="#fig:infant-mort-scatter">12</a> shows the relationship between infant mortality rates (detailed above) and pandemic mortality rates, calculated by dividing the number of respiratory deaths from the Forms by the population of individuals by race in each district from the 1911 census (in the case of black and coloured individuals) and the 1918 census (in the case of white individuals, conducted just prior to the pandemic). The aggregation of black and coloured mortality rates is a function of the denominator (population) reported in the census in aggregate.</p>
<p>Figure <a href="#fig:infant-mort-scatter">12</a> evidences a strong linear correlation between infant mortality rates and pandemic mortality rates across districts for black and coloured individuals, and across groups. The slope of the linear fit is less among white residents of the 14 districts<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>infant_mortality</span> <span class='op'>&lt;-</span> <span class='fu'>read_rds</span><span class='op'>(</span><span class='st'>"data/infant_mortality.rds"</span><span class='op'>)</span>

<span class='co'># jpeg(</span>
<span class='co'>#     filename="images/infant-mort-scatter.jpeg",</span>
<span class='co'>#     width=6,</span>
<span class='co'>#     height=4,</span>
<span class='co'>#     units="in",</span>
<span class='co'>#     res=1000)</span>

<span class='va'>infant_mortality</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>births</span> <span class='op'>&gt;</span> <span class='fl'>5</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>infant_mort_rate</span>, <span class='va'>mort_rate</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>size <span class='op'>=</span> <span class='va'>total</span>, colour <span class='op'>=</span> <span class='va'>race</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='co'># geom_smooth(method = "lm", se = F, aes(colour = "Both groups")) +</span>
  <span class='fu'>geom_smooth</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>colour <span class='op'>=</span> <span class='va'>race</span><span class='op'>)</span>, method <span class='op'>=</span> <span class='st'>"lm"</span>, se <span class='op'>=</span> <span class='cn'>F</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_continuous</span><span class='op'>(</span>labels <span class='op'>=</span> <span class='fu'>number_format</span><span class='op'>(</span>scale <span class='op'>=</span> <span class='fl'>1000</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_y_continuous</span><span class='op'>(</span>labels <span class='op'>=</span> <span class='fu'>number_format</span><span class='op'>(</span>scale <span class='op'>=</span> <span class='fl'>1000</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_color_manual</span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'>wesanderson</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/wesanderson/man/wes_palette.html'>wes_palette</a></span><span class='op'>(</span><span class='fl'>3</span>, name <span class='op'>=</span> <span class='st'>"Zissou1"</span>, type <span class='op'>=</span> <span class='st'>"continuous"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Infant mortality rate"</span>,
       y <span class='op'>=</span> <span class='st'>"Pandemic mortality rate"</span>,
       size <span class='op'>=</span> <span class='st'>"District population"</span>,
       colour <span class='op'>=</span> <span class='st'>"Race group"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"bottom"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>guides</span><span class='op'>(</span>colour <span class='op'>=</span> <span class='fu'>guide_legend</span><span class='op'>(</span>nrow <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>,
         size <span class='op'>=</span> <span class='fu'>guide_legend</span><span class='op'>(</span>nrow <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span style="display:block;" id="fig:infant-mort-scatter"></span>
<img src="spanish-flu-mortality_files/figure-html5/infant-mort-scatter-1.png" alt="Scatterplot and linear fit of infant and pandemic mortality by district" width="768" />
<p class="caption">
Figure 12: Scatterplot and linear fit of infant and pandemic mortality by district
</p>
</div>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># dev.off()</span>


<span class='va'>lm_1</span> <span class='op'>&lt;-</span> <span class='va'>infant_mortality</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>race</span> <span class='op'>==</span> <span class='st'>"Both groups"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>mort_rate</span> <span class='op'>~</span> <span class='va'>infant_mort_rate</span>, data <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span>

<span class='va'>lm_2</span> <span class='op'>&lt;-</span> <span class='va'>infant_mortality</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>race</span> <span class='op'>!=</span> <span class='st'>"Both groups"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>mort_rate</span> <span class='op'>~</span> <span class='va'>infant_mort_rate</span> <span class='op'>+</span> <span class='va'>race</span>, data <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span>

<span class='co'># stargazer::stargazer(lm_1, lm_2,</span>
<span class='co'>#   type = "text",</span>
<span class='co'>#   title = "Infant and pandemic mortality",</span>
<span class='co'>#   dep.var.caption = " ",</span>
<span class='co'>#   dep.var.labels = "Pandemic mortality rate",</span>
<span class='co'>#   covariate.labels = c("Infant mortality rate", "White"),</span>
<span class='co'>#   out="regs/infant-mort-scatter.txt"</span>
<span class='co'># )</span>
</code></pre>
</div>
</details>
</div>
<table style="text-align:center">
<caption>
<strong>Infant and pandemic mortality</strong>
</caption>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="2">
</td>
</tr>
<tr>
<td>
</td>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="2">
Pandemic mortality rate
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(1)
</td>
<td>
(2)
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Infant mortality rate
</td>
<td>
0.139<sup>**</sup>
</td>
<td>
0.015
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.046)
</td>
<td>
(0.012)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
White
</td>
<td>
</td>
<td>
-0.028<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
(0.006)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Constant
</td>
<td>
0.003
</td>
<td>
0.038<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.010)
</td>
<td>
(0.005)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Observations
</td>
<td>
14
</td>
<td>
28
</td>
</tr>
<tr>
<td style="text-align:left">
R<sup>2</sup>
</td>
<td>
0.428
</td>
<td>
0.521
</td>
</tr>
<tr>
<td style="text-align:left">
Adjusted R<sup>2</sup>
</td>
<td>
0.380
</td>
<td>
0.482
</td>
</tr>
<tr>
<td style="text-align:left">
Residual Std. Error
</td>
<td>
0.013 (df = 12)
</td>
<td>
0.016 (df = 25)
</td>
</tr>
<tr>
<td style="text-align:left">
F Statistic
</td>
<td>
8.975<sup>**</sup> (df = 1; 12)
</td>
<td>
13.574<sup>***</sup> (df = 2; 25)
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Note:</em>
</td>
<td colspan="2" style="text-align:right">
<sup>*</sup>p&lt;0.1; <sup>**</sup>p&lt;0.05; <sup>***</sup>p&lt;0.01
</td>
</tr>
<td colspan="3">
</td>
</tr>
<tr>
<td style="text-align:left">
<em></em>
</td>
<td colspan="2" style="text-align:right">
<em>Heteroskedasticity robust SEs from Sandwich package</em>
</td>
</table>
<p>Regression table <a href="#fig:infant-mort-scatter">12</a> shows before controlling for race, there is a strong correlation between infant mortality rate and pandemic mortality rates across districts, with a five percent significance level and a slope coefficient of 0.139. However, after accounting for race, infant mortality rate is not longer significantly correlated with pandemic mortality.</p>
<h5 id="child-mortality">Child mortality</h5>
<p>In a similar vein, I assess the correlation between child mortality and pandemic mortality. Child mortality is calculated as the number of children who died prior to the pandemic below five years of age from the Forms, divided by the population below five years of age from the 1911 and 1918 census for black and coloured and white individuals, respectively.</p>
<p>Figure <a href="#fig:child-mortality">13</a> shows that there is heterogeneity amongst the districts in child mortality, and that on average child mortality for white residents is lower than for black and coloured residents.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>child_mortality</span> <span class='op'>&lt;-</span> <span class='fu'>read_rds</span><span class='op'>(</span><span class='st'>"data/child_mortality.rds"</span><span class='op'>)</span>

<span class='co'># jpeg(</span>
<span class='co'>#     filename="images/child-mortality.jpeg",</span>
<span class='co'>#     width=6,</span>
<span class='co'>#     height=4,</span>
<span class='co'>#     units="in",</span>
<span class='co'>#     res=1000)</span>

<span class='va'>child_mortality</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>race</span> <span class='op'>!=</span> <span class='st'>"Both groups"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>town <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/tidytext/man/reorder_within.html'>reorder_within</a></span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>child_mort_rate</span>, <span class='va'>race</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>child_mort_rate</span>, <span class='va'>town</span>, colour <span class='op'>=</span> <span class='va'>race</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_errorbarh</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>low</span>, xmax <span class='op'>=</span> <span class='va'>high</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://rdrr.io/pkg/tidytext/man/reorder_within.html'>scale_y_reordered</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_wrap</span><span class='op'>(</span><span class='op'>~</span> <span class='va'>race</span>, nrow <span class='op'>=</span> <span class='fl'>2</span>, scales <span class='op'>=</span> <span class='st'>"free_y"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_continuous</span><span class='op'>(</span>labels <span class='op'>=</span> <span class='fu'>number_format</span><span class='op'>(</span>scale <span class='op'>=</span> <span class='fl'>1000</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_color_manual</span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'>wesanderson</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/wesanderson/man/wes_palette.html'>wes_palette</a></span><span class='op'>(</span><span class='fl'>2</span>, name <span class='op'>=</span> <span class='st'>"Zissou1"</span>, type <span class='op'>=</span> <span class='st'>"continuous"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Child mortality per 1000 children"</span>,
       y <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span style="display:block;" id="fig:child-mortality"></span>
<img src="spanish-flu-mortality_files/figure-html5/child-mortality-1.png" alt="Child mortality per 1000 children" width="768" />
<p class="caption">
Figure 13: Child mortality per 1000 children
</p>
</div>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># dev.off()</span>
</code></pre>
</div>
</details>
</div>
<p>Table <a href="#tab:child-mort-tab">7</a></p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>child_mortality</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>race</span> <span class='op'>!=</span> <span class='st'>"Both groups"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>n_under_5_t <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>n_under_5</span><span class='op'>)</span>,
         deaths_t <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>deaths</span><span class='op'>)</span>,
         child_mort_rate_t <span class='op'>=</span><span class='va'>deaths_t</span> <span class='op'>/</span> <span class='va'>n_under_5_t</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>race</span>, <span class='va'>child_mort_rate</span>, <span class='va'>child_mort_rate_t</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_wider</span><span class='op'>(</span>names_from <span class='op'>=</span> <span class='st'>"race"</span>, values_from <span class='op'>=</span> <span class='st'>"child_mort_rate"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span><span class='fu'>across</span><span class='op'>(</span><span class='fu'>where</span><span class='op'>(</span><span class='va'>is.numeric</span><span class='op'>)</span>, .fns <span class='op'>=</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>.x</span> <span class='op'>*</span> <span class='fl'>1000</span>, digits <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>arrange</span><span class='op'>(</span><span class='va'>child_mort_rate_t</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>knitr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span>col.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"District"</span>, <span class='st'>"Aggregate"</span>, <span class='st'>"White"</span>, <span class='st'>"Black and Coloured"</span><span class='op'>)</span>,
               caption <span class='op'>=</span> <span class='st'>"Child mortality per 1000 recorded births"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<table>
<caption><span id="tab:child-mort-tab">Table 7: </span>Child mortality per 1000 recorded births</caption>
<thead>
<tr class="header">
<th style="text-align: left;">District</th>
<th style="text-align: right;">Aggregate</th>
<th style="text-align: right;">White</th>
<th style="text-align: right;">Black and Coloured</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Vryburg</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">65</td>
</tr>
<tr class="even">
<td style="text-align: left;">Peddie</td>
<td style="text-align: right;">73</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">74</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Kuruman</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">61</td>
<td style="text-align: right;">86</td>
</tr>
<tr class="even">
<td style="text-align: left;">Elliot</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">159</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mafeking</td>
<td style="text-align: right;">118</td>
<td style="text-align: right;">126</td>
<td style="text-align: right;">117</td>
</tr>
<tr class="even">
<td style="text-align: left;">Riversdale</td>
<td style="text-align: right;">127</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">215</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Komga</td>
<td style="text-align: right;">160</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">174</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fraserburg</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">291</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Cradock</td>
<td style="text-align: right;">180</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">232</td>
</tr>
<tr class="even">
<td style="text-align: left;">Queenstown</td>
<td style="text-align: right;">216</td>
<td style="text-align: right;">77</td>
<td style="text-align: right;">247</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Oudtshoorn</td>
<td style="text-align: right;">243</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">391</td>
</tr>
<tr class="even">
<td style="text-align: left;">Paarl</td>
<td style="text-align: right;">263</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">343</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Stellenbosch</td>
<td style="text-align: right;">270</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">340</td>
</tr>
<tr class="even">
<td style="text-align: left;">Stockenstrom</td>
<td style="text-align: right;">279</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">318</td>
</tr>
</tbody>
</table>
</div>
<p>Figure <a href="#fig:child-mort-scatter">14</a> shows the linear fits superimposed on the scatter plots of child mortality rates and pandemic mortality rates. Visually, all three have a positive slope, with the steepest gradient on the aggregate sample.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># jpeg(</span>
<span class='co'>#     filename="images/child-mort-scatter.jpeg",</span>
<span class='co'>#     width=6,</span>
<span class='co'>#     height=4,</span>
<span class='co'>#     units="in",</span>
<span class='co'>#     res=1000)</span>

<span class='va'>child_mortality</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>child_mort_rate</span>, <span class='va'>mort_rate</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>size <span class='op'>=</span> <span class='va'>total</span>, colour <span class='op'>=</span> <span class='va'>race</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_smooth</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>colour <span class='op'>=</span> <span class='va'>race</span><span class='op'>)</span>, method <span class='op'>=</span> <span class='st'>"lm"</span>, se <span class='op'>=</span> <span class='cn'>F</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_continuous</span><span class='op'>(</span>labels <span class='op'>=</span> <span class='fu'>number_format</span><span class='op'>(</span>scale <span class='op'>=</span> <span class='fl'>1000</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_y_continuous</span><span class='op'>(</span>labels <span class='op'>=</span> <span class='fu'>number_format</span><span class='op'>(</span>scale <span class='op'>=</span> <span class='fl'>1000</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_color_manual</span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'>wesanderson</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/wesanderson/man/wes_palette.html'>wes_palette</a></span><span class='op'>(</span><span class='fl'>3</span>, name <span class='op'>=</span> <span class='st'>"Zissou1"</span>, type <span class='op'>=</span> <span class='st'>"continuous"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Child mortality rate"</span>,
       y <span class='op'>=</span> <span class='st'>"Pandemic mortality rate"</span>,
       size <span class='op'>=</span> <span class='st'>"District population"</span>,
       colour <span class='op'>=</span> <span class='st'>"Race group"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span style="display:block;" id="fig:child-mort-scatter"></span>
<img src="spanish-flu-mortality_files/figure-html5/child-mort-scatter-1.png" alt="Scatterplot and linear fit of child and pandemic mortality by district" width="768" />
<p class="caption">
Figure 14: Scatterplot and linear fit of child and pandemic mortality by district
</p>
</div>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># dev.off()</span>

<span class='va'>lm_1</span> <span class='op'>&lt;-</span> <span class='va'>child_mortality</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>race</span> <span class='op'>==</span> <span class='st'>"Both groups"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>mort_rate</span> <span class='op'>~</span> <span class='va'>child_mort_rate</span>, data <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span>

<span class='va'>lm_2</span> <span class='op'>&lt;-</span> <span class='va'>child_mortality</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>race</span> <span class='op'>!=</span> <span class='st'>"Both groups"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>mort_rate</span> <span class='op'>~</span> <span class='va'>child_mort_rate</span> <span class='op'>+</span> <span class='va'>race</span>, data <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span>

<span class='co'># stargazer::stargazer(lm_1, lm_2,</span>
<span class='co'>#   type = "html", </span>
<span class='co'>#   title = "Child and pandemic mortality", </span>
<span class='co'>#   dep.var.caption = " ",</span>
<span class='co'>#   dep.var.labels = "Pandemic mortality rate",</span>
<span class='co'>#   covariate.labels = c("Child mortality rate", "White")</span>
<span class='co'># )</span>
</code></pre>
</div>
</details>
</div>
<table style="text-align:center">
<caption>
<strong>Child mortality and pandemic mortality</strong>
</caption>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="2">
</td>
</tr>
<tr>
<td>
</td>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="2">
Pandemic mortality rate
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(1)
</td>
<td>
(2)
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Child mortality rate
</td>
<td>
0.095
</td>
<td>
0.066<sup>*</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.058)
</td>
<td>
(0.038)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
White
</td>
<td>
</td>
<td>
-0.020<sup>**</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
(0.008)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Constant
</td>
<td>
0.017
</td>
<td>
0.028<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.011)
</td>
<td>
(0.009)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Observations
</td>
<td>
14
</td>
<td>
28
</td>
</tr>
<tr>
<td style="text-align:left">
R<sup>2</sup>
</td>
<td>
0.184
</td>
<td>
0.544
</td>
</tr>
<tr>
<td style="text-align:left">
Adjusted R<sup>2</sup>
</td>
<td>
0.116
</td>
<td>
0.508
</td>
</tr>
<tr>
<td style="text-align:left">
Residual Std. Error
</td>
<td>
0.016 (df = 12)
</td>
<td>
0.015 (df = 25)
</td>
</tr>
<tr>
<td style="text-align:left">
F Statistic
</td>
<td>
2.707 (df = 1; 12)
</td>
<td>
14.919<sup>***</sup> (df = 2; 25)
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Note:</em>
</td>
<td colspan="2" style="text-align:right">
<sup>*</sup>p&lt;0.1; <sup>**</sup>p&lt;0.05; <sup>***</sup>p&lt;0.01
</td>
</tr>
<td colspan="3">
</td>
</tr>
<tr>
<td style="text-align:left">
<em></em>
</td>
<td colspan="2" style="text-align:right">
<em>Heteroskedasticity robust SEs from Sandwich package</em>
</td>
</table>
<p>Regression table <a href="#fig:child-mort-scatter">14</a> shows that after accounting for race, child mortality is correlated with pandemic mortality at the ten percent level, with a slope coefficient of 0.066.</p>
<h4 id="pre-pandemic-pneumonia-and-influenza-mortality">Pre-pandemic pneumonia and influenza mortality</h4>
<p><span class="citation" data-cites="AcuaSoto2011InfluenzaAP"><a href="#ref-AcuaSoto2011InfluenzaAP" role="doc-biblioref">Acuña-Soto, Viboud, and Chowell</a> (<a href="#ref-AcuaSoto2011InfluenzaAP" role="doc-biblioref">2011</a>)</span> show how influenza and pneumonia mortality prior to the pandemic are predictive of mortality rates during the pandemic in 66 large cities in the United States.</p>
<p>I follow their methodology here to assess the same question. First I calculate the pre-pandemic mortality rates by district from influenza, pneumonia and both. These are shown in Table <a href="#tab:pneumonia-influenza-tab">8</a> below.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pneumonia_influenza</span> <span class='op'>&lt;-</span> <span class='fu'>read_rds</span><span class='op'>(</span><span class='st'>"data/pneumonia_influenza.rds"</span><span class='op'>)</span>
  
<span class='va'>pneumonia_influenza</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>influenza_deaths_grouped <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>influenza_deaths</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>,
         pneumonia_deaths_grouped <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>pneumonia_deaths</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>,
         pneumonia_influenza_deahts_grouped <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>pneumonia_influenza_deaths</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>,
         total_grouped <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>total</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span><span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>influenza_deaths_grouped</span>, <span class='va'>pneumonia_deaths_grouped</span>, <span class='va'>pneumonia_influenza_deahts_grouped</span><span class='op'>)</span>, .fns <span class='op'>=</span> <span class='op'>~</span><span class='va'>.x</span><span class='op'>*</span><span class='fl'>3</span> <span class='op'>/</span> <span class='va'>total_grouped</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span><span class='fu'>across</span><span class='op'>(</span><span class='fu'>where</span><span class='op'>(</span><span class='va'>is.numeric</span><span class='op'>)</span>, <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>.x</span><span class='op'>*</span><span class='fl'>1000</span>, <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>distinct</span><span class='op'>(</span><span class='va'>town</span>, .keep_all <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>arrange</span><span class='op'>(</span><span class='va'>pneumonia_influenza_deahts_grouped</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>influenza_deaths_grouped</span>, <span class='va'>pneumonia_deaths_grouped</span>, <span class='va'>pneumonia_influenza_deahts_grouped</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>knitr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span>col.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"District"</span>, <span class='st'>"Influenza"</span>, <span class='st'>"Pneumonia"</span>, <span class='st'>"Influenza and Pneumonia"</span><span class='op'>)</span>,
               caption <span class='op'>=</span> <span class='st'>"Influenza and Pneumonia mortality per 1000 residents"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<table>
<caption><span id="tab:pneumonia-influenza-tab">Table 8: </span>Influenza and Pneumonia mortality per 1000 residents</caption>
<thead>
<tr class="header">
<th style="text-align: left;">District</th>
<th style="text-align: right;">Influenza</th>
<th style="text-align: right;">Pneumonia</th>
<th style="text-align: right;">Influenza and Pneumonia</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Kuruman</td>
<td style="text-align: right;">4.28</td>
<td style="text-align: right;">4.28</td>
<td style="text-align: right;">8.56</td>
</tr>
<tr class="even">
<td style="text-align: left;">Riversdale</td>
<td style="text-align: right;">3.18</td>
<td style="text-align: right;">5.76</td>
<td style="text-align: right;">8.94</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Vryburg</td>
<td style="text-align: right;">4.30</td>
<td style="text-align: right;">9.02</td>
<td style="text-align: right;">13.32</td>
</tr>
<tr class="even">
<td style="text-align: left;">Peddie</td>
<td style="text-align: right;">8.37</td>
<td style="text-align: right;">5.89</td>
<td style="text-align: right;">14.10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mafeking</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">14.77</td>
<td style="text-align: right;">15.26</td>
</tr>
<tr class="even">
<td style="text-align: left;">Elliot</td>
<td style="text-align: right;">7.28</td>
<td style="text-align: right;">11.79</td>
<td style="text-align: right;">18.72</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fraserburg</td>
<td style="text-align: right;">5.21</td>
<td style="text-align: right;">20.85</td>
<td style="text-align: right;">26.06</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cradock</td>
<td style="text-align: right;">2.31</td>
<td style="text-align: right;">23.84</td>
<td style="text-align: right;">26.15</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Paarl</td>
<td style="text-align: right;">0.79</td>
<td style="text-align: right;">27.82</td>
<td style="text-align: right;">28.61</td>
</tr>
<tr class="even">
<td style="text-align: left;">Stellenbosch</td>
<td style="text-align: right;">3.29</td>
<td style="text-align: right;">32.05</td>
<td style="text-align: right;">35.07</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Queenstown</td>
<td style="text-align: right;">8.02</td>
<td style="text-align: right;">29.17</td>
<td style="text-align: right;">37.02</td>
</tr>
<tr class="even">
<td style="text-align: left;">Oudtshoorn</td>
<td style="text-align: right;">1.95</td>
<td style="text-align: right;">42.89</td>
<td style="text-align: right;">44.59</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Komga</td>
<td style="text-align: right;">28.62</td>
<td style="text-align: right;">16.88</td>
<td style="text-align: right;">45.31</td>
</tr>
<tr class="even">
<td style="text-align: left;">Stockenstrom</td>
<td style="text-align: right;">22.65</td>
<td style="text-align: right;">75.60</td>
<td style="text-align: right;">98.25</td>
</tr>
</tbody>
</table>
</div>
<p>Figure <a href="#fig:pneumonia-influenza-mort">15</a> shows that while the slopes separated by race are lower, there is still a strong correlation between pre-existing pneumonia and influenza mortality rates and the pandemic mortality rate in each district. The strongest correlation appears to be the aggregated sample.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pneumonia_influenza_mort</span> <span class='op'>&lt;-</span> <span class='fu'>read_rds</span><span class='op'>(</span><span class='st'>"data/pneumonia_infleunza_mort.rds"</span><span class='op'>)</span>

<span class='co'># jpeg(</span>
<span class='co'>#     filename="images/pneumonia-influenza-mort.jpeg",</span>
<span class='co'>#     width=6,</span>
<span class='co'>#     height=4,</span>
<span class='co'>#     units="in",</span>
<span class='co'>#     res=1000)</span>

<span class='va'>pneumonia_influenza_mort</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>pneumonia_influenza_mort</span>, <span class='va'>pandemic_mort_rate</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>colour <span class='op'>=</span> <span class='va'>race</span>, size <span class='op'>=</span> <span class='va'>total_pop</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_smooth</span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"lm"</span>, <span class='fu'>aes</span><span class='op'>(</span>colour <span class='op'>=</span> <span class='va'>race</span><span class='op'>)</span>, se <span class='op'>=</span> <span class='cn'>F</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_continuous</span><span class='op'>(</span>labels <span class='op'>=</span> <span class='fu'>number_format</span><span class='op'>(</span>scale <span class='op'>=</span> <span class='fl'>1000</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_y_continuous</span><span class='op'>(</span>labels <span class='op'>=</span> <span class='fu'>number_format</span><span class='op'>(</span>scale <span class='op'>=</span> <span class='fl'>1000</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='co'># theme(legend.position = "bottom") +</span>
  <span class='fu'>scale_color_manual</span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'>wesanderson</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/wesanderson/man/wes_palette.html'>wes_palette</a></span><span class='op'>(</span><span class='fl'>3</span>, name <span class='op'>=</span> <span class='st'>"Zissou1"</span>, type <span class='op'>=</span> <span class='st'>"continuous"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>
    x <span class='op'>=</span> <span class='st'>"Pre-existing district level pneumonia and infleunza mortality"</span>,
    y <span class='op'>=</span> <span class='st'>"Pandemic mortality"</span>,
    caption <span class='op'>=</span> <span class='st'>"Note: mortality is measured as deaths per 1000 residents"</span>,
    colour <span class='op'>=</span> <span class='st'>"Race group"</span>,
    size <span class='op'>=</span> <span class='st'>"District population"</span>
  <span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span style="display:block;" id="fig:pneumonia-influenza-mort"></span>
<img src="spanish-flu-mortality_files/figure-html5/pneumonia-influenza-mort-1.png" alt="Scatterplot and linear fit of pneumonia mortality and pandemic mortality by district" width="768" />
<p class="caption">
Figure 15: Scatterplot and linear fit of pneumonia mortality and pandemic mortality by district
</p>
</div>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># dev.off()</span>

<span class='va'>lm_1</span> <span class='op'>&lt;-</span> <span class='fu'>read_rds</span><span class='op'>(</span><span class='st'>"data/influenza_mort.rds"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>pandemic_mort_rate</span> <span class='op'>~</span> <span class='va'>influenza_mort</span> <span class='op'>+</span> <span class='va'>race</span>, data <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span>

<span class='va'>lm_2</span> <span class='op'>&lt;-</span> <span class='fu'>read_rds</span><span class='op'>(</span><span class='st'>"data/pneumonia_mort.rds"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>pandemic_mort_rate</span> <span class='op'>~</span> <span class='va'>pneumonia_mort</span> <span class='op'>+</span> <span class='va'>race</span>, data <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span>

<span class='va'>lm_3</span> <span class='op'>&lt;-</span> <span class='va'>pneumonia_influenza_mort</span> <span class='op'>%&gt;%</span> 
 <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>pandemic_mort_rate</span> <span class='op'>~</span> <span class='va'>pneumonia_influenza_mort</span> <span class='op'>+</span> <span class='va'>race</span>, data <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span>

<span class='co'># stargazer::stargazer(lm_1, lm_2, lm_3,</span>
<span class='co'>#   type = "html", </span>
<span class='co'>#   title = "Infant and pandemic mortality", </span>
<span class='co'>#   dep.var.caption = " ",</span>
<span class='co'>#   dep.var.labels = "Pandemic mortality rate",</span>
<span class='co'>#   covariate.labels = c("Influenza mortality", "Pneumonia mortality", "Pneumonia and influenza mort.", "White")</span>
<span class='co'># )</span>
</code></pre>
</div>
</details>
</div>
<table style="text-align:center">
<caption>
<strong>Pneumonia and influenza and pandemic mortality</strong>
</caption>
<tr>
<td colspan="4" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="3">
</td>
</tr>
<tr>
<td>
</td>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="3">
Pandemic mortality rate
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(1)
</td>
<td>
(2)
</td>
<td>
(3)
</td>
</tr>
<tr>
<td colspan="4" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Influenza mortality
</td>
<td>
3.228<sup>**</sup>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(1.437)
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Pneumonia mortality
</td>
<td>
</td>
<td>
1.370<sup>**</sup>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
(0.511)
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Pneumonia and influenza mort.
</td>
<td>
</td>
<td>
</td>
<td>
1.596<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
(0.336)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
White
</td>
<td>
-0.023<sup>***</sup>
</td>
<td>
-0.019<sup>***</sup>
</td>
<td>
-0.014<sup>**</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.007)
</td>
<td>
(0.007)
</td>
<td>
(0.006)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Constant
</td>
<td>
0.033<sup>***</sup>
</td>
<td>
0.029<sup>***</sup>
</td>
<td>
0.022<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.006)
</td>
<td>
(0.006)
</td>
<td>
(0.006)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td colspan="4" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Observations
</td>
<td>
26
</td>
<td>
28
</td>
<td>
42
</td>
</tr>
<tr>
<td style="text-align:left">
R<sup>2</sup>
</td>
<td>
0.567
</td>
<td>
0.602
</td>
<td>
0.617
</td>
</tr>
<tr>
<td style="text-align:left">
Adjusted R<sup>2</sup>
</td>
<td>
0.530
</td>
<td>
0.571
</td>
<td>
0.587
</td>
</tr>
<tr>
<td style="text-align:left">
Residual Std. Error
</td>
<td>
0.015 (df = 23)
</td>
<td>
0.014 (df = 25)
</td>
<td>
0.013 (df = 38)
</td>
</tr>
<tr>
<td style="text-align:left">
F Statistic
</td>
<td>
15.075<sup>***</sup> (df = 2; 23)
</td>
<td>
18.945<sup>***</sup> (df = 2; 25)
</td>
<td>
20.387<sup>***</sup> (df = 3; 38)
</td>
</tr>
<tr>
<td colspan="4" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Note:</em>
</td>
<td colspan="3" style="text-align:right">
<sup>*</sup>p&lt;0.1; <sup>**</sup>p&lt;0.05; <sup>***</sup>p&lt;0.01
</td>
</tr>
<td colspan="4">
</td>
</tr>
<tr>
<td style="text-align:left">
<em></em>
</td>
<td colspan="3" style="text-align:right">
<em>Heteroskedasticity robust SEs from Sandwich package</em>
</td>
</table>
<p>Regression table <a href="#fig:pneumonia-influenza-mort">15</a> shows that after controlling for race, mortality rates from influenza, pneumonia and both diseases are highly correlated with mortality rates during the pandemic, at the 5 percent level and below. The combination are significantly correlated with pandemic mortality rates at the one percent level.</p>
<h4 id="literacy-proxy">Literacy proxy</h4>
<p>I use a proxy for literacy of the individual’s family to assess if literacy has an impact on how well residents of a district fare during the pandemic. The hypothesis is that districts with higher literacy rates will better adopt the best practices proposed by health authorities in an attempt to quell the pandemic and stop the spread of the disease, according to <span class="citation" data-cites="Clay2018"><a href="#ref-Clay2018" role="doc-biblioref">Clay, Lewis, and Severnini</a> (<a href="#ref-Clay2018" role="doc-biblioref">2018</a>)</span>.</p>
<p>Table <a href="#tab:literacy-tab">9</a> shows that there is considerable variation in our literacy proxy by district and race. Figure <a href="#fig:literacy-fig">16</a> shows that the share of informants who sign the Forms in Sea Point, Fraserburg and Elliot is 100 percent. Given that it is likely the registrar signed each form on behalf of the informant, I will exclude these three from the regression.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>df</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>death_date</span> <span class='op'>&lt;</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1918-09-01"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>signed_yes_or_no <span class='op'>=</span> <span class='fu'>str_to_lower</span><span class='op'>(</span><span class='va'>signed_yes_or_no</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>literate_proxy <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span>
    <span class='fu'>str_detect</span><span class='op'>(</span><span class='va'>signed_yes_or_no</span>, <span class='st'>"maark|mark|merk|no|x"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"No"</span>,
    <span class='fu'>str_detect</span><span class='op'>(</span><span class='va'>signed_yes_or_no</span>, <span class='st'>"yes"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Yes"</span>,
    <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='st'>"No"</span>
  <span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>race</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='cn'>NA</span>, <span class='st'>"NA"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>count</span><span class='op'>(</span><span class='va'>race</span>, <span class='va'>town</span>, <span class='va'>literate_proxy</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_wider</span><span class='op'>(</span>names_from <span class='op'>=</span> <span class='st'>"literate_proxy"</span>, values_from <span class='op'>=</span> <span class='st'>"n"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span><span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>No</span>, <span class='va'>Yes</span><span class='op'>)</span>, <span class='op'>~</span> <span class='fu'>replace_na</span><span class='op'>(</span><span class='va'>.</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>share_literate <span class='op'>=</span> <span class='va'>Yes</span><span class='op'>/</span><span class='op'>(</span><span class='va'>Yes</span> <span class='op'>+</span> <span class='va'>No</span><span class='op'>)</span>,
         town <span class='op'>=</span> <span class='fu'>fct_reorder</span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>share_literate</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>aggregate <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>Yes</span><span class='op'>)</span><span class='op'>/</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>Yes</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>No</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>race</span>, <span class='va'>share_literate</span>, <span class='va'>aggregate</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_wider</span><span class='op'>(</span>names_from <span class='op'>=</span> <span class='st'>"race"</span>, values_from <span class='op'>=</span> <span class='st'>"share_literate"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>arrange</span><span class='op'>(</span><span class='fu'>desc</span><span class='op'>(</span><span class='va'>aggregate</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span><span class='fu'>across</span><span class='op'>(</span><span class='fu'>where</span><span class='op'>(</span><span class='va'>is.numeric</span><span class='op'>)</span>, .fns <span class='op'>=</span> <span class='op'>~</span> <span class='fu'>percent</span><span class='op'>(</span><span class='va'>.</span>, accuracy <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>knitr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/knitr/man/kable.html'>kable</a></span><span class='op'>(</span>col.names <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"District"</span>, <span class='st'>"Aggregate"</span>, <span class='st'>"Black"</span>, <span class='st'>"Coloured"</span>, <span class='st'>"White"</span><span class='op'>)</span>,
               caption <span class='op'>=</span> <span class='st'>"Percentage of district death notices wherein Informant signed"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<table>
<caption><span id="tab:literacy-tab">Table 9: </span>Percentage of district death notices wherein Informant signed</caption>
<thead>
<tr class="header">
<th style="text-align: left;">District</th>
<th style="text-align: left;">Aggregate</th>
<th style="text-align: left;">Black</th>
<th style="text-align: left;">Coloured</th>
<th style="text-align: left;">White</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Fraserburg</td>
<td style="text-align: left;">100%</td>
<td style="text-align: left;">100%</td>
<td style="text-align: left;">100%</td>
<td style="text-align: left;">100%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sea Point</td>
<td style="text-align: left;">100%</td>
<td style="text-align: left;">100%</td>
<td style="text-align: left;">100%</td>
<td style="text-align: left;">100%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Elliot</td>
<td style="text-align: left;">99%</td>
<td style="text-align: left;">99%</td>
<td style="text-align: left;">100%</td>
<td style="text-align: left;">99%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Stellenbosch</td>
<td style="text-align: left;">49%</td>
<td style="text-align: left;">49%</td>
<td style="text-align: left;">37%</td>
<td style="text-align: left;">96%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Paarl</td>
<td style="text-align: left;">45%</td>
<td style="text-align: left;">46%</td>
<td style="text-align: left;">37%</td>
<td style="text-align: left;">94%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cradock</td>
<td style="text-align: left;">45%</td>
<td style="text-align: left;">33%</td>
<td style="text-align: left;">36%</td>
<td style="text-align: left;">97%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Vryburg</td>
<td style="text-align: left;">45%</td>
<td style="text-align: left;">29%</td>
<td style="text-align: left;">30%</td>
<td style="text-align: left;">99%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Riversdale</td>
<td style="text-align: left;">43%</td>
<td style="text-align: left;">50%</td>
<td style="text-align: left;">15%</td>
<td style="text-align: left;">90%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mafeking</td>
<td style="text-align: left;">42%</td>
<td style="text-align: left;">32%</td>
<td style="text-align: left;">51%</td>
<td style="text-align: left;">100%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Queenstown</td>
<td style="text-align: left;">40%</td>
<td style="text-align: left;">33%</td>
<td style="text-align: left;">30%</td>
<td style="text-align: left;">98%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Oudtshoorn</td>
<td style="text-align: left;">37%</td>
<td style="text-align: left;">27%</td>
<td style="text-align: left;">21%</td>
<td style="text-align: left;">90%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kuruman</td>
<td style="text-align: left;">33%</td>
<td style="text-align: left;">16%</td>
<td style="text-align: left;">36%</td>
<td style="text-align: left;">96%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Stockenstrom</td>
<td style="text-align: left;">17%</td>
<td style="text-align: left;">7%</td>
<td style="text-align: left;">32%</td>
<td style="text-align: left;">93%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Komga</td>
<td style="text-align: left;">11%</td>
<td style="text-align: left;">6%</td>
<td style="text-align: left;">14%</td>
<td style="text-align: left;">95%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Peddie</td>
<td style="text-align: left;">9%</td>
<td style="text-align: left;">6%</td>
<td style="text-align: left;">20%</td>
<td style="text-align: left;">97%</td>
</tr>
</tbody>
</table>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># jpeg(</span>
<span class='co'>#     filename="images/literacy-fig.jpeg",</span>
<span class='co'>#     width=6,</span>
<span class='co'>#     height=4,</span>
<span class='co'>#     units="in",</span>
<span class='co'>#     res=1000)</span>

<span class='va'>df</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>death_date</span> <span class='op'>&lt;</span> <span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>ymd</a></span><span class='op'>(</span><span class='st'>"1918-09-01"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>signed_yes_or_no <span class='op'>=</span> <span class='fu'>str_to_lower</span><span class='op'>(</span><span class='va'>signed_yes_or_no</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>literate_proxy <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span>
    <span class='fu'>str_detect</span><span class='op'>(</span><span class='va'>signed_yes_or_no</span>, <span class='st'>"maark|mark|merk|no|x"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"No"</span>,
    <span class='fu'>str_detect</span><span class='op'>(</span><span class='va'>signed_yes_or_no</span>, <span class='st'>"yes"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Yes"</span>,
    <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='st'>"No"</span>
  <span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>race</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='cn'>NA</span>, <span class='st'>"NA"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>count</span><span class='op'>(</span><span class='va'>race</span>, <span class='va'>town</span>, <span class='va'>literate_proxy</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_wider</span><span class='op'>(</span>names_from <span class='op'>=</span> <span class='st'>"literate_proxy"</span>, values_from <span class='op'>=</span> <span class='st'>"n"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span><span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>No</span>, <span class='va'>Yes</span><span class='op'>)</span>, <span class='op'>~</span> <span class='fu'>replace_na</span><span class='op'>(</span><span class='va'>.</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>share_literate <span class='op'>=</span> <span class='va'>Yes</span><span class='op'>/</span><span class='op'>(</span><span class='va'>Yes</span> <span class='op'>+</span> <span class='va'>No</span><span class='op'>)</span>,
         town <span class='op'>=</span> <span class='fu'>fct_reorder</span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>share_literate</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>share_literate</span>, <span class='va'>town</span>, fill <span class='op'>=</span> <span class='va'>race</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_fill_manual</span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'>wesanderson</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/wesanderson/man/wes_palette.html'>wes_palette</a></span><span class='op'>(</span><span class='fl'>3</span>, name <span class='op'>=</span> <span class='st'>"Darjeeling1"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_col</span><span class='op'>(</span>position <span class='op'>=</span> <span class='st'>"dodge"</span>, show.legend <span class='op'>=</span> <span class='cn'>F</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_wrap</span><span class='op'>(</span> <span class='op'>~</span> <span class='va'>race</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_continuous</span><span class='op'>(</span>labels <span class='op'>=</span> <span class='fu'>percent_format</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Share of informants who sign Form"</span>,
       y <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span style="display:block;" id="fig:literacy-fig"></span>
<img src="spanish-flu-mortality_files/figure-html5/literacy-fig-1.png" alt="Share of informants who sign" width="768" />
<p class="caption">
Figure 16: Share of informants who sign
</p>
</div>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># dev.off()</span>
</code></pre>
</div>
</details>
</div>
<p>In Figure <a href="#fig:literacy-scatter">17</a>, the best fit line for “Both groups,” shown in yellow, leads us to believe that as the proportion of our district with the literacy proxy increases, the pandemic mortality decreases, in line with our hypothesis. Further, amongst black and coloured individuals, an increasing share of literate informants appears to result in marginally lower mortality rates during the pandemic. This is in support of the hypothesis. Yet amongst the white population of the districts, there appears to be an upward slope at the top end of the literacy distribution.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>df_literacy</span> <span class='op'>&lt;-</span> <span class='fu'>read_rds</span><span class='op'>(</span><span class='st'>"data/df_literacy.rds"</span><span class='op'>)</span>

<span class='co'># jpeg(</span>
<span class='co'>#     filename="images/literacy-scatter.jpeg",</span>
<span class='co'>#     width=6,</span>
<span class='co'>#     height=4,</span>
<span class='co'>#     units="in",</span>
<span class='co'>#     res=1000)</span>

<span class='va'>df_literacy</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>town</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Elliot"</span>, <span class='st'>"Fraserburg"</span>, <span class='st'>"Sea Point"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>share_literate</span>, <span class='va'>mort_rate</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>colour <span class='op'>=</span> <span class='va'>race</span>, size <span class='op'>=</span> <span class='va'>total</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_smooth</span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"lm"</span>, <span class='fu'>aes</span><span class='op'>(</span>colour <span class='op'>=</span> <span class='va'>race</span><span class='op'>)</span>, se <span class='op'>=</span> <span class='cn'>F</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_continuous</span><span class='op'>(</span>labels <span class='op'>=</span> <span class='fu'>percent_format</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_y_continuous</span><span class='op'>(</span>labels <span class='op'>=</span> <span class='fu'>number_format</span><span class='op'>(</span>scale <span class='op'>=</span> <span class='fl'>1000</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='co'># need to choose a better colour</span>
  <span class='fu'>scale_color_manual</span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'>wesanderson</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/wesanderson/man/wes_palette.html'>wes_palette</a></span><span class='op'>(</span><span class='fl'>3</span>, name <span class='op'>=</span> <span class='st'>"Zissou1"</span>, type <span class='op'>=</span> <span class='st'>"continuous"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Percentage of population with literacy proxy"</span>,
       y <span class='op'>=</span> <span class='st'>"Pandemic mortality per 1000 residents"</span>,
       size <span class='op'>=</span> <span class='st'>"District population"</span>,
       colour <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span style="display:block;" id="fig:literacy-scatter"></span>
<img src="spanish-flu-mortality_files/figure-html5/literacy-scatter-1.png" alt="Scatter plot and linear fit of literacy proxy and pandemic mortality by district" width="768" />
<p class="caption">
Figure 17: Scatter plot and linear fit of literacy proxy and pandemic mortality by district
</p>
</div>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># dev.off()</span>

<span class='va'>lm_1</span> <span class='op'>&lt;-</span> <span class='va'>df_literacy</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>town</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Elliot"</span>, <span class='st'>"Fraserburg"</span>, <span class='st'>"Sea Point"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>race</span> <span class='op'>==</span> <span class='st'>"Both groups"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>mort_rate</span> <span class='op'>~</span> <span class='va'>share_literate</span>, data <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span>

<span class='va'>lm_2</span> <span class='op'>&lt;-</span> <span class='va'>df_literacy</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>town</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Elliot"</span>, <span class='st'>"Fraserburg"</span>, <span class='st'>"Sea Point"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>race</span> <span class='op'>!=</span> <span class='st'>"Both groups"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>mort_rate</span> <span class='op'>~</span> <span class='va'>share_literate</span> <span class='op'>+</span> <span class='va'>race</span>, data <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span>

<span class='co'># stargazer::stargazer(lm_1, lm_2,</span>
<span class='co'>#   type = "html", </span>
<span class='co'>#   title = "Infant and pandemic mortality", </span>
<span class='co'>#   dep.var.caption = " ",</span>
<span class='co'>#   dep.var.labels = "Pandemic mortality rate",</span>
<span class='co'>#   covariate.labels = c("Share of informants who sign", "White")</span>
<span class='co'># )</span>
</code></pre>
</div>
</details>
</div>
<table style="text-align:center">
<caption>
<strong>Literacy of the informant and pandemic mortality</strong>
</caption>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="2">
</td>
</tr>
<tr>
<td>
</td>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="2">
Pandemic mortality rate
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(1)
</td>
<td>
(2)
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Share of informants who sign
</td>
<td>
-0.063<sup>*</sup>
</td>
<td>
-0.009
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.031)
</td>
<td>
(0.036)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
White
</td>
<td>
</td>
<td>
-0.021
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
(0.026)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Constant
</td>
<td>
0.054<sup>***</sup>
</td>
<td>
0.042<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.012)
</td>
<td>
(0.009)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Observations
</td>
<td>
12
</td>
<td>
24
</td>
</tr>
<tr>
<td style="text-align:left">
R<sup>2</sup>
</td>
<td>
0.284
</td>
<td>
0.512
</td>
</tr>
<tr>
<td style="text-align:left">
Adjusted R<sup>2</sup>
</td>
<td>
0.212
</td>
<td>
0.465
</td>
</tr>
<tr>
<td style="text-align:left">
Residual Std. Error
</td>
<td>
0.015 (df = 10)
</td>
<td>
0.014 (df = 21)
</td>
</tr>
<tr>
<td style="text-align:left">
F Statistic
</td>
<td>
3.958<sup>*</sup> (df = 1; 10)
</td>
<td>
11.005<sup>***</sup> (df = 2; 21)
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Note:</em>
</td>
<td colspan="2" style="text-align:right">
<sup>*</sup>p&lt;0.1; <sup>**</sup>p&lt;0.05; <sup>***</sup>p&lt;0.01
</td>
</tr>
<td colspan="3">
</td>
</tr>
<tr>
<td style="text-align:left">
<em></em>
</td>
<td colspan="2" style="text-align:right">
<em>Heteroskedasticity robust SEs from Sandwich package</em>
</td>
</table>
<p>Regression table <a href="#fig:literacy-scatter">17</a> shows that when we control for race, we see that the effect of literacy is not significant and magnitude of the effect fall. We cannot reject the hypothesis that our literacy proxy has no impact on mortality rate at the district level after controlling for race, even at the ten percent level.</p>
<h4 id="percentage-of-foreign-born-individuals">Percentage of foreign-born individuals</h4>
<p>Another measure of social capital is foreign born status, with the hypothesis being that foreign born individuals are less likely to adopt the health measures suggested by local governments. Figure <a href="#fig:birth-places">18</a> shows the proportion of residents of each district born in various regions outside of the Cape (shown in red). This data is from the Statistics of Population of 1918 <span class="citation" data-cites="OfficeofCensusandStatisticsPretoria1918">(<a href="#ref-OfficeofCensusandStatisticsPretoria1918" role="doc-biblioref">Office of Census and Statistics Pretoria 1918</a>)</span>. This means that we would expect the mortality rate during the flu to increase with the share of residents born outside the Cape.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>birth_place_shares</span> <span class='op'>&lt;-</span> <span class='fu'>read_rds</span><span class='op'>(</span><span class='st'>"data/birth_place_shares.rds"</span><span class='op'>)</span>

<span class='co'># jpeg(</span>
<span class='co'>#     filename="images/birth-places.jpeg",</span>
<span class='co'>#     width=6,</span>
<span class='co'>#     height=4,</span>
<span class='co'>#     units="in",</span>
<span class='co'>#     res=1000)</span>

<span class='va'>birth_place_shares</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>town <span class='op'>=</span> <span class='fu'>fct_reorder</span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>share_not_cape</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># select(-contains("share"), -grand_total) %&gt;% </span>
  <span class='fu'>rename_with</span><span class='op'>(</span> <span class='op'>~</span> <span class='fu'>str_remove</span><span class='op'>(</span><span class='va'>.x</span>, <span class='st'>"total_"</span><span class='op'>)</span>, <span class='fu'>contains</span><span class='op'>(</span><span class='st'>"total_"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>pivot_longer</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>cape</span>, <span class='va'>sa</span>, <span class='va'>africa</span>, <span class='va'>europe</span>, <span class='va'>other</span><span class='op'>)</span>, values_to <span class='op'>=</span> <span class='st'>"n"</span>, names_to <span class='op'>=</span> <span class='st'>"region"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>region <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span>
    <span class='fu'>str_detect</span><span class='op'>(</span><span class='va'>region</span>, <span class='st'>"cape"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Cape Province"</span>,
    <span class='fu'>str_detect</span><span class='op'>(</span><span class='va'>region</span>, <span class='st'>"sa"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Rest of South Africa"</span>,
    <span class='fu'>str_detect</span><span class='op'>(</span><span class='va'>region</span>, <span class='st'>"africa"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Rest of Africa"</span>,
    <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='va'>region</span>
  <span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>region <span class='op'>=</span> <span class='fu'>str_to_title</span><span class='op'>(</span><span class='va'>region</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>n</span>, <span class='va'>town</span>, fill <span class='op'>=</span> <span class='va'>region</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_col</span><span class='op'>(</span>position <span class='op'>=</span> <span class='st'>"fill"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_continuous</span><span class='op'>(</span>labels <span class='op'>=</span> <span class='va'>percent</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_fill_manual</span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'>wesanderson</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/wesanderson/man/wes_palette.html'>wes_palette</a></span><span class='op'>(</span><span class='st'>"Darjeeling1"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"Proportion of residents born in"</span>,
       x <span class='op'>=</span> <span class='cn'>NULL</span>,
       y <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span style="display:block;" id="fig:birth-places"></span>
<img src="spanish-flu-mortality_files/figure-html5/birth-places-1.png" alt="Birth places of district residents" width="768" />
<p class="caption">
Figure 18: Birth places of district residents
</p>
</div>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># dev.off()</span>
</code></pre>
</div>
</details>
</div>
<p>Figure <a href="#fig:birth-place-corr">19</a> shows that across our districts, there is a slight negative correlation between the share of residents born outside of the Cape. However, the confidence interval around this linear fit is wide. Regression table <a href="#fig:birth-place-corr">19</a> confirms that there is no significant correlation between the share of residents born outside of the Cape and pandemic mortality rates, even at the ten percent level.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># jpeg(</span>
<span class='co'>#     filename="images/birth-place-corr.jpeg",</span>
<span class='co'>#     width=6,</span>
<span class='co'>#     height=4,</span>
<span class='co'>#     units="in",</span>
<span class='co'>#     res=1000)</span>

<span class='va'>birth_place_shares</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>town</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>pandemic_mort_grouped <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>deaths</span><span class='op'>)</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>total_pop</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>distinct</span><span class='op'>(</span><span class='va'>town</span>, <span class='va'>pandemic_mort_grouped</span>, <span class='va'>share_not_cape</span>, <span class='va'>grand_total</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>share_not_cape</span>, <span class='va'>pandemic_mort_grouped</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>size <span class='op'>=</span> <span class='va'>grand_total</span><span class='op'>)</span>, colour <span class='op'>=</span> <span class='st'>"midnightblue"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_x_continuous</span><span class='op'>(</span>labels <span class='op'>=</span> <span class='fu'>percent_format</span><span class='op'>(</span>accuracy <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_y_continuous</span><span class='op'>(</span>labels <span class='op'>=</span> <span class='fu'>number_format</span><span class='op'>(</span>scale <span class='op'>=</span> <span class='fl'>1000</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_smooth</span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"lm"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Share of residents born outside the Cape Province"</span>,
       y <span class='op'>=</span> <span class='st'>"Pandemic mortality per 1000 residents"</span>,
       size <span class='op'>=</span> <span class='st'>"District population"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span style="display:block;" id="fig:birth-place-corr"></span>
<img src="spanish-flu-mortality_files/figure-html5/birth-place-corr-1.png" alt="Scatter plot and linear fit of residents born outside of the Cape Province and pandemic mortality by district" width="768" />
<p class="caption">
Figure 19: Scatter plot and linear fit of residents born outside of the Cape Province and pandemic mortality by district
</p>
</div>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># dev.off()</span>

<span class='va'>lm_1</span> <span class='op'>&lt;-</span> <span class='va'>birth_place_shares</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>pandemic_mort_rate</span> <span class='op'>~</span> <span class='va'>share_not_cape</span>, data <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span>

<span class='co'># stargazer::stargazer(lm_1,</span>
<span class='co'>#   type = "html", </span>
<span class='co'>#   title = "Infant and pandemic mortality", </span>
<span class='co'>#   dep.var.caption = " ",</span>
<span class='co'>#   dep.var.labels = "Pandemic mortality rate",</span>
<span class='co'>#   covariate.labels = c("Share of residents born outside of the Cape")</span>
<span class='co'># )</span>
</code></pre>
</div>
</details>
</div>
<table style="text-align:center">
<caption>
<strong>Foreign born residents and pandemic mortality</strong>
</caption>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
</tr>
<tr>
<td>
</td>
<td colspan="1" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
Pandemic mortality rate
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Share of residents born outside of the Cape
</td>
<td>
-0.032
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.034)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Constant
</td>
<td>
0.032<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.006)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Observations
</td>
<td>
28
</td>
</tr>
<tr>
<td style="text-align:left">
R<sup>2</sup>
</td>
<td>
0.032
</td>
</tr>
<tr>
<td style="text-align:left">
Adjusted R<sup>2</sup>
</td>
<td>
-0.005
</td>
</tr>
<tr>
<td style="text-align:left">
Residual Std. Error
</td>
<td>
0.022 (df = 26)
</td>
</tr>
<tr>
<td style="text-align:left">
F Statistic
</td>
<td>
0.869 (df = 1; 26)
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Note:</em>
</td>
<td style="text-align:right">
<sup>*</sup>p&lt;0.1; <sup>**</sup>p&lt;0.05; <sup>***</sup>p&lt;0.01
</td>
</tr>
<td colspan="3">
</td>
</tr>
<tr>
<td style="text-align:left">
<em></em>
</td>
<td colspan="2" style="text-align:right">
<em>Heteroskedasticity robust SEs from Sandwich package</em>
</td>
</table>
<h2 id="conclusion">Conclusion</h2>
<p>After analysing a dataset of 40,000 deaths in the Cape, and supplementing this information with birth and census data from prior to the pandemic, I find after assessing excess mortality that it is unlikely there was significant under counting of the number of deaths during the Spanish flu pandemic due to misclassification of cause of death. Regarding the features correlated with pandemic mortality, I find that pre-existing levels of health in a district indicated by child mortality are strongly correlated with mortality rates during the pandemic. I find that district with high levels of mortality from pneumonia and influenza prior to the pandemic suffered severely from mortality during the pandemic. Finally, I find no support for the notion that socio-economic factors proxied by the literacy of a family member or foreign born status are correlated with pandemic mortality rates.</p>
<h2 id="appendix">Appendix</h2>
<h3 id="linear-support-vector-machine-specification-and-workflow">Linear Support Vector Machine specification and workflow</h3>
<p>I use a linear support vector machine to classify ethnicity to race for black and coloured individuals based on a hand coded training set of 15 000 observations. I make use of sub-word features in my pre-processing tokenization. I use 10-fold cross validation in order to prevent data leakage and ensure that the classification results are robust.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>df_classification</span> <span class='op'>&lt;-</span> <span class='fu'>read_rds</span><span class='op'>(</span><span class='st'>"data/race_classification_15000.rds"</span><span class='op'>)</span> 

<span class='va'>df_classification</span> <span class='op'>%&gt;%</span> <span class='fu'>sample_n</span><span class='op'>(</span><span class='fl'>6</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 6 x 2
  race     ethnicity_as_recorded
  &lt;chr&gt;    &lt;chr&gt;                
1 Coloured Coloured             
2 Black    Fingo                
3 Black    Kaffir               
4 Coloured Gemengd              
5 Black    Kaffir               
6 Black    Kaffir               </code></pre>
</div>
<p>At outset I use my data budget by separating a training and assessment set from my labelled training set of 33,500 observations. This ensures that I can assess the performance of the model on data that it has not been trained on. The initial split uses 75 percent of the labelled data as training data and reserved 25 percent for testing. This means that there are 3 750 observations that are excluded from the training set, and put aside for assessing model accuracy, sensitivity and specificity after tuning of the hyper parameter. I also stratify the training and testing data based on race in order to ensure that the classes are as balanced as possible.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>123</span><span class='op'>)</span>

<span class='va'>initial_split</span> <span class='op'>&lt;-</span> <span class='va'>df_classification</span> <span class='op'>%&gt;%</span> <span class='fu'>initial_split</span><span class='op'>(</span>prop <span class='op'>=</span> <span class='fl'>.75</span>, strata <span class='op'>=</span> <span class='va'>race</span><span class='op'>)</span>
<span class='va'>initial_split</span>
</code></pre>
</div>
<pre><code>&lt;Analysis/Assess/Total&gt;
&lt;11250/3750/15000&gt;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># creating training and testing data from initial split</span>
<span class='va'>df_train</span> <span class='op'>&lt;-</span> <span class='fu'>training</span><span class='op'>(</span><span class='va'>initial_split</span><span class='op'>)</span>
<span class='va'>df_test</span> <span class='op'>&lt;-</span> <span class='fu'>testing</span><span class='op'>(</span><span class='va'>initial_split</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>In an attempt to avoid overfitting on the training data in tuning of the hyper parameter, I create 10 folds of cross validation data. In essence I create 10 datasets that sample from the training data to tune my model parameter before testing the model performance on the testing data. Again I stratify by race in my folds.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># creating 10-fold cross validation sets</span>
<span class='va'>df_folds</span> <span class='op'>&lt;-</span> <span class='fu'>vfold_cv</span><span class='op'>(</span><span class='va'>df_train</span>, 
                     v <span class='op'>=</span> <span class='fl'>10</span>, 
                     strata <span class='op'>=</span> <span class='va'>race</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h4 id="preprocessing-and-feature-engineering">Preprocessing and feature engineering</h4>
<p>Next I create a recipe for pre-processing and tokenizing the text prior to modelling.</p>
<p>I use the <code>textrecipes</code> package to tokenize the text into subword features. Using the <code>tokenizers.bpe</code> (where bpe stands for Byte-Pair Encoding) argument means that instead of breaking down our words into characters, the tokenizer algorithm will iteratively merge together frequently occurring subword pairs to find sub-words that are important in my dataset <span class="citation" data-cites="hvitfeldt2021supervised">(<a href="#ref-hvitfeldt2021supervised" role="doc-biblioref">Hvitfeldt and Silge 2021, 223</a>)</span>. It is helpful in this case as we get a sweet spot between character level and word level information. Sub-word information like this is important in NLP models. Further, sub-word models can handle new/unknown words at prediction time, which bag of words models cannot.</p>
<p>I use the <code>themis</code> package to deal with class imbalance. The <code>step_smote</code> argument generates new examples of the minority class using the nearest neighbours of those cases. In this case coloured is the minority class and as such the smote algorithm will create new examples of coloured observations with existing data from coloured observations.</p>
<p>I set the maximum number of tokens to be tuned later with the <code>tune()</code> argument.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/tidymodels/textrecipes'>textrecipes</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/tidymodels/themis'>themis</a></span><span class='op'>)</span>

<span class='va'>classifcation_rec</span> <span class='op'>&lt;-</span> <span class='fu'>recipe</span><span class='op'>(</span><span class='va'>race</span> <span class='op'>~</span> <span class='va'>ethnicity_as_recorded</span>, data <span class='op'>=</span> <span class='va'>df_train</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://textrecipes.tidymodels.org/reference/step_tokenize.html'>step_tokenize</a></span><span class='op'>(</span><span class='va'>ethnicity_as_recorded</span>, 
                  engine <span class='op'>=</span> <span class='st'>"tokenizers.bpe"</span>,
                  training_options <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>vocab_size <span class='op'>=</span> <span class='fl'>200</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://textrecipes.tidymodels.org/reference/step_tokenfilter.html'>step_tokenfilter</a></span><span class='op'>(</span><span class='va'>ethnicity_as_recorded</span>, max_tokens <span class='op'>=</span> <span class='fu'>tune</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://textrecipes.tidymodels.org/reference/step_tf.html'>step_tf</a></span><span class='op'>(</span><span class='va'>ethnicity_as_recorded</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>step_normalize</span><span class='op'>(</span><span class='fu'>all_predictors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://themis.tidymodels.org/reference/step_smote.html'>step_smote</a></span><span class='op'>(</span><span class='va'>race</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h4 id="model-specification">Model specification</h4>
<p>I use a linear support vector machine, set the mode to classification and the engine that does the computation is LiblineaR, a wrapper for the C++ library LIBLINEAR. The LIBLINEAR library was the winner of ICML 2008 large-scale learning challenge, and can be used for binary as well as multi-class classification <span class="citation" data-cites="Fan2008">(<a href="#ref-Fan2008" role="doc-biblioref">Fan et al. 2008, 35</a>)</span>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>svm_spec</span> <span class='op'>&lt;-</span> <span class='fu'>svm_linear</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>set_mode</span><span class='op'>(</span><span class='st'>"classification"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>set_engine</span><span class='op'>(</span><span class='st'>"LiblineaR"</span><span class='op'>)</span>

<span class='va'>svm_spec</span>
</code></pre>
</div>
<pre><code>Linear Support Vector Machine Specification (classification)

Computational engine: LiblineaR </code></pre>
</div>
<h4 id="model-workflow">Model workflow</h4>
<p>Here the workflow keeps together the pre-processor or recipe and the model specification. Later the workflow can be finalized with the hyper paramter that performs the best on a specified metric.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>wf</span> <span class='op'>&lt;-</span> <span class='fu'>workflow</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>add_recipe</span><span class='op'>(</span><span class='va'>classifcation_rec</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>add_model</span><span class='op'>(</span><span class='va'>svm_spec</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h4 id="tuning-grid">Tuning grid</h4>
<p>The tuning grid specifies the values across which the model will search for the best performing number of tokens or predictors. The choices are specified manually in this case given the simple search space and single tuning parameter.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>grid</span> <span class='op'>&lt;-</span> <span class='fu'>crossing</span><span class='op'>(</span>max_tokens <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>50</span>, <span class='fl'>100</span>, <span class='fl'>150</span>, <span class='fl'>200</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h4 id="tuning-parameters">Tuning parameters</h4>
<p>By tuning the number of tokens using the 10 folds of cross validation data I can select the optimal parameters for the best performance of the model across the 10 folds of my training data.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>results</span> <span class='op'>&lt;-</span> <span class='fu'>tune_grid</span><span class='op'>(</span>
    <span class='va'>wf</span>, 
    <span class='va'>df_folds</span>,
    grid <span class='op'>=</span> <span class='va'>grid</span>,
    metrics <span class='op'>=</span> <span class='fu'>metric_set</span><span class='op'>(</span><span class='va'>accuracy</span>, <span class='va'>sens</span>, <span class='va'>spec</span><span class='op'>)</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<h4 id="visualizing-the-results">Visualizing the results</h4>
<p>In Figure <a href="#fig:tuning-fig">20</a> I draw a plot of model performance across the three metrics we specified above, accuracy, sensitivity and specificity. Balancing type 1 and type 2 errors here is not too important given that both sensitivity and specificity are so high. We can see that moving from 100 to 150 retained tokens, or predictors in our model, improves accuracy, sensitivity and specificity. Moving to 200 tokens worsens specificity marginally.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># jpeg(</span>
<span class='co'>#     filename="images/tuning-fig.jpeg",</span>
<span class='co'>#     width=6,</span>
<span class='co'>#     height=4,</span>
<span class='co'>#     units="in",</span>
<span class='co'>#     res=1000)</span>

<span class='va'>results</span> <span class='op'>%&gt;%</span> <span class='fu'>autoplot</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span style="display:block;" id="fig:tuning-fig"></span>
<img src="spanish-flu-mortality_files/figure-html5/tuning-fig-1.png" alt="Model metrics for classification model and hyperparamter values" width="768" />
<p class="caption">
Figure 20: Model metrics for classification model and hyperparamter values
</p>
</div>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># dev.off()</span>
</code></pre>
</div>
</div>
<h4 id="finalize-workflow">Finalize workflow</h4>
<p>Here I select the best model based on specificity across the 10 folds of cross validation data.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>wf_final</span> <span class='op'>&lt;-</span> <span class='va'>wf</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>finalize_workflow</span><span class='op'>(</span><span class='fu'>select_best</span><span class='op'>(</span><span class='va'>results</span>, <span class='st'>"spec"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h4 id="final-fit-on-the-holdout-data">Final fit on the holdout data</h4>
<p>Finally, with the hyper parameter value chosen, I fit the model a last time, training on the training data and tested on the testing data created with the initial split.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>final_fit</span> <span class='op'>&lt;-</span> <span class='fu'>last_fit</span><span class='op'>(</span><span class='va'>wf_final</span>, <span class='va'>initial_split</span>,
         metrics <span class='op'>=</span> <span class='fu'>metric_set</span><span class='op'>(</span><span class='va'>accuracy</span>, <span class='va'>sens</span>, <span class='va'>spec</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>The performance of the model on the testing data is almost identical to the cross validation folds. A success.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>collect_metrics</span><span class='op'>(</span><span class='va'>final_fit</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 3 x 4
  .metric  .estimator .estimate .config             
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
1 accuracy binary         0.998 Preprocessor1_Model1
2 sens     binary         0.998 Preprocessor1_Model1
3 spec     binary         0.999 Preprocessor1_Model1</code></pre>
</div>
<h4 id="confusion-matrix">Confusion matrix</h4>
<p>The confusion matrix shown in Figre <a href="#fig:conf-mat-fig">21</a> displays the number of predictions that the classifier made correctly and incorrectly. It is evident that it made 6 mistakes in total, out of the 3750 observations kept in the testing set. Two were predicted black when in truth they were coloured, and four predicted coloured when they were in fact black.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># jpeg(</span>
<span class='co'>#     filename="images/conf-mat-fig.jpeg",</span>
<span class='co'>#     width=6,</span>
<span class='co'>#     height=4,</span>
<span class='co'>#     units="in",</span>
<span class='co'>#     res=1000)</span>

<span class='fu'>collect_predictions</span><span class='op'>(</span><span class='va'>final_fit</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>conf_mat</span><span class='op'>(</span><span class='va'>race</span>, <span class='va'>.pred_class</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>autoplot</span><span class='op'>(</span>type <span class='op'>=</span> <span class='st'>"heatmap"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_fill_viridis_c</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span style="display:block;" id="fig:conf-mat-fig"></span>
<img src="spanish-flu-mortality_files/figure-html5/conf-mat-fig-1.png" alt="Confusion matrix for classification model" width="768" />
<p class="caption">
Figure 21: Confusion matrix for classification model
</p>
</div>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># dev.off()</span>
</code></pre>
</div>
</div>
<h4 id="model-performance">Model performance</h4>
<p>The model achieves 99.8 percent accuracy on previously unseen testing data, evidencing that it performs well on the sample of 15 000 hand labelled examples. It was then used on the remaining 25 000 individuals in order to collapse ethnicity to race in the full dataset. These predictions were checked by hand in order to correct any errors.</p>
<h4 id="interpreting-the-model">Interpreting the model</h4>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>fit</span> <span class='op'>&lt;-</span> <span class='fu'>pull_workflow_fit</span><span class='op'>(</span><span class='va'>final_fit</span><span class='op'>$</span><span class='va'>.workflow</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span>

<span class='va'>liblinear_obj</span> <span class='op'>&lt;-</span> <span class='va'>fit</span><span class='op'>$</span><span class='va'>fit</span><span class='op'>$</span><span class='va'>W</span>

<span class='va'>liblinear_df</span> <span class='op'>&lt;-</span> <span class='fu'>tibble</span><span class='op'>(</span>term <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>liblinear_obj</span><span class='op'>)</span>,
                       estimate <span class='op'>=</span> <span class='va'>liblinear_obj</span><span class='op'>[</span><span class='fl'>1</span>,<span class='op'>]</span><span class='op'>)</span>

<span class='va'>words</span> <span class='op'>&lt;-</span> <span class='va'>liblinear_df</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>term</span> <span class='op'>!=</span> <span class='st'>"Bias"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate</span><span class='op'>(</span>term <span class='op'>=</span> <span class='fu'>str_replace_all</span><span class='op'>(</span><span class='va'>term</span>, <span class='st'>"Kaffir"</span>, <span class='st'>"K*****"</span><span class='op'>)</span>,
           term <span class='op'>=</span> <span class='fu'>str_replace_all</span><span class='op'>(</span><span class='va'>term</span>, <span class='st'>"Hottentot"</span>, <span class='st'>"H********"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>estimate</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>slice_max</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>estimate</span><span class='op'>)</span>, n <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate</span><span class='op'>(</span>term <span class='op'>=</span> <span class='fu'>str_remove</span><span class='op'>(</span><span class='va'>term</span>, <span class='st'>"tf_ethnicity_as_recorded_"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># jpeg(</span>
<span class='co'>#     filename="images/words-fig.jpeg",</span>
<span class='co'>#     width=6,</span>
<span class='co'>#     height=4,</span>
<span class='co'>#     units="in",</span>
<span class='co'>#     res=1000)</span>

<span class='va'>words</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate</span><span class='op'>(</span>term <span class='op'>=</span> <span class='fu'>str_extract</span><span class='op'>(</span><span class='va'>term</span>, <span class='st'>"\\w.*"</span><span class='op'>)</span>,
           term <span class='op'>=</span> <span class='fu'>str_to_lower</span><span class='op'>(</span><span class='va'>term</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>term</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"h"</span>, <span class='st'>"b"</span>, <span class='st'>"g"</span><span class='op'>)</span>,
           <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>term</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>estimate</span>, <span class='fu'>fct_reorder</span><span class='op'>(</span><span class='va'>term</span>, <span class='va'>estimate</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='va'>estimate</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_col</span><span class='op'>(</span>show.legend <span class='op'>=</span> <span class='cn'>F</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>labs</span><span class='op'>(</span>y <span class='op'>=</span> <span class='st'>"Words and sub-words"</span>,
         x <span class='op'>=</span> <span class='st'>"Imprtance of feature"</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span style="display:block;" id="fig:words-fig"></span>
<img src="spanish-flu-mortality_files/figure-html5/words-fig-1.png" alt="Determinants of classification model" width="768" />
<p class="caption">
Figure 22: Determinants of classification model
</p>
</div>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># dev.off()</span>
</code></pre>
</div>
</div>
<p>Figure <a href="#fig:words-fig">22</a> allows us to see that if the ethnicity contains the sub-word features “KA,” “Z,”AT“,”OL“, and”AN“, the linear SVM is more likely to classify the individual as Black. In contrast, sub-word features”AR“, and”AM“,”M" and “L” are associated with coloured individuals.</p>
<h4 id="classification-output">Classification output</h4>
<p>Figure <a href="#fig:ethnicity-race-classification">23</a> shows the 12 most common classes in each race grouping.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># jpeg(</span>
<span class='co'>#     filename="images/ethnicity-race-classification.jpeg",</span>
<span class='co'>#     width=6,</span>
<span class='co'>#     height=4,</span>
<span class='co'>#     units="in",</span>
<span class='co'>#     res=1000)</span>

<span class='va'>df</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>race</span> <span class='op'>!=</span> <span class='st'>"NA"</span>,
         <span class='va'>race_original</span> <span class='op'>!=</span> <span class='st'>"Assyrian"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>count</span><span class='op'>(</span><span class='va'>race</span>, <span class='va'>race_original</span>, sort <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>race</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>slice_max</span><span class='op'>(</span><span class='va'>n</span>, n <span class='op'>=</span> <span class='fl'>12</span>, with_ties <span class='op'>=</span> <span class='cn'>F</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>race_original <span class='op'>=</span> <span class='fu'>str_replace_all</span><span class='op'>(</span><span class='va'>race_original</span>, <span class='st'>"Kaffir"</span>, <span class='st'>"K*****"</span><span class='op'>)</span>,
         race_original <span class='op'>=</span> <span class='fu'>str_replace_all</span><span class='op'>(</span><span class='va'>race_original</span>, <span class='st'>"Hottentot"</span>, <span class='st'>"H********"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>race_original <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/tidytext/man/reorder_within.html'>reorder_within</a></span><span class='op'>(</span><span class='va'>race_original</span>, <span class='va'>n</span>, <span class='va'>race</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span><span class='va'>n</span>, <span class='va'>race_original</span>, fill <span class='op'>=</span> <span class='va'>race</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_col</span><span class='op'>(</span>show.legend <span class='op'>=</span> <span class='cn'>F</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://rdrr.io/pkg/tidytext/man/reorder_within.html'>scale_y_reordered</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>facet_wrap</span><span class='op'>(</span><span class='op'>~</span> <span class='va'>race</span>, scales <span class='op'>=</span> <span class='st'>"free"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>scale_fill_manual</span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'>wesanderson</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/wesanderson/man/wes_palette.html'>wes_palette</a></span><span class='op'>(</span><span class='fl'>3</span>, name <span class='op'>=</span> <span class='st'>"Zissou1"</span>, type <span class='op'>=</span> <span class='st'>"continuous"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='cn'>NULL</span>,
       y <span class='op'>=</span> <span class='st'>"Recorded ethnicity"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure"><span style="display:block;" id="fig:ethnicity-race-classification"></span>
<img src="spanish-flu-mortality_files/figure-html5/ethnicity-race-classification-1.png" alt="Output of classification model" width="768" />
<p class="caption">
Figure 23: Output of classification model
</p>
</div>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># dev.off()</span>
</code></pre>
</div>
</details>
</div>
<h3 id="respiratory-disease-deaths">Respiratory disease deaths</h3>
<p>I classify any death occurring during the pandemic period a respiratory death if the recorded cause of death includes any of the following phrases.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>respiratory_terms</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"respiratory"</span>, <span class='st'>"Spanish influenza"</span>,<span class='st'>"Pneumonia"</span>,<span class='st'>"Bronchitis"</span>,<span class='st'>"Infleuzna"</span>,<span class='st'>"broncho pneumonia"</span>,<span class='st'>"consumption"</span>,<span class='st'>"whooping cough"</span>,<span class='st'>"inflammation of lungs"</span>,<span class='st'>"inflammation of the lungs"</span>,<span class='st'>"pulmonary tuberculosis"</span>,<span class='st'>"tuberculosis"</span>,<span class='st'>"phthisis"</span>,<span class='st'>"influenza pneumonia"</span>,<span class='st'>"inflammation in lungs"</span>,<span class='st'>"croup"</span>,<span class='st'>"phthisis pulmonalis"</span>,<span class='st'>"epidemic influenza"</span>,<span class='st'>"inflammation in the lungs"</span>,<span class='st'>"inflamation of lungs"</span>,<span class='st'>"spanish influenza pneumonia"</span>,<span class='st'>"flu"</span>,<span class='st'>"spanish flu"</span>,<span class='st'>"pneumonia following on an attack of influenza"</span>,<span class='st'>"pulmonary pneumonia"</span>,<span class='st'>"pneumonia influenza"</span>,<span class='st'>"inflamation of the lungs"</span>,<span class='st'>"pulmonary phthisis"</span>,<span class='st'>"inflamation in the lungs"</span>,<span class='st'>"double pneumonia"</span>,<span class='st'>"lobar pneumonia"</span>,<span class='st'>"tuberculosis Pulmonum"</span>,<span class='st'>"spanish influenza"</span>,<span class='st'>"general tuberculosis"</span>, <span class='st'>"flu"</span>, <span class='st'>"spanish"</span>, <span class='st'>"epidemic"</span>, <span class='st'>"lung"</span>, <span class='st'>"Spaanse Griep"</span><span class='op'>)</span>

<span class='va'>respiratory_terms</span>
</code></pre>
</div>
<pre><code> [1] &quot;respiratory&quot;                                  
 [2] &quot;Spanish influenza&quot;                            
 [3] &quot;Pneumonia&quot;                                    
 [4] &quot;Bronchitis&quot;                                   
 [5] &quot;Infleuzna&quot;                                    
 [6] &quot;broncho pneumonia&quot;                            
 [7] &quot;consumption&quot;                                  
 [8] &quot;whooping cough&quot;                               
 [9] &quot;inflammation of lungs&quot;                        
[10] &quot;inflammation of the lungs&quot;                    
[11] &quot;pulmonary tuberculosis&quot;                       
[12] &quot;tuberculosis&quot;                                 
[13] &quot;phthisis&quot;                                     
[14] &quot;influenza pneumonia&quot;                          
[15] &quot;inflammation in lungs&quot;                        
[16] &quot;croup&quot;                                        
[17] &quot;phthisis pulmonalis&quot;                          
[18] &quot;epidemic influenza&quot;                           
[19] &quot;inflammation in the lungs&quot;                    
[20] &quot;inflamation of lungs&quot;                         
[21] &quot;spanish influenza pneumonia&quot;                  
[22] &quot;flu&quot;                                          
[23] &quot;spanish flu&quot;                                  
[24] &quot;pneumonia following on an attack of influenza&quot;
[25] &quot;pulmonary pneumonia&quot;                          
[26] &quot;pneumonia influenza&quot;                          
[27] &quot;inflamation of the lungs&quot;                     
[28] &quot;pulmonary phthisis&quot;                           
[29] &quot;inflamation in the lungs&quot;                     
[30] &quot;double pneumonia&quot;                             
[31] &quot;lobar pneumonia&quot;                              
[32] &quot;tuberculosis Pulmonum&quot;                        
[33] &quot;spanish influenza&quot;                            
[34] &quot;general tuberculosis&quot;                         
[35] &quot;flu&quot;                                          
[36] &quot;spanish&quot;                                      
[37] &quot;epidemic&quot;                                     
[38] &quot;lung&quot;                                         
[39] &quot;Spaanse Griep&quot;                                </code></pre>
</div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-AcuaSoto2011InfluenzaAP" class="csl-entry" role="doc-biblioentry">
Acuña-Soto, R., C. Viboud, and G. Chowell. 2011. <span>“Influenza and Pneumonia Mortality in 66 Large Cities in the United States in Years Surrounding the 1918 Pandemic.”</span> <em>PLoS ONE</em> 6.
</div>
<div id="ref-Arthi2021" class="csl-entry" role="doc-biblioentry">
Arthi, Vellore, and John Parman. 2021. <span>“<span class="nocase">Disease, downturns, and wellbeing: Economic history and the long-run impacts of COVID-19</span>.”</span> <a href="https://doi.org/10.1016/j.eeh.2020.101381">https://doi.org/10.1016/j.eeh.2020.101381</a>.
</div>
<div id="ref-Barry2008" class="csl-entry" role="doc-biblioentry">
Barry, John M., Cécile Viboud, and Lone Simonsen. 2008. <span>“<span class="nocase">Cross-protection between successive waves of the 1918-1919 influenza pandemic: Epidemiological evidence from US Army camps and from Britain</span>.”</span> <em>Journal of Infectious Diseases</em>. <a href="https://doi.org/10.1086/592454">https://doi.org/10.1086/592454</a>.
</div>
<div id="ref-Bogaert2015" class="csl-entry" role="doc-biblioentry">
Bogaert, Kandace. 2015. <span>“<span class="nocase">Cross protection between the first and second waves of the 1918 influenza pandemic among soldiers of the Canadian Expeditionary Force (CEF) in Ontario</span>.”</span> <em>Vaccine</em>. <a href="https://doi.org/10.1016/j.vaccine.2015.10.120">https://doi.org/10.1016/j.vaccine.2015.10.120</a>.
</div>
<div id="ref-Bogaert2016" class="csl-entry" role="doc-biblioentry">
Bogaert, Kandace L. 2016. <span>“<span class="nocase">Reply to Brundage and Shanks</span>.”</span> <a href="https://doi.org/10.1016/j.vaccine.2016.02.071">https://doi.org/10.1016/j.vaccine.2016.02.071</a>.
</div>
<div id="ref-Chowell2008" class="csl-entry" role="doc-biblioentry">
Chowell, Gerardo, Luís M. A. Bettencourt, Niall Johnson, Wladimir J. Alonso, and Cécile Viboud. 2008. <span>“<span class="nocase">The 1918-1919 influenza pandemic in England and Wales: Spatial patterns in transmissibility and mortality impact</span>.”</span> <em>Proceedings of the Royal Society B: Biological Sciences</em>. <a href="https://doi.org/10.1098/rspb.2007.1477">https://doi.org/10.1098/rspb.2007.1477</a>.
</div>
<div id="ref-Civil1918" class="csl-entry" role="doc-biblioentry">
Civil Deaths 1895-1972 database with images National Archives Pretoria. 1918. <span>“<span class="nocase">Death Certificate of Wills Bunu</span>.”</span> Pretoria.
</div>
<div id="ref-Clay2018" class="csl-entry" role="doc-biblioentry">
Clay, Karen, Joshua Lewis, and Edson Severnini. 2018. <span>“<span class="nocase">Pollution, infectious disease, and mortality: Evidence from the 1918 Spanish influenza pandemic</span>.”</span> <em>Journal of Economic History</em>. <a href="https://doi.org/10.1017/S002205071800058X">https://doi.org/10.1017/S002205071800058X</a>.
</div>
<div id="ref-Cowling2006" class="csl-entry" role="doc-biblioentry">
Cowling, Benjamin J, Irene O L Wong, Lai-Ming Ho, Steven Riley, and Gabriel M Leung. 2006. <span>“<span class="nocase">Methods for monitoring influenza surveillance data</span>.”</span> <em>International Journal of Epidemiology</em> 35 (5): 1314–21. <a href="https://doi.org/10.1093/ije/dyl162">https://doi.org/10.1093/ije/dyl162</a>.
</div>
<div id="ref-Dorrington2021" class="csl-entry" role="doc-biblioentry">
Dorrington, Rob, Debbie Bradshaw, Ria Laubscher, Pam Groenewald, and Tom Moultrie. 2021. <span>“<span>METHODOLOGICAL NOTE: PREDICTED NUMBERS OF DEATHS BY EPI-WEEK FOR SOUTH AFRICA IN 2020 AND 2021</span>.”</span> South African Medical Research Council. <a href="https://www.samrc.ac.za/sites/default/files/files/2021-01-24/Methodological Note on Predicted Weekly Deaths 20{\_}Jan{\_}2021.pdf">https://www.samrc.ac.za/sites/default/files/files/2021-01-24/Methodological Note on Predicted Weekly Deaths 20{\_}Jan{\_}2021.pdf</a>.
</div>
<div id="ref-Fan2008" class="csl-entry" role="doc-biblioentry">
Fan, Rong En, Kai Wei Chang, Cho Jui Hsieh, Xiang Rui Wang, and Chih Jen Lin. 2008. <span>“<span class="nocase">LIBLINEAR: A library for large linear classification</span>.”</span> <em>Journal of Machine Learning Research</em>. <a href="https://doi.org/10.1145/1390681.1442794">https://doi.org/10.1145/1390681.1442794</a>.
</div>
<div id="ref-Fourie2021" class="csl-entry" role="doc-biblioentry">
Fourie, Johan, and Jonathan Jayes. 2021. <span>“Health Inequality and the 1918 Influenza in South Africa.”</span> <em>World Development</em> 141: 105407. https://doi.org/<a href="https://doi.org/10.1016/j.worlddev.2021.105407">https://doi.org/10.1016/j.worlddev.2021.105407</a>.
</div>
<div id="ref-Grantz2016" class="csl-entry" role="doc-biblioentry">
Grantz, Kyra H., Madhura S. Rane, Henrik Salje, Gregory E. Glass, Stephen E. Schachterle, and Derek A. T. Cummings. 2016. <span>“<span class="nocase">Disparities in influenza mortality and transmission related to sociodemographic factors within Chicago in the pandemic of 1918</span>.”</span> <em>Proceedings of the National Academy of Sciences of the United States of America</em>. <a href="https://doi.org/10.1073/pnas.1612838113">https://doi.org/10.1073/pnas.1612838113</a>.
</div>
<div id="ref-Hanlon2018LondonFA" class="csl-entry" role="doc-biblioentry">
Hanlon, W. 2018. <span>“London Fog: A Century of Pollution and Mortality, 1866-1965.”</span> <em>Urban Economics &amp; Regional Studies eJournal</em>.
</div>
<div id="ref-hvitfeldt2021supervised" class="csl-entry" role="doc-biblioentry">
Hvitfeldt, E., and J. Silge. 2021. <em>Supervised Machine Learning for Text Analysis in r</em>. Chapman &amp; Hall/CRC Data Science Series. Taylor &amp; Francis Limited. <a href="https://books.google.co.za/books?id=WQ1qzgEACAAJ">https://books.google.co.za/books?id=WQ1qzgEACAAJ</a>.
</div>
<div id="ref-Lin2014" class="csl-entry" role="doc-biblioentry">
Lin, Ming Jen, and Elaine M. Liu. 2014. <span>“<span class="nocase">Does in utero exposure to illness matter? The 1918 influenza epidemic in taiwan as a natural experiment</span>.”</span> <em>Journal of Health Economics</em>. <a href="https://doi.org/10.1016/j.jhealeco.2014.05.004">https://doi.org/10.1016/j.jhealeco.2014.05.004</a>.
</div>
<div id="ref-Mamelund2006" class="csl-entry" role="doc-biblioentry">
Mamelund, Svenn Erik. 2006. <span>“<span class="nocase">A socially neutral disease? Individual social class, household wealth and mortality from Spanish influenza in two socially contrasting parishes in Kristiania 1918-19</span>.”</span> <em>Social Science and Medicine</em>. <a href="https://doi.org/10.1016/j.socscimed.2005.06.051">https://doi.org/10.1016/j.socscimed.2005.06.051</a>.
</div>
<div id="ref-Mtumane" class="csl-entry" role="doc-biblioentry">
Mtumane, Zilibele. 2017. <span>“The Practice of Ubuntu with Regard to amaMfengu Among amaXhosa as Depicted in s. E. K. Mqhayi’s Ityala Lamawele.”</span> <em>International Journal of African Renaissance Studies - Multi-, Inter- and Transdisciplinarity</em> 12 (2): 68–80. <a href="https://doi.org/10.1080/18186874.2017.1392146">https://doi.org/10.1080/18186874.2017.1392146</a>.
</div>
<div id="ref-OfficeofCensusandStatisticsPretoria1918" class="csl-entry" role="doc-biblioentry">
Office of Census and Statistics Pretoria. 1918. <span>“<span class="nocase">Statistics of Population of the Union of South Africa 1918 and previous years including vital and health statistics for the year 1916 and previous years</span>.”</span>
</div>
<div id="ref-Ogasawara2018" class="csl-entry" role="doc-biblioentry">
Ogasawara, Kota. 2018. <span>“<span class="nocase">The long-run effects of pandemic influenza on the development of children from elite backgrounds: Evidence from industrializing Japan</span>.”</span> <em>Economics and Human Biology</em>. <a href="https://doi.org/10.1016/j.ehb.2018.08.012">https://doi.org/10.1016/j.ehb.2018.08.012</a>.
</div>
<div id="ref-Phillips1984" class="csl-entry" role="doc-biblioentry">
Phillips, Howard. 1984. <span>“<span>’BLACK OCTOBER’: THE IMPACT OF THE SPANISH INFLUENZA EPIDEMIC OF 1918 ON SOUTH AFRICA</span>.”</span> PhD thesis, University of Cape Town.
</div>
<div id="ref-Shanks2016" class="csl-entry" role="doc-biblioentry">
Shanks, G. Dennis, and John F. Brundage. 2016. <span>“<span class="nocase">Response to Bogaert</span>.”</span> <a href="https://doi.org/10.1016/j.vaccine.2016.02.068">https://doi.org/10.1016/j.vaccine.2016.02.068</a>.
</div>
<div id="ref-Shanks2010" class="csl-entry" role="doc-biblioentry">
Shanks, G. Dennis, John Brundage, and John Frean. 2010. <span>“<span class="nocase">Why did many more diamond miners than gold miners die in South Africa during the 1918 influenza pandemic?</span>”</span> <em>International Health</em>. <a href="https://doi.org/10.1016/j.inhe.2009.12.001">https://doi.org/10.1016/j.inhe.2009.12.001</a>.
</div>
<div id="ref-Stapleton" class="csl-entry" role="doc-biblioentry">
Stapleton, Timothy J. 1995. <span>“Oral Evidence in a Pseudo-Ethnicity: The Fingo Debate.”</span> <em>History in Africa</em> 22: 359–68. <a href="http://www.jstor.org/stable/3171922">http://www.jstor.org/stable/3171922</a>.
</div>
<div id="ref-Suthaharan2016" class="csl-entry" role="doc-biblioentry">
Suthaharan, Shan. 2016. <span>“Support Vector Machine.”</span> In <em>Machine Learning Models and Algorithms for Big Data Classification: Thinking with Examples for Effective Learning</em>, 207–35. Boston, MA: Springer US. <a href="https://doi.org/10.1007/978-1-4899-7641-3_9">https://doi.org/10.1007/978-1-4899-7641-3_9</a>.
</div>
<div id="ref-Taubenberger2006" class="csl-entry" role="doc-biblioentry">
Taubenberger, Jeffery K., and David M. Morens. 2006. <span>“<span class="nocase">1918 Influenza: the Mother of All Pandemics</span>.”</span> <em>Emerging Infectious Diseases</em>. <a href="https://doi.org/10.3201/eid1201.050979">https://doi.org/10.3201/eid1201.050979</a>.
</div>
</div>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>The specific terms are detailed in the appendix<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>Sea Point lacks a denominator as it was not recorded separately from Cape Town<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
<h3 id="references">References</h3>
<div id="references-listing"></div>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
